<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>sbt/ConcurrentRestrictions.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> sbt

<span class="comment">/**
 * Describes restrictions on concurrent execution for a set of tasks.
 *
 * @tparam A the type of a task
 */</span>
<span class="keyword">trait</span> <a title="trait ConcurrentRestrictions[A] extends AnyRef" id="sbt;ConcurrentRestrictions">ConcurrentRestrictions</a><span class="delimiter">[</span><a title="" id="sbt;ConcurrentRestrictions;A">A</a><span class="delimiter">]</span> <span class="delimiter">{</span>
  <span class="comment">/** Internal state type used to describe a set of tasks. */</span>
  <span class="keyword">type</span> <a title="" id="sbt;ConcurrentRestrictions;G">G</a>

  <span class="comment">/** Representation of zero tasks.*/</span>
  <span class="keyword">def</span> <a title="=&gt; ConcurrentRestrictions.this.G" id="sbt;ConcurrentRestrictions.empty">empty</a>: <a href="#sbt;ConcurrentRestrictions;G" title="ConcurrentRestrictions.this.G">G</a>

  <span class="comment">/** Updates the description `g` to include a new task `a`.*/</span>
  <span class="keyword">def</span> <a title="(g: ConcurrentRestrictions.this.G, a: A)ConcurrentRestrictions.this.G" id="sbt;ConcurrentRestrictions.add">add</a><span class="delimiter">(</span><a title="ConcurrentRestrictions.this.G" id="sbt;ConcurrentRestrictions.add.g">g</a>: <a href="#sbt;ConcurrentRestrictions;G" title="ConcurrentRestrictions.this.G">G</a>, <a title="A" id="sbt;ConcurrentRestrictions.add.a">a</a>: <a href="#sbt;ConcurrentRestrictions;A" title="A">A</a><span class="delimiter">)</span>: <a href="#sbt;ConcurrentRestrictions;G" title="ConcurrentRestrictions.this.G">G</a>

  <span class="comment">/** Updates the description `g` to remove a previously added task `a`.*/</span>
  <span class="keyword">def</span> <a title="(g: ConcurrentRestrictions.this.G, a: A)ConcurrentRestrictions.this.G" id="sbt;ConcurrentRestrictions.remove">remove</a><span class="delimiter">(</span><a title="ConcurrentRestrictions.this.G" id="sbt;ConcurrentRestrictions.remove.g">g</a>: <a href="#sbt;ConcurrentRestrictions;G" title="ConcurrentRestrictions.this.G">G</a>, <a title="A" id="sbt;ConcurrentRestrictions.remove.a">a</a>: <a href="#sbt;ConcurrentRestrictions;A" title="A">A</a><span class="delimiter">)</span>: <a href="#sbt;ConcurrentRestrictions;G" title="ConcurrentRestrictions.this.G">G</a>

  <span class="comment">/**
   * Returns true if the tasks described by `g` are allowed to execute concurrently.
   * The methods in this class must obey the following laws:
   *
   * 1. forall g: G, a: A; valid(g) =&gt; valid(remove(g,a))
   * 2. forall a: A; valid(add(empty, a))
   * 3. forall g: G, a: A; valid(g) &lt;=&gt; valid(remove(add(g, a), a))
   * 4. (implied by 1,2,3) valid(empty)
   * 5. forall g: G, a: A, b: A; !valid(add(g,a)) =&gt; !valid(add(add(g,b), a))
   */</span>
  <span class="keyword">def</span> <a title="(g: ConcurrentRestrictions.this.G)Boolean" id="sbt;ConcurrentRestrictions.valid">valid</a><span class="delimiter">(</span><a title="ConcurrentRestrictions.this.G" id="sbt;ConcurrentRestrictions.valid.g">g</a>: <a href="#sbt;ConcurrentRestrictions;G" title="ConcurrentRestrictions.this.G">G</a><span class="delimiter">)</span>: <span title="Boolean">Boolean</span>
<span class="delimiter">}</span>

<span title="AnyRef" class="keyword">import</span> java.util.<span class="delimiter">{</span> LinkedList, Queue <span class="delimiter">}</span>
<span class="keyword">import</span> java.util.concurrent.<span class="delimiter">{</span> Executor, Executors, ExecutorCompletionService <span class="delimiter">}</span>
<span class="keyword">import</span> annotation.tailrec

<span class="keyword">object</span> <a title="sbt.ConcurrentRestrictions.type" id="sbt.ConcurrentRestrictions">ConcurrentRestrictions</a> <a href="#sbt.ConcurrentRestrictions" title="sbt.ConcurrentRestrictions.type" class="delimiter">{</a>
  <span class="comment">/**
   * A ConcurrentRestrictions instance that places no restrictions on concurrently executing tasks.
   * @param zero the constant placeholder used for t
   */</span>
  <span class="keyword">def</span> <a title="[A]=&gt; sbt.ConcurrentRestrictions[A]" id="sbt.ConcurrentRestrictions.unrestricted">unrestricted</a><span class="delimiter">[</span><a title="" id="sbt.ConcurrentRestrictions.unrestricted;A">A</a><span class="delimiter">]</span>: <a href="#sbt;ConcurrentRestrictions" title="sbt.ConcurrentRestrictions[A]">ConcurrentRestrictions</a><span class="delimiter">[</span>A<span class="delimiter">]</span> =
    <a href="#sbt.ConcurrentRestrictions.unrestricted;$anon" title="sbt.ConcurrentRestrictions[A]" class="keyword">new</a> <a title="anonymous class $anon extends AnyRef with sbt.ConcurrentRestrictions[A]" id="sbt.ConcurrentRestrictions.unrestricted;$anon">ConcurrentRestrictions</a><span class="delimiter">[</span>A<span class="delimiter">]</span> <span class="delimiter">{</span>
      <span class="keyword">type</span> <a title="Unit" id="sbt.ConcurrentRestrictions.unrestricted;$anon;G">G</a> = <span title="Unit">Unit</span>
      <span class="keyword">def</span> <a title="=&gt; Unit" id="sbt.ConcurrentRestrictions.unrestricted;$anon.empty">empty</a> = <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="(g: this.G, a: A)Unit" id="sbt.ConcurrentRestrictions.unrestricted;$anon.add">add</a><span class="delimiter">(</span><a title="this.G" id="sbt.ConcurrentRestrictions.unrestricted;$anon.add.g">g</a>: <span title="this.G">G</span>, <a title="A" id="sbt.ConcurrentRestrictions.unrestricted;$anon.add.a">a</a>: <a href="#sbt.ConcurrentRestrictions.unrestricted;A" title="A">A</a><span class="delimiter">)</span> = <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="(g: this.G, a: A)Unit" id="sbt.ConcurrentRestrictions.unrestricted;$anon.remove">remove</a><span class="delimiter">(</span><a title="this.G" id="sbt.ConcurrentRestrictions.unrestricted;$anon.remove.g">g</a>: <span title="this.G">G</span>, <a title="A" id="sbt.ConcurrentRestrictions.unrestricted;$anon.remove.a">a</a>: <a href="#sbt.ConcurrentRestrictions.unrestricted;A" title="A">A</a><span class="delimiter">)</span> = <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="(g: this.G)Boolean" id="sbt.ConcurrentRestrictions.unrestricted;$anon.valid">valid</a><span class="delimiter">(</span><a title="this.G" id="sbt.ConcurrentRestrictions.unrestricted;$anon.valid.g">g</a>: <span title="this.G">G</span><span class="delimiter">)</span> = <span title="Boolean(true)" class="keyword">true</span>
    <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[A](i: Int)sbt.ConcurrentRestrictions[A]" id="sbt.ConcurrentRestrictions.limitTotal">limitTotal</a><span class="delimiter">[</span><a title="" id="sbt.ConcurrentRestrictions.limitTotal;A">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="Int" id="sbt.ConcurrentRestrictions.limitTotal.i">i</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <a href="#sbt;ConcurrentRestrictions" title="sbt.ConcurrentRestrictions[A]">ConcurrentRestrictions</a><span class="delimiter">[</span>A<span class="delimiter">]</span> =
    <span class="delimiter">{</span>
      <span title="(assertion: Boolean, message: =&gt; Any)Unit">assert</span><span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.limitTotal.i" title="Int">i</a> <span title="(x: Int)Boolean">&gt;=</span> <span title="Int(1)" class="int">1</span>, <span title="String(&quot;Maximum must be at least 1 (was &quot;)" class="string">&quot;Maximum must be at least 1 (was &quot;</span> <span title="(x$1: Any)String">+</span> <a href="#sbt.ConcurrentRestrictions.limitTotal.i" title="Int">i</a> <span title="(x$1: Any)String">+</span> <span title="String(&quot;)&quot;)" class="string">&quot;)&quot;</span><span class="delimiter">)</span>
      <a href="#sbt.ConcurrentRestrictions.limitTotal;$anon" title="sbt.ConcurrentRestrictions[A]" class="keyword">new</a> <a title="anonymous class $anon extends AnyRef with sbt.ConcurrentRestrictions[A]" id="sbt.ConcurrentRestrictions.limitTotal;$anon">ConcurrentRestrictions</a><span class="delimiter">[</span>A<span class="delimiter">]</span> <span class="delimiter">{</span>
        <span class="keyword">type</span> <a title="Int" id="sbt.ConcurrentRestrictions.limitTotal;$anon;G">G</a> = <span title="Int">Int</span>
        <span class="keyword">def</span> <a title="=&gt; Int" id="sbt.ConcurrentRestrictions.limitTotal;$anon.empty">empty</a> = <span title="Int(0)" class="int">0</span>
        <span class="keyword">def</span> <a title="(g: Int, a: A)Int" id="sbt.ConcurrentRestrictions.limitTotal;$anon.add">add</a><span class="delimiter">(</span><a title="Int" id="sbt.ConcurrentRestrictions.limitTotal;$anon.add.g">g</a>: <span title="Int">Int</span>, <a title="A" id="sbt.ConcurrentRestrictions.limitTotal;$anon.add.a">a</a>: <a href="#sbt.ConcurrentRestrictions.limitTotal;A" title="A">A</a><span class="delimiter">)</span> = <a href="#sbt.ConcurrentRestrictions.limitTotal;$anon.add.g" title="Int">g</a> <span title="(x: Int)Int">+</span> <span title="Int(1)" class="int">1</span>
        <span class="keyword">def</span> <a title="(g: Int, a: A)Int" id="sbt.ConcurrentRestrictions.limitTotal;$anon.remove">remove</a><span class="delimiter">(</span><a title="Int" id="sbt.ConcurrentRestrictions.limitTotal;$anon.remove.g">g</a>: <span title="Int">Int</span>, <a title="A" id="sbt.ConcurrentRestrictions.limitTotal;$anon.remove.a">a</a>: <a href="#sbt.ConcurrentRestrictions.limitTotal;A" title="A">A</a><span class="delimiter">)</span> = <a href="#sbt.ConcurrentRestrictions.limitTotal;$anon.remove.g" title="Int">g</a> <span title="(x: Int)Int">-</span> <span title="Int(1)" class="int">1</span>
        <span class="keyword">def</span> <a title="(g: Int)Boolean" id="sbt.ConcurrentRestrictions.limitTotal;$anon.valid">valid</a><span class="delimiter">(</span><a title="Int" id="sbt.ConcurrentRestrictions.limitTotal;$anon.valid.g">g</a>: <span title="Int">Int</span><span class="delimiter">)</span> = <a href="#sbt.ConcurrentRestrictions.limitTotal;$anon.valid.g" title="Int">g</a> <span title="(x: Int)Boolean">&lt;=</span> <a href="#sbt.ConcurrentRestrictions.limitTotal.i" title="Int">i</a>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

  <span class="comment">/** A key object used for associating information with a task.*/</span>
  <span class="keyword">final</span> <span class="keyword">case class</span> <a title="class Tag extends AnyRef with Product with Serializable" id="sbt.ConcurrentRestrictions.Tag.readResolve">Tag</a><a href="#sbt.ConcurrentRestrictions.Tag.readResolve" title="Product" class="delimiter">(</a><a title="String" id="sbt.ConcurrentRestrictions;Tag.name">name</a>: <span title="String">String</span><span class="delimiter">)</span>

  <span class="keyword">val</span> <a title="sbt.AttributeKey[sbt.ConcurrentRestrictions.TagMap]" id="sbt.ConcurrentRestrictions.tagsKey">tagsKey</a> = <a href="Attributes.scala.html#sbt.AttributeKey.apply(c0ed3a5cd7)" title="[T](name: String, description: String)(implicit mf: scala.reflect.Manifest[T])sbt.AttributeKey[T]">AttributeKey</a><span title="(name: String, description: String)(implicit mf: scala.reflect.Manifest[sbt.ConcurrentRestrictions.TagMap])sbt.AttributeKey[sbt.ConcurrentRestrictions.TagMap]" class="delimiter">[</span><span title="sbt.ConcurrentRestrictions.TagMap">TagMap</span><span class="delimiter">]</span><span title="(clazz: Class[sbt.ConcurrentRestrictions.TagMap], arg1: scala.reflect.Manifest[_], args: scala.reflect.Manifest[_]*)scala.reflect.Manifest[sbt.ConcurrentRestrictions.TagMap]" class="delimiter">(</span><span title="String(&quot;tags&quot;)" class="string">&quot;tags&quot;</span>, <span title="String(&quot;Attributes restricting concurrent execution of tasks.&quot;)" class="string">&quot;Attributes restricting concurrent execution of tasks.&quot;</span><span class="delimiter">)</span>

  <span class="comment">/** A standard tag describing the number of tasks that do not otherwise have any tags.*/</span>
  <span class="keyword">val</span> <a title="sbt.ConcurrentRestrictions.Tag" id="sbt.ConcurrentRestrictions.Untagged">Untagged</a> = <a href="#sbt.ConcurrentRestrictions.Tag.readResolve" title="(name: String)sbt.ConcurrentRestrictions.Tag">Tag</a><span class="delimiter">(</span><span title="String(&quot;untagged&quot;)" class="string">&quot;untagged&quot;</span><span class="delimiter">)</span>

  <span class="comment">/** A standard tag describing the total number of tasks. */</span>
  <span class="keyword">val</span> <a title="sbt.ConcurrentRestrictions.Tag" id="sbt.ConcurrentRestrictions.All">All</a> = <a href="#sbt.ConcurrentRestrictions.Tag.readResolve" title="(name: String)sbt.ConcurrentRestrictions.Tag">Tag</a><span class="delimiter">(</span><span title="String(&quot;all&quot;)" class="string">&quot;all&quot;</span><span class="delimiter">)</span>

  <span class="keyword">type</span> <a title="Map[sbt.ConcurrentRestrictions.Tag,Int]" id="sbt.ConcurrentRestrictions;TagMap">TagMap</a> = <span title="Map[sbt.ConcurrentRestrictions.Tag,Int]">Map</span><span class="delimiter">[</span>Tag, Int<span class="delimiter">]</span>

  <span class="comment">/**
   * Implements concurrency restrictions on tasks based on Tags.
   * @tparam A type of a task
   * @param get extracts tags from a task
   * @param validF defines whether a set of tasks are allowed to execute concurrently based on their merged tags
   */</span>
  <span class="keyword">def</span> <a title="[A](get: A =&gt; sbt.ConcurrentRestrictions.TagMap, validF: sbt.ConcurrentRestrictions.TagMap =&gt; Boolean)sbt.ConcurrentRestrictions[A]" id="sbt.ConcurrentRestrictions.tagged">tagged</a><span class="delimiter">[</span><a title="" id="sbt.ConcurrentRestrictions.tagged;A">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="A =&gt; sbt.ConcurrentRestrictions.TagMap" id="sbt.ConcurrentRestrictions.tagged.get">get</a>: A =&gt; TagMap, <a title="sbt.ConcurrentRestrictions.TagMap =&gt; Boolean" id="sbt.ConcurrentRestrictions.tagged.validF">validF</a>: TagMap =&gt; Boolean<span class="delimiter">)</span>: <a href="#sbt;ConcurrentRestrictions" title="sbt.ConcurrentRestrictions[A]">ConcurrentRestrictions</a><span class="delimiter">[</span>A<span class="delimiter">]</span> =
    <a href="#sbt.ConcurrentRestrictions.tagged;$anon" title="sbt.ConcurrentRestrictions[A]" class="keyword">new</a> <a title="anonymous class $anon extends AnyRef with sbt.ConcurrentRestrictions[A]" id="sbt.ConcurrentRestrictions.tagged;$anon">ConcurrentRestrictions</a><span class="delimiter">[</span>A<span class="delimiter">]</span> <span class="delimiter">{</span>
      <span class="keyword">type</span> <a title="sbt.ConcurrentRestrictions.TagMap" id="sbt.ConcurrentRestrictions.tagged;$anon;G">G</a> = <span title="sbt.ConcurrentRestrictions.TagMap">TagMap</span>
      <span class="keyword">def</span> <a title="=&gt; scala.collection.immutable.Map[sbt.ConcurrentRestrictions.Tag,Nothing]" id="sbt.ConcurrentRestrictions.tagged;$anon.empty">empty</a> = <span title="=&gt; scala.collection.immutable.Map.type">Map</span>.<span title="scala.collection.immutable.Map[sbt.ConcurrentRestrictions.Tag,Nothing]">empty</span>
      <span class="keyword">def</span> <a title="(g: sbt.ConcurrentRestrictions.TagMap, a: A)sbt.ConcurrentRestrictions.TagMap" id="sbt.ConcurrentRestrictions.tagged;$anon.add">add</a><span class="delimiter">(</span><a title="sbt.ConcurrentRestrictions.TagMap" id="sbt.ConcurrentRestrictions.tagged;$anon.add.g">g</a>: <span title="sbt.ConcurrentRestrictions.TagMap">TagMap</span>, <a title="A" id="sbt.ConcurrentRestrictions.tagged;$anon.add.a">a</a>: <a href="#sbt.ConcurrentRestrictions.tagged;A" title="A">A</a><span class="delimiter">)</span> = <a href="#sbt.ConcurrentRestrictions.merge(3f1969fd6e)" title="(m: sbt.ConcurrentRestrictions.TagMap, a: A, get: A =&gt; sbt.ConcurrentRestrictions.TagMap)(f: (Int, Int) =&gt; Int)sbt.ConcurrentRestrictions.TagMap">merge</a><span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.tagged;$anon.add.g" title="sbt.ConcurrentRestrictions.TagMap">g</a>, <a href="#sbt.ConcurrentRestrictions.tagged;$anon.add.a" title="A">a</a>, <a href="#sbt.ConcurrentRestrictions.tagged.get" title="A =&gt; sbt.ConcurrentRestrictions.TagMap">get</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.tagged;$anon.add.$anonfun.x$1" title="Int">_</a> <span title="(x: Int)Int">+</span> <a href="#sbt.ConcurrentRestrictions.tagged;$anon.add.$anonfun.x$2" title="Int">_</a><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="(g: sbt.ConcurrentRestrictions.TagMap, a: A)sbt.ConcurrentRestrictions.TagMap" id="sbt.ConcurrentRestrictions.tagged;$anon.remove">remove</a><span class="delimiter">(</span><a title="sbt.ConcurrentRestrictions.TagMap" id="sbt.ConcurrentRestrictions.tagged;$anon.remove.g">g</a>: <span title="sbt.ConcurrentRestrictions.TagMap">TagMap</span>, <a title="A" id="sbt.ConcurrentRestrictions.tagged;$anon.remove.a">a</a>: <a href="#sbt.ConcurrentRestrictions.tagged;A" title="A">A</a><span class="delimiter">)</span> = <a href="#sbt.ConcurrentRestrictions.merge(3f1969fd6e)" title="(m: sbt.ConcurrentRestrictions.TagMap, a: A, get: A =&gt; sbt.ConcurrentRestrictions.TagMap)(f: (Int, Int) =&gt; Int)sbt.ConcurrentRestrictions.TagMap">merge</a><span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.tagged;$anon.remove.g" title="sbt.ConcurrentRestrictions.TagMap">g</a>, <a href="#sbt.ConcurrentRestrictions.tagged;$anon.remove.a" title="A">a</a>, <a href="#sbt.ConcurrentRestrictions.tagged.get" title="A =&gt; sbt.ConcurrentRestrictions.TagMap">get</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.tagged;$anon.remove.$anonfun.x$3" title="Int">_</a> <span title="(x: Int)Int">-</span> <a href="#sbt.ConcurrentRestrictions.tagged;$anon.remove.$anonfun.x$4" title="Int">_</a><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="(g: sbt.ConcurrentRestrictions.TagMap)Boolean" id="sbt.ConcurrentRestrictions.tagged;$anon.valid">valid</a><span class="delimiter">(</span><a title="sbt.ConcurrentRestrictions.TagMap" id="sbt.ConcurrentRestrictions.tagged;$anon.valid.g">g</a>: <span title="sbt.ConcurrentRestrictions.TagMap">TagMap</span><span class="delimiter">)</span> = <a href="#sbt.ConcurrentRestrictions.tagged.validF" title="(v1: sbt.ConcurrentRestrictions.TagMap)Boolean">validF</a><span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.tagged;$anon.valid.g" title="sbt.ConcurrentRestrictions.TagMap">g</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">def</span> <a title="[A](m: sbt.ConcurrentRestrictions.TagMap, a: A, get: A =&gt; sbt.ConcurrentRestrictions.TagMap)(f: (Int, Int) =&gt; Int)sbt.ConcurrentRestrictions.TagMap" id="sbt.ConcurrentRestrictions.merge(3f1969fd6e)">merge</a><span class="delimiter">[</span><a title="" id="sbt.ConcurrentRestrictions.merge(3f1969fd6e);A">A</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="sbt.ConcurrentRestrictions.TagMap" id="sbt.ConcurrentRestrictions.merge(3f1969fd6e).m">m</a>: <span title="sbt.ConcurrentRestrictions.TagMap">TagMap</span>, <a title="A" id="sbt.ConcurrentRestrictions.merge(3f1969fd6e).a">a</a>: <a href="#sbt.ConcurrentRestrictions.merge(3f1969fd6e);A" title="A">A</a>, <a title="A =&gt; sbt.ConcurrentRestrictions.TagMap" id="sbt.ConcurrentRestrictions.merge(3f1969fd6e).get">get</a>: A =&gt; TagMap<span class="delimiter">)</span><span class="delimiter">(</span><a title="(Int, Int) =&gt; Int" id="sbt.ConcurrentRestrictions.merge(3f1969fd6e).f">f</a>: <span class="delimiter">(</span>Int, Int<span class="delimiter">)</span> =&gt; Int<span class="delimiter">)</span>: <span title="sbt.ConcurrentRestrictions.TagMap">TagMap</span> =
    <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="sbt.ConcurrentRestrictions.TagMap" id="sbt.ConcurrentRestrictions.merge(3f1969fd6e).aTags">aTags</a> = <a href="#sbt.ConcurrentRestrictions.merge(3f1969fd6e).get" title="(v1: A)sbt.ConcurrentRestrictions.TagMap">get</a><span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.merge(3f1969fd6e).a" title="A">a</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Map[sbt.ConcurrentRestrictions.Tag,Int]" id="sbt.ConcurrentRestrictions.merge(3f1969fd6e).base">base</a> = <a href="#sbt.ConcurrentRestrictions.merge(49f8e6b58d)" title="(m: Map[sbt.ConcurrentRestrictions.Tag,Int], n: Map[sbt.ConcurrentRestrictions.Tag,Int])(f: (Int, Int) =&gt; Int)Map[sbt.ConcurrentRestrictions.Tag,Int]">merge</a><span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.merge(3f1969fd6e).m" title="sbt.ConcurrentRestrictions.TagMap">m</a>, <a href="#sbt.ConcurrentRestrictions.merge(3f1969fd6e).aTags" title="sbt.ConcurrentRestrictions.TagMap">aTags</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.merge(3f1969fd6e).f" title="(Int, Int) =&gt; Int">f</a><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="Map[sbt.ConcurrentRestrictions.Tag,Int]" id="sbt.ConcurrentRestrictions.merge(3f1969fd6e).un">un</a> = <span title="Map[sbt.ConcurrentRestrictions.Tag,Int]" class="keyword">if</span> <span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.merge(3f1969fd6e).aTags" title="sbt.ConcurrentRestrictions.TagMap">aTags</a>.<span title="=&gt; Boolean">isEmpty</span><span class="delimiter">)</span> <a href="#sbt.ConcurrentRestrictions.update" title="(m: Map[sbt.ConcurrentRestrictions.Tag,Int], a: sbt.ConcurrentRestrictions.Tag, b: Int)(f: (Int, Int) =&gt; Int)Map[sbt.ConcurrentRestrictions.Tag,Int]">update</a><span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.merge(3f1969fd6e).base" title="Map[sbt.ConcurrentRestrictions.Tag,Int]">base</a>, <a href="#sbt.ConcurrentRestrictions.Untagged" title="=&gt; sbt.ConcurrentRestrictions.Tag">Untagged</a>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.merge(3f1969fd6e).f" title="(Int, Int) =&gt; Int">f</a><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#sbt.ConcurrentRestrictions.merge(3f1969fd6e).base" title="Map[sbt.ConcurrentRestrictions.Tag,Int]">base</a>
      <a href="#sbt.ConcurrentRestrictions.update" title="(m: Map[sbt.ConcurrentRestrictions.Tag,Int], a: sbt.ConcurrentRestrictions.Tag, b: Int)(f: (Int, Int) =&gt; Int)Map[sbt.ConcurrentRestrictions.Tag,Int]">update</a><span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.merge(3f1969fd6e).un" title="Map[sbt.ConcurrentRestrictions.Tag,Int]">un</a>, <a href="#sbt.ConcurrentRestrictions.All" title="=&gt; sbt.ConcurrentRestrictions.Tag">All</a>, <span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.merge(3f1969fd6e).f" title="(Int, Int) =&gt; Int">f</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">def</span> <a title="[A, B](m: Map[A,B], a: A, b: B)(f: (B, B) =&gt; B)Map[A,B]" id="sbt.ConcurrentRestrictions.update">update</a><span class="delimiter">[</span><a title="" id="sbt.ConcurrentRestrictions.update;A">A</a>, <a title="" id="sbt.ConcurrentRestrictions.update;B">B</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="Map[A,B]" id="sbt.ConcurrentRestrictions.update.m">m</a>: <span title="Map[A,B]">Map</span><span class="delimiter">[</span>A, B<span class="delimiter">]</span>, <a title="A" id="sbt.ConcurrentRestrictions.update.a">a</a>: <a href="#sbt.ConcurrentRestrictions.update;A" title="A">A</a>, <a title="B" id="sbt.ConcurrentRestrictions.update.b">b</a>: <a href="#sbt.ConcurrentRestrictions.update;B" title="B">B</a><span class="delimiter">)</span><span class="delimiter">(</span><a title="(B, B) =&gt; B" id="sbt.ConcurrentRestrictions.update.f">f</a>: <span class="delimiter">(</span>B, B<span class="delimiter">)</span> =&gt; B<span class="delimiter">)</span>: <span title="Map[A,B]">Map</span><span class="delimiter">[</span>A, B<span class="delimiter">]</span> =
    <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="B" id="sbt.ConcurrentRestrictions.update.newb">newb</a> =
        <span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.update.m" title="Map[A,B]">m</a> <span title="(key: A)Option[B]">get</span> <a href="#sbt.ConcurrentRestrictions.update.a" title="A">a</a><span class="delimiter">)</span> <span title="B" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> Some<span class="delimiter">(</span><a title="B" id="sbt.ConcurrentRestrictions.update.newb.bv">bv</a><span class="delimiter">)</span> =&gt; <a href="#sbt.ConcurrentRestrictions.update.f" title="(v1: B, v2: B)B">f</a><span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.update.newb.bv" title="B">bv</a>, <a href="#sbt.ConcurrentRestrictions.update.b" title="B">b</a><span class="delimiter">)</span>
          <span class="keyword">case</span> <span title="None.type">None</span>     =&gt; <a href="#sbt.ConcurrentRestrictions.update.b" title="B">b</a>
        <span class="delimiter">}</span>
      <a href="#sbt.ConcurrentRestrictions.update.m" title="Map[A,B]">m</a>.<span title="(key: A, value: B)scala.collection.immutable.Map[A,B]">updated</span><span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.update.a" title="A">a</a>, <a href="#sbt.ConcurrentRestrictions.update.newb" title="B">newb</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">def</span> <a title="[A, B](m: Map[A,B], n: Map[A,B])(f: (B, B) =&gt; B)Map[A,B]" id="sbt.ConcurrentRestrictions.merge(49f8e6b58d)">merge</a><span class="delimiter">[</span><a title="" id="sbt.ConcurrentRestrictions.merge(49f8e6b58d);A">A</a>, <a title="" id="sbt.ConcurrentRestrictions.merge(49f8e6b58d);B">B</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="Map[A,B]" id="sbt.ConcurrentRestrictions.merge(49f8e6b58d).m">m</a>: <span title="Map[A,B]">Map</span><span class="delimiter">[</span>A, B<span class="delimiter">]</span>, <a title="Map[A,B]" id="sbt.ConcurrentRestrictions.merge(49f8e6b58d).n">n</a>: <span title="Map[A,B]">Map</span><span class="delimiter">[</span>A, B<span class="delimiter">]</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="(B, B) =&gt; B" id="sbt.ConcurrentRestrictions.merge(49f8e6b58d).f">f</a>: <span class="delimiter">(</span>B, B<span class="delimiter">)</span> =&gt; B<span class="delimiter">)</span>: <span title="Map[A,B]">Map</span><span class="delimiter">[</span>A, B<span class="delimiter">]</span> =
    <span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.merge(49f8e6b58d).m" title="Map[A,B]">m</a> <a href="#sbt.ConcurrentRestrictions.merge(49f8e6b58d).x$5" title="(z: Map[A,B])(op: (Map[A,B], (A, B)) =&gt; Map[A,B])Map[A,B]">/:</a> <a href="#sbt.ConcurrentRestrictions.merge(49f8e6b58d).n" title="Map[A,B]">n</a><span class="delimiter">)</span> <a href="#sbt.ConcurrentRestrictions.merge(49f8e6b58d).$anonfun.x0$1" title="Map[A,B]" class="delimiter">{</a> <span class="keyword">case</span> <span class="delimiter">(</span><a title="Map[A,B]" id="sbt.ConcurrentRestrictions.merge(49f8e6b58d).$anonfun.acc">acc</a>, <span class="delimiter">(</span><a title="A" id="sbt.ConcurrentRestrictions.merge(49f8e6b58d).$anonfun.a">a</a>, <a title="B" id="sbt.ConcurrentRestrictions.merge(49f8e6b58d).$anonfun.b">b</a><span class="delimiter">)</span><span class="delimiter">)</span> =&gt; <a href="#sbt.ConcurrentRestrictions.update" title="(m: Map[A,B], a: A, b: B)(f: (B, B) =&gt; B)Map[A,B]">update</a><span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.merge(49f8e6b58d).$anonfun.acc" title="Map[A,B]">acc</a>, <a href="#sbt.ConcurrentRestrictions.merge(49f8e6b58d).$anonfun.a" title="A">a</a>, <a href="#sbt.ConcurrentRestrictions.merge(49f8e6b58d).$anonfun.b" title="B">b</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.merge(49f8e6b58d).f" title="(B, B) =&gt; B">f</a><span class="delimiter">)</span> <span class="delimiter">}</span>

  <span class="comment">/**
   * Constructs a CompletionService suitable for backing task execution based on the provided restrictions on concurrent task execution.
   * @return a pair, with _1 being the CompletionService and _2 a function to shutdown the service.
   * @tparam A the task type
   * @tparam G describes a set of tasks
   * @tparam R the type of data that will be computed by the CompletionService.
   */</span>
  <span class="keyword">def</span> <a title="[A, R](tags: sbt.ConcurrentRestrictions[A], warn: String =&gt; Unit)(sbt.CompletionService[A,R], () =&gt; Unit)" id="sbt.ConcurrentRestrictions.completionService(d632435aac)">completionService</a><span class="delimiter">[</span><a title="" id="sbt.ConcurrentRestrictions.completionService(d632435aac);A">A</a>, <a title="" id="sbt.ConcurrentRestrictions.completionService(d632435aac);R">R</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="sbt.ConcurrentRestrictions[A]" id="sbt.ConcurrentRestrictions.completionService(d632435aac).tags">tags</a>: <a href="#sbt;ConcurrentRestrictions" title="sbt.ConcurrentRestrictions[A]">ConcurrentRestrictions</a><span class="delimiter">[</span>A<span class="delimiter">]</span>, <a title="String =&gt; Unit" id="sbt.ConcurrentRestrictions.completionService(d632435aac).warn">warn</a>: String =&gt; Unit<span class="delimiter">)</span>: <span title="(sbt.CompletionService[A,R], () =&gt; Unit)" class="delimiter">(</span>CompletionService<span class="delimiter">[</span>A, R<span class="delimiter">]</span>, <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; Unit<span class="delimiter">)</span> =
    <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="java.util.concurrent.ExecutorService" id="sbt.ConcurrentRestrictions.completionService(d632435aac).pool">pool</a> = <span title="java.util.concurrent.Executors.type">Executors</span>.<span title="()java.util.concurrent.ExecutorService">newCachedThreadPool</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span title="(_1: sbt.CompletionService[A,R], _2: () =&gt; Unit)(sbt.CompletionService[A,R], () =&gt; Unit)" class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96)" title="[A, R](backing: java.util.concurrent.Executor, tags: sbt.ConcurrentRestrictions[A], warn: String =&gt; Unit)sbt.CompletionService[A,R]">completionService</a><span title="(backing: java.util.concurrent.Executor, tags: sbt.ConcurrentRestrictions[A], warn: String =&gt; Unit)sbt.CompletionService[A,R]" class="delimiter">[</span><a href="#sbt.ConcurrentRestrictions.completionService(d632435aac);A" title="A">A</a>, <a href="#sbt.ConcurrentRestrictions.completionService(d632435aac);R" title="R">R</a><span class="delimiter">]</span><span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.completionService(d632435aac).pool" title="java.util.concurrent.ExecutorService">pool</a>, <a href="#sbt.ConcurrentRestrictions.completionService(d632435aac).tags" title="sbt.ConcurrentRestrictions[A]">tags</a>, <a href="#sbt.ConcurrentRestrictions.completionService(d632435aac).warn" title="String =&gt; Unit">warn</a><span class="delimiter">)</span>, <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <a href="#sbt.ConcurrentRestrictions.completionService(d632435aac).pool" title="java.util.concurrent.ExecutorService">pool</a>.<span title="()java.util.List[Runnable]">shutdownNow</span><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="comment">/**
   * Constructs a CompletionService suitable for backing task execution based on the provided restrictions on concurrent task execution
   * and using the provided Executor to manage execution on threads.
   */</span>
  <span class="keyword">def</span> <a title="[A, R](backing: java.util.concurrent.Executor, tags: sbt.ConcurrentRestrictions[A], warn: String =&gt; Unit)sbt.CompletionService[A,R]" id="sbt.ConcurrentRestrictions.completionService(80ffd1cf96)">completionService</a><span class="delimiter">[</span><a title="" id="sbt.ConcurrentRestrictions.completionService(80ffd1cf96);A">A</a>, <a title="" id="sbt.ConcurrentRestrictions.completionService(80ffd1cf96);R">R</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="java.util.concurrent.Executor" id="sbt.ConcurrentRestrictions.completionService(80ffd1cf96).backing">backing</a>: <span title="java.util.concurrent.Executor">Executor</span>, <a title="sbt.ConcurrentRestrictions[A]" id="sbt.ConcurrentRestrictions.completionService(80ffd1cf96).tags">tags</a>: <a href="#sbt;ConcurrentRestrictions" title="sbt.ConcurrentRestrictions[A]">ConcurrentRestrictions</a><span class="delimiter">[</span>A<span class="delimiter">]</span>, <a title="String =&gt; Unit" id="sbt.ConcurrentRestrictions.completionService(80ffd1cf96).warn">warn</a>: String =&gt; Unit<span class="delimiter">)</span>: <a href="CompletionService.scala.html#sbt;CompletionService" title="sbt.CompletionService[A,R]">CompletionService</a><span class="delimiter">[</span>A, R<span class="delimiter">]</span> =
    <span class="delimiter">{</span>
      <span class="comment">/** Represents submitted work for a task.*/</span>
      <span class="keyword">final</span> <span class="keyword">class</span> <a title="class Enqueue extends AnyRef" id="sbt.ConcurrentRestrictions.completionService(80ffd1cf96);Enqueue">Enqueue</a><a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);Enqueue" title="Enqueue" class="delimiter">(</a><span class="keyword">val</span> <a title="A" id="sbt.ConcurrentRestrictions.completionService(80ffd1cf96);Enqueue.node">node</a>: <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);A" title="A">A</a>, <span class="keyword">val</span> <a title="() =&gt; R" id="sbt.ConcurrentRestrictions.completionService(80ffd1cf96);Enqueue.work">work</a>: <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; R<span class="delimiter">)</span>

      <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon" title="sbt.CompletionService[A,R]{}" class="keyword">new</a> <a title="anonymous class $anon extends AnyRef with sbt.CompletionService[A,R]" id="sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon">CompletionService</a><span class="delimiter">[</span>A, R<span class="delimiter">]</span> <span class="delimiter">{</span>
        <span class="comment">/** Backing service used to manage execution on threads once all constraints are satisfied. */</span>
        <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">val</span> <a title="java.util.concurrent.ExecutorCompletionService[R]" id="sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.jservice">jservice</a> = <span title="java.util.concurrent.ExecutorCompletionService[R]" class="keyword">new</span> <span title="java.util.concurrent.ExecutorCompletionService[R]">ExecutorCompletionService</span><span class="delimiter">[</span>R<span class="delimiter">]</span><span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96).backing" title="java.util.concurrent.Executor">backing</a><span class="delimiter">)</span>
        <span class="comment">/** The description of the currently running tasks, used by `tags` to manage restrictions.*/</span>
        <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">var</span> <a title="tags.G" id="sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.tagState">tagState</a> = <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96).tags" title="sbt.ConcurrentRestrictions[A]">tags</a>.<a href="#sbt;ConcurrentRestrictions.empty" title="=&gt; tags.G">empty</a>
        <span class="comment">/** The number of running tasks. */</span>
        <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">var</span> <a title="Int" id="sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.running">running</a> = <span title="Int(0)" class="int">0</span>
        <span class="comment">/** Tasks that cannot be run yet because they cannot execute concurrently with the currently running tasks.*/</span>
        <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">val</span> <a title="java.util.LinkedList[Enqueue]" id="sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.pending">pending</a> = <span title="java.util.LinkedList[Enqueue]" class="keyword">new</span> <span title="java.util.LinkedList[Enqueue]">LinkedList</span><span class="delimiter">[</span>Enqueue<span class="delimiter">]</span>

        <span class="keyword">def</span> <a title="(node: A, work: () =&gt; R)Unit" id="sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submit">submit</a><span class="delimiter">(</span><a title="A" id="sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submit.node">node</a>: <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);A" title="A">A</a>, <a title="() =&gt; R" id="sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submit.work">work</a>: <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; R<span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon" title="(x$1: Any)Any">synchronized</a> <span title="Unit" class="delimiter">{</span>
          <span class="keyword">val</span> <a title="tags.G" id="sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submit.newState">newState</a> = <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96).tags" title="sbt.ConcurrentRestrictions[A]">tags</a>.<a href="#sbt;ConcurrentRestrictions.add" title="(g: tags.G, a: A)tags.G">add</a><span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.tagState" title="tags.G">tagState</a>, <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submit.node" title="A">node</a><span class="delimiter">)</span>
          <span class="comment">// if the new task is allowed to run concurrently with the currently running tasks,</span>
          <span class="comment">//   submit it to be run by the backing j.u.c.CompletionService</span>
          <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96).tags" title="sbt.ConcurrentRestrictions[A]">tags</a> <a href="#sbt;ConcurrentRestrictions.valid" title="(g: tags.G)Boolean">valid</a> <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submit.newState" title="tags.G">newState</a><span class="delimiter">)</span> <span class="delimiter">{</span>
            <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.tagState" title="tags.G">tagState</a> = <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submit.newState" title="tags.G">newState</a>
            <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submitValid(dfa38f5664)" title="(node: A, work: () =&gt; R)() =&gt; R">submitValid</a><span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submit.node" title="A">node</a>, <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submit.work" title="() =&gt; R">work</a><span class="delimiter">)</span>
          <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.running" title="Int">running</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.errorAddingToIdle" title="()Unit">errorAddingToIdle</a><span class="delimiter">(</span><span class="delimiter">)</span>
            <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.pending" title="java.util.LinkedList[Enqueue]">pending</a>.<span title="(x$1: Enqueue)Boolean">add</span><span class="delimiter">(</span><span title="Enqueue" class="keyword">new</span> <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);Enqueue" title="Enqueue">Enqueue</a><span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submit.node" title="A">node</a>, <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submit.work" title="() =&gt; R">work</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="delimiter">}</span>
        <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">def</span> <a title="(node: A, work: () =&gt; R)() =&gt; R" id="sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submitValid(dfa38f5664)">submitValid</a><span class="delimiter">(</span><a title="A" id="sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submitValid(dfa38f5664).node">node</a>: <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);A" title="A">A</a>, <a title="() =&gt; R" id="sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submitValid(dfa38f5664).work">work</a>: <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; R<span class="delimiter">)</span> =
          <span class="delimiter">{</span>
            <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.running" title="Int">running</a> <span title="(x: Int)Int">+=</span> <span title="Int(1)" class="int">1</span>
            <span class="keyword">val</span> <a title="() =&gt; R" id="sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submitValid(dfa38f5664).wrappedWork">wrappedWork</a> = <span class="delimiter">(</span><span class="delimiter">)</span> =&gt; <span class="keyword">try</span> <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submitValid(dfa38f5664).work" title="()R">work</a><span class="delimiter">(</span><span class="delimiter">)</span> <span class="keyword">finally</span> <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.cleanup" title="(node: A)Unit">cleanup</a><span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submitValid(dfa38f5664).node" title="A">node</a><span class="delimiter">)</span>
            <a href="CompletionService.scala.html#sbt.CompletionService" title="sbt.CompletionService.type">CompletionService</a>.<a href="CompletionService.scala.html#sbt.CompletionService.submit" title="(work: () =&gt; R, completion: java.util.concurrent.CompletionService[R])() =&gt; R">submit</a><span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submitValid(dfa38f5664).wrappedWork" title="() =&gt; R">wrappedWork</a>, <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.jservice" title="java.util.concurrent.ExecutorCompletionService[R]">jservice</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>
        <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">def</span> <a title="(node: A)Unit" id="sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.cleanup">cleanup</a><span class="delimiter">(</span><a title="A" id="sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.cleanup.node">node</a>: <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);A" title="A">A</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon" title="(x$1: Unit)Unit">synchronized</a> <span class="delimiter">{</span>
          <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.running" title="Int">running</a> <span title="(x: Int)Int">-=</span> <span title="Int(1)" class="int">1</span>
          <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.tagState" title="tags.G">tagState</a> = <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96).tags" title="sbt.ConcurrentRestrictions[A]">tags</a>.<a href="#sbt;ConcurrentRestrictions.remove" title="(g: tags.G, a: A)tags.G">remove</a><span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.tagState" title="tags.G">tagState</a>, <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.cleanup.node" title="A">node</a><span class="delimiter">)</span>
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96).tags" title="sbt.ConcurrentRestrictions[A]">tags</a>.<a href="#sbt;ConcurrentRestrictions.valid" title="(g: tags.G)Boolean">valid</a><span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.tagState" title="tags.G">tagState</a><span class="delimiter">)</span><span class="delimiter">)</span> <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96).warn" title="(v1: String)Unit">warn</a><span class="delimiter">(</span><span title="String(&quot;Invalid restriction: removing a completed node from a valid system must result in a valid system.&quot;)" class="string">&quot;Invalid restriction: removing a completed node from a valid system must result in a valid system.&quot;</span><span class="delimiter">)</span>
          <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submitValid(2825fc57b6)" title="(tried: java.util.Queue[Enqueue])Unit">submitValid</a><span class="delimiter">(</span><span title="java.util.LinkedList[Enqueue]" class="keyword">new</span> <span title="java.util.LinkedList[Enqueue]">LinkedList</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
        <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">def</span> <a title="()Unit" id="sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.errorAddingToIdle">errorAddingToIdle</a><span class="delimiter">(</span><span class="delimiter">)</span> = <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96).warn" title="(v1: String)Unit">warn</a><span class="delimiter">(</span><span title="String(&quot;Invalid restriction: adding a node to an idle system must be allowed.&quot;)" class="string">&quot;Invalid restriction: adding a node to an idle system must be allowed.&quot;</span><span class="delimiter">)</span>

        <span class="comment">/** Submits pending tasks that are now allowed to executed. */</span>
        @tailrec <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">def</span> <a title="(tried: java.util.Queue[Enqueue])Unit" id="sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submitValid(2825fc57b6)">submitValid</a><span class="delimiter">(</span><a title="java.util.Queue[Enqueue]" id="sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submitValid(2825fc57b6).tried">tried</a>: <span title="java.util.Queue[Enqueue]">Queue</span><span class="delimiter">[</span>Enqueue<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> =
          <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.pending" title="java.util.LinkedList[Enqueue]">pending</a>.<span title="()Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
            <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submitValid(2825fc57b6).tried" title="java.util.Queue[Enqueue]">tried</a>.<span title="()Boolean">isEmpty</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.running" title="Int">running</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.errorAddingToIdle" title="()Unit">errorAddingToIdle</a><span class="delimiter">(</span><span class="delimiter">)</span>
              <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.pending" title="java.util.LinkedList[Enqueue]">pending</a>.<span title="(x$1: java.util.Collection[_ &lt;: Enqueue])Boolean">addAll</span><span title="Unit" class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submitValid(2825fc57b6).tried" title="java.util.Queue[Enqueue]">tried</a><span class="delimiter">)</span>
            <span class="delimiter">}</span>
          <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
            <span class="keyword">val</span> <a title="Enqueue" id="sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submitValid(2825fc57b6).next">next</a> = <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.pending" title="java.util.LinkedList[Enqueue]">pending</a>.<span title="()Enqueue">remove</span><span class="delimiter">(</span><span class="delimiter">)</span>
            <span class="keyword">val</span> <a title="tags.G" id="sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submitValid(2825fc57b6).newState">newState</a> = <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96).tags" title="sbt.ConcurrentRestrictions[A]">tags</a>.<a href="#sbt;ConcurrentRestrictions.add" title="(g: tags.G, a: A)tags.G">add</a><span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.tagState" title="tags.G">tagState</a>, <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submitValid(2825fc57b6).next" title="Enqueue">next</a>.<a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);Enqueue.node" title="=&gt; A">node</a><span class="delimiter">)</span>
            <span title="Any" class="keyword">if</span> <span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96).tags" title="sbt.ConcurrentRestrictions[A]">tags</a>.<a href="#sbt;ConcurrentRestrictions.valid" title="(g: tags.G)Boolean">valid</a><span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submitValid(2825fc57b6).newState" title="tags.G">newState</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
              <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.tagState" title="tags.G">tagState</a> = <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submitValid(2825fc57b6).newState" title="tags.G">newState</a>
              <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submitValid(dfa38f5664)" title="(node: A, work: () =&gt; R)() =&gt; R">submitValid</a><span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submitValid(2825fc57b6).next" title="Enqueue">next</a>.<a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);Enqueue.node" title="=&gt; A">node</a>, <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submitValid(2825fc57b6).next" title="Enqueue">next</a>.<a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);Enqueue.work" title="=&gt; () =&gt; R">work</a><span class="delimiter">)</span>
            <span class="delimiter">}</span> <span class="keyword">else</span>
              <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submitValid(2825fc57b6).tried" title="java.util.Queue[Enqueue]">tried</a>.<span title="(x$1: Enqueue)Boolean">add</span><span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submitValid(2825fc57b6).next" title="Enqueue">next</a><span class="delimiter">)</span>
            <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submitValid(2825fc57b6)" title="(tried: java.util.Queue[Enqueue])Unit">submitValid</a><span class="delimiter">(</span><a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.submitValid(2825fc57b6).tried" title="java.util.Queue[Enqueue]">tried</a><span class="delimiter">)</span>
          <span class="delimiter">}</span>

        <span class="keyword">def</span> <a title="()R" id="sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.take">take</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);R" title="R">R</a> = <a href="#sbt.ConcurrentRestrictions.completionService(80ffd1cf96);$anon.jservice" title="java.util.concurrent.ExecutorCompletionService[R]">jservice</a>.<span title="()java.util.concurrent.Future[R]">take</span><span class="delimiter">(</span><span class="delimiter">)</span>.<span title="()R">get</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
<span class="delimiter">}</span>
        </pre>
    </body>
</html>
