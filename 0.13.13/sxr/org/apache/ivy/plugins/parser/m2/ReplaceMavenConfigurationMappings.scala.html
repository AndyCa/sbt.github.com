<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>org/apache/ivy/plugins/parser/m2/ReplaceMavenConfigurationMappings.scala</title>
        <script type="text/javascript" src="../../../../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> org.apache.ivy.plugins.parser.m2

<span class="keyword">import</span> org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor;

<span class="comment">/**
 * It turns out there was a very subtle, and evil, issue sitting the Ivy/maven configuration, and it
 * related to dependency mapping.    A mapping of `foo-&gt;bar(*)` means that the local configuration
 * `foo` depends on the remote configuration `bar`, if it exists, or *ALL CONFIGURATIONS* if `bar`
 * does not exist.   Since the default Ivy configuration mapping was using the random `master`
 * configuration, which AFAICT is NEVER specified, just an assumed default, this would cause leaks
 * between maven + ivy projects.
 *
 * i.e. if  a maven POM depends on a module denoted by an ivy.xml file, then you'd wind up accidentally
 * bleeding ALL the ivy module's configurations into the maven module's configurations.
 *
 * This fix works around the issue, by assuming that if there is no `master` configuration, than the
 * maven default of `compile` is intended.   As sbt forces generated `ivy.xml` files to abide by
 * maven conventions, this works in all of our test cases.   The only scenario where it wouldn't work
 * is those who have custom ivy.xml files *and* have pom.xml files which rely on those custom ivy.xml files,
 * a very unlikely situation where the workaround is:  &quot;define a master configuration&quot;.
 *
 * Also see: http://ant.apache.org/ivy/history/2.3.0/ivyfile/dependency.html
 * and: http://svn.apache.org/repos/asf/ant/ivy/core/tags/2.3.0/src/java/org/apache/ivy/plugins/parser/m2/PomModuleDescriptorBuilder.java
 *
 *
 */</span>
<span class="keyword">object</span> <a title="org.apache.ivy.plugins.parser.m2.ReplaceMavenConfigurationMappings.type" id="org.apache.ivy.plugins.parser.m2.ReplaceMavenConfigurationMappings">ReplaceMavenConfigurationMappings</a> <a href="#org.apache.ivy.plugins.parser.m2.ReplaceMavenConfigurationMappings" title="org.apache.ivy.plugins.parser.m2.ReplaceMavenConfigurationMappings.type" class="delimiter">{</a>

  <span class="keyword">def</span> <a title="(dd: org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor, scope: String, isOptional: Boolean)Unit" id="org.apache.ivy.plugins.parser.m2.ReplaceMavenConfigurationMappings.addMappings">addMappings</a><span class="delimiter">(</span><a title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor" id="org.apache.ivy.plugins.parser.m2.ReplaceMavenConfigurationMappings.addMappings.dd">dd</a>: <span title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">DefaultDependencyDescriptor</span>, <a title="String" id="org.apache.ivy.plugins.parser.m2.ReplaceMavenConfigurationMappings.addMappings.scope">scope</a>: <span title="String">String</span>, <a title="Boolean" id="org.apache.ivy.plugins.parser.m2.ReplaceMavenConfigurationMappings.addMappings.isOptional">isOptional</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper" id="org.apache.ivy.plugins.parser.m2.ReplaceMavenConfigurationMappings.addMappings.mapping">mapping</a> = <a href="#org.apache.ivy.plugins.parser.m2.ReplaceMavenConfigurationMappings" title="org.apache.ivy.plugins.parser.m2.ReplaceMavenConfigurationMappings.type">ReplaceMavenConfigurationMappings</a>.<a href="#org.apache.ivy.plugins.parser.m2.ReplaceMavenConfigurationMappings.REPLACEMENT_MAVEN_MAPPINGS" title="=&gt; java.util.HashMap[String,org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper]">REPLACEMENT_MAVEN_MAPPINGS</a>.<span title="(x$1: Any)org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper">get</span><span class="delimiter">(</span><a href="#org.apache.ivy.plugins.parser.m2.ReplaceMavenConfigurationMappings.addMappings.scope" title="String">scope</a><span class="delimiter">)</span>
    <a href="#org.apache.ivy.plugins.parser.m2.ReplaceMavenConfigurationMappings.addMappings.mapping" title="org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper">mapping</a>.<span title="(x$1: org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor, x$2: Boolean)Unit">addMappingConfs</span><span class="delimiter">(</span><a href="#org.apache.ivy.plugins.parser.m2.ReplaceMavenConfigurationMappings.addMappings.dd" title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">dd</a>, <a href="#org.apache.ivy.plugins.parser.m2.ReplaceMavenConfigurationMappings.addMappings.isOptional" title="Boolean">isOptional</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">val</span> <a title="java.util.HashMap[String,org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper]" id="org.apache.ivy.plugins.parser.m2.ReplaceMavenConfigurationMappings.REPLACEMENT_MAVEN_MAPPINGS">REPLACEMENT_MAVEN_MAPPINGS</a> = <span class="delimiter">{</span>
    <span class="comment">// Here we copy paste from Ivy</span>
    <span class="keyword">val</span> <a title="java.util.HashMap[String,org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper]" id="org.apache.ivy.plugins.parser.m2.ReplaceMavenConfigurationMappings.REPLACEMENT_MAVEN_MAPPINGS.REPLACEMENT_MAPPINGS">REPLACEMENT_MAPPINGS</a> = <span title="()java.util.HashMap[String,org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper]" class="keyword">new</span> java.util.<span title="java.util.HashMap[String,org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper]">HashMap</span><span class="delimiter">[</span>String, PomModuleDescriptorBuilder.ConfMapper<span class="delimiter">]</span>

    <span class="comment">// NOTE - This code is copied from org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder</span>
    <span class="comment">// except with altered default configurations...</span>
    <a href="#org.apache.ivy.plugins.parser.m2.ReplaceMavenConfigurationMappings.REPLACEMENT_MAVEN_MAPPINGS.REPLACEMENT_MAPPINGS" title="java.util.HashMap[String,org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper]">REPLACEMENT_MAPPINGS</a>.<span title="(x$1: String, x$2: org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper)org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper">put</span><span class="delimiter">(</span><span title="String(&quot;compile&quot;)" class="string">&quot;compile&quot;</span>, <span title="org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper" class="keyword">new</span> <span title="anonymous class $anon extends Object with org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper">PomModuleDescriptorBuilder</span>.<span title="org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper">ConfMapper</span> <span class="delimiter">{</span>
      <span class="keyword">def</span> <span title="(dd: org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor, isOptional: Boolean)Unit">addMappingConfs</span><span class="delimiter">(</span><span title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">dd</span>: <span title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">DefaultDependencyDescriptor</span>, <span title="Boolean">isOptional</span>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="Boolean">isOptional</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">dd</span>.<span title="(x$1: String, x$2: String)Unit">addDependencyConfiguration</span><span class="delimiter">(</span><span title="String(&quot;optional&quot;)" class="string">&quot;optional&quot;</span>, <span title="String(&quot;compile(*)&quot;)" class="string">&quot;compile(*)&quot;</span><span class="delimiter">)</span>
          <span class="comment">// FIX - Here we take a mroe conservative approach of depending on the compile configuration if master isn't there.</span>
          <span title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">dd</span>.<span title="(x$1: String, x$2: String)Unit">addDependencyConfiguration</span><span class="delimiter">(</span><span title="String(&quot;optional&quot;)" class="string">&quot;optional&quot;</span>, <span title="String(&quot;master(compile)&quot;)" class="string">&quot;master(compile)&quot;</span><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">dd</span>.<span title="(x$1: String, x$2: String)Unit">addDependencyConfiguration</span><span class="delimiter">(</span><span title="String(&quot;compile&quot;)" class="string">&quot;compile&quot;</span>, <span title="String(&quot;compile(*)&quot;)" class="string">&quot;compile(*)&quot;</span><span class="delimiter">)</span>
          <span class="comment">// FIX - Here we take a mroe conservative approach of depending on the compile configuration if master isn't there.</span>
          <span title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">dd</span>.<span title="(x$1: String, x$2: String)Unit">addDependencyConfiguration</span><span class="delimiter">(</span><span title="String(&quot;compile&quot;)" class="string">&quot;compile&quot;</span>, <span title="String(&quot;master(compile)&quot;)" class="string">&quot;master(compile)&quot;</span><span class="delimiter">)</span>
          <span title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">dd</span>.<span title="(x$1: String, x$2: String)Unit">addDependencyConfiguration</span><span class="delimiter">(</span><span title="String(&quot;runtime&quot;)" class="string">&quot;runtime&quot;</span>, <span title="String(&quot;runtime(*)&quot;)" class="string">&quot;runtime(*)&quot;</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>
    <a href="#org.apache.ivy.plugins.parser.m2.ReplaceMavenConfigurationMappings.REPLACEMENT_MAVEN_MAPPINGS.REPLACEMENT_MAPPINGS" title="java.util.HashMap[String,org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper]">REPLACEMENT_MAPPINGS</a>.<span title="(x$1: String, x$2: org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper)org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper">put</span><span class="delimiter">(</span><span title="String(&quot;provided&quot;)" class="string">&quot;provided&quot;</span>, <span title="org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper" class="keyword">new</span> <span title="anonymous class $anon extends Object with org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper">PomModuleDescriptorBuilder</span>.<span title="org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper">ConfMapper</span> <span class="delimiter">{</span>
      <span class="keyword">def</span> <span title="(dd: org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor, isOptional: Boolean)Unit">addMappingConfs</span><span class="delimiter">(</span><span title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">dd</span>: <span title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">DefaultDependencyDescriptor</span>, <span title="Boolean">isOptional</span>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="Boolean">isOptional</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">dd</span>.<span title="(x$1: String, x$2: String)Unit">addDependencyConfiguration</span><span class="delimiter">(</span><span title="String(&quot;optional&quot;)" class="string">&quot;optional&quot;</span>, <span title="String(&quot;compile(*)&quot;)" class="string">&quot;compile(*)&quot;</span><span class="delimiter">)</span>
          <span title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">dd</span>.<span title="(x$1: String, x$2: String)Unit">addDependencyConfiguration</span><span class="delimiter">(</span><span title="String(&quot;optional&quot;)" class="string">&quot;optional&quot;</span>, <span title="String(&quot;provided(*)&quot;)" class="string">&quot;provided(*)&quot;</span><span class="delimiter">)</span>
          <span title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">dd</span>.<span title="(x$1: String, x$2: String)Unit">addDependencyConfiguration</span><span class="delimiter">(</span><span title="String(&quot;optional&quot;)" class="string">&quot;optional&quot;</span>, <span title="String(&quot;runtime(*)&quot;)" class="string">&quot;runtime(*)&quot;</span><span class="delimiter">)</span>
          <span class="comment">// FIX - Here we take a mroe conservative approach of depending on the compile configuration if master isn't there.</span>
          <span title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">dd</span>.<span title="(x$1: String, x$2: String)Unit">addDependencyConfiguration</span><span class="delimiter">(</span><span title="String(&quot;optional&quot;)" class="string">&quot;optional&quot;</span>, <span title="String(&quot;master(compile)&quot;)" class="string">&quot;master(compile)&quot;</span><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">dd</span>.<span title="(x$1: String, x$2: String)Unit">addDependencyConfiguration</span><span class="delimiter">(</span><span title="String(&quot;provided&quot;)" class="string">&quot;provided&quot;</span>, <span title="String(&quot;compile(*)&quot;)" class="string">&quot;compile(*)&quot;</span><span class="delimiter">)</span>
          <span title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">dd</span>.<span title="(x$1: String, x$2: String)Unit">addDependencyConfiguration</span><span class="delimiter">(</span><span title="String(&quot;provided&quot;)" class="string">&quot;provided&quot;</span>, <span title="String(&quot;provided(*)&quot;)" class="string">&quot;provided(*)&quot;</span><span class="delimiter">)</span>
          <span title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">dd</span>.<span title="(x$1: String, x$2: String)Unit">addDependencyConfiguration</span><span class="delimiter">(</span><span title="String(&quot;provided&quot;)" class="string">&quot;provided&quot;</span>, <span title="String(&quot;runtime(*)&quot;)" class="string">&quot;runtime(*)&quot;</span><span class="delimiter">)</span>
          <span class="comment">// FIX - Here we take a mroe conservative approach of depending on the compile configuration if master isn't there.</span>
          <span title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">dd</span>.<span title="(x$1: String, x$2: String)Unit">addDependencyConfiguration</span><span class="delimiter">(</span><span title="String(&quot;provided&quot;)" class="string">&quot;provided&quot;</span>, <span title="String(&quot;master(compile)&quot;)" class="string">&quot;master(compile)&quot;</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>

    <a href="#org.apache.ivy.plugins.parser.m2.ReplaceMavenConfigurationMappings.REPLACEMENT_MAVEN_MAPPINGS.REPLACEMENT_MAPPINGS" title="java.util.HashMap[String,org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper]">REPLACEMENT_MAPPINGS</a>.<span title="(x$1: String, x$2: org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper)org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper">put</span><span class="delimiter">(</span><span title="String(&quot;runtime&quot;)" class="string">&quot;runtime&quot;</span>, <span title="org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper" class="keyword">new</span> <span title="anonymous class $anon extends Object with org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper">PomModuleDescriptorBuilder</span>.<span title="org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper">ConfMapper</span> <span class="delimiter">{</span>
      <span class="keyword">def</span> <span title="(dd: org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor, isOptional: Boolean)Unit">addMappingConfs</span><span class="delimiter">(</span><span title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">dd</span>: <span title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">DefaultDependencyDescriptor</span>, <span title="Boolean">isOptional</span>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
        <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="Boolean">isOptional</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">dd</span>.<span title="(x$1: String, x$2: String)Unit">addDependencyConfiguration</span><span class="delimiter">(</span><span title="String(&quot;optional&quot;)" class="string">&quot;optional&quot;</span>, <span title="String(&quot;compile(*)&quot;)" class="string">&quot;compile(*)&quot;</span><span class="delimiter">)</span>
          <span title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">dd</span>.<span title="(x$1: String, x$2: String)Unit">addDependencyConfiguration</span><span class="delimiter">(</span><span title="String(&quot;optional&quot;)" class="string">&quot;optional&quot;</span>, <span title="String(&quot;provided(*)&quot;)" class="string">&quot;provided(*)&quot;</span><span class="delimiter">)</span>
          <span class="comment">// FIX - Here we take a mroe conservative approach of depending on the compile configuration if master isn't there.</span>
          <span title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">dd</span>.<span title="(x$1: String, x$2: String)Unit">addDependencyConfiguration</span><span class="delimiter">(</span><span title="String(&quot;optional&quot;)" class="string">&quot;optional&quot;</span>, <span title="String(&quot;master(compile)&quot;)" class="string">&quot;master(compile)&quot;</span><span class="delimiter">)</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">dd</span>.<span title="(x$1: String, x$2: String)Unit">addDependencyConfiguration</span><span class="delimiter">(</span><span title="String(&quot;runtime&quot;)" class="string">&quot;runtime&quot;</span>, <span title="String(&quot;compile(*)&quot;)" class="string">&quot;compile(*)&quot;</span><span class="delimiter">)</span>
          <span title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">dd</span>.<span title="(x$1: String, x$2: String)Unit">addDependencyConfiguration</span><span class="delimiter">(</span><span title="String(&quot;runtime&quot;)" class="string">&quot;runtime&quot;</span>, <span title="String(&quot;runtime(*)&quot;)" class="string">&quot;runtime(*)&quot;</span><span class="delimiter">)</span>
          <span class="comment">// FIX - Here we take a mroe conservative approach of depending on the compile configuration if master isn't there.</span>
          <span title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">dd</span>.<span title="(x$1: String, x$2: String)Unit">addDependencyConfiguration</span><span class="delimiter">(</span><span title="String(&quot;runtime&quot;)" class="string">&quot;runtime&quot;</span>, <span title="String(&quot;master(compile)&quot;)" class="string">&quot;master(compile)&quot;</span><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>

    <a href="#org.apache.ivy.plugins.parser.m2.ReplaceMavenConfigurationMappings.REPLACEMENT_MAVEN_MAPPINGS.REPLACEMENT_MAPPINGS" title="java.util.HashMap[String,org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper]">REPLACEMENT_MAPPINGS</a>.<span title="(x$1: String, x$2: org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper)org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper">put</span><span class="delimiter">(</span><span title="String(&quot;test&quot;)" class="string">&quot;test&quot;</span>, <span title="org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper" class="keyword">new</span> <span title="anonymous class $anon extends Object with org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper">PomModuleDescriptorBuilder</span>.<span title="org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper">ConfMapper</span> <span class="delimiter">{</span>
      <span class="keyword">def</span> <span title="(dd: org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor, isOptional: Boolean)Unit">addMappingConfs</span><span class="delimiter">(</span><span title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">dd</span>: <span title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">DefaultDependencyDescriptor</span>, <span title="Boolean">isOptional</span>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
        <span title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">dd</span>.<span title="(x$1: String, x$2: String)Unit">addDependencyConfiguration</span><span class="delimiter">(</span><span title="String(&quot;test&quot;)" class="string">&quot;test&quot;</span>, <span title="String(&quot;runtime(*)&quot;)" class="string">&quot;runtime(*)&quot;</span><span class="delimiter">)</span>
        <span class="comment">// FIX - Here we take a mroe conservative approach of depending on the compile configuration if master isn't there.</span>
        <span title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">dd</span>.<span title="(x$1: String, x$2: String)Unit">addDependencyConfiguration</span><span class="delimiter">(</span><span title="String(&quot;test&quot;)" class="string">&quot;test&quot;</span>, <span title="String(&quot;master(compile)&quot;)" class="string">&quot;master(compile)&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>

    <a href="#org.apache.ivy.plugins.parser.m2.ReplaceMavenConfigurationMappings.REPLACEMENT_MAVEN_MAPPINGS.REPLACEMENT_MAPPINGS" title="java.util.HashMap[String,org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper]">REPLACEMENT_MAPPINGS</a>.<span title="(x$1: String, x$2: org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper)org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper">put</span><span class="delimiter">(</span><span title="String(&quot;system&quot;)" class="string">&quot;system&quot;</span>, <span title="org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper" class="keyword">new</span> <span title="anonymous class $anon extends Object with org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper">PomModuleDescriptorBuilder</span>.<span title="org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper">ConfMapper</span> <span class="delimiter">{</span>
      <span class="keyword">def</span> <span title="(dd: org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor, isOptional: Boolean)Unit">addMappingConfs</span><span class="delimiter">(</span><span title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">dd</span>: <span title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">DefaultDependencyDescriptor</span>, <span title="Boolean">isOptional</span>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
        <span class="comment">// FIX - Here we take a mroe conservative approach of depending on the compile configuration if master isn't there.</span>
        <span title="org.apache.ivy.core.module.descriptor.DefaultDependencyDescriptor">dd</span>.<span title="(x$1: String, x$2: String)Unit">addDependencyConfiguration</span><span class="delimiter">(</span><span title="String(&quot;system&quot;)" class="string">&quot;system&quot;</span>, <span title="String(&quot;master(compile)&quot;)" class="string">&quot;master(compile)&quot;</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span><span class="delimiter">)</span>

    <a href="#org.apache.ivy.plugins.parser.m2.ReplaceMavenConfigurationMappings.REPLACEMENT_MAVEN_MAPPINGS.REPLACEMENT_MAPPINGS" title="java.util.HashMap[String,org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper]">REPLACEMENT_MAPPINGS</a>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="()Unit" id="org.apache.ivy.plugins.parser.m2.ReplaceMavenConfigurationMappings.init">init</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="comment">// Here we mutate a static final field, because we have to AND because it's evil.</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="java.util.Map[String,org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper]" id="org.apache.ivy.plugins.parser.m2.ReplaceMavenConfigurationMappings.init.map">map</a> = <span title="org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.type">PomModuleDescriptorBuilder</span>.<span title="java.util.Map[_, _]">MAVEN2_CONF_MAPPING</span>.<span title="[T0]=&gt; T0">asInstanceOf</span><span title="java.util.Map[String,org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper]" class="delimiter">[</span>java.util.<span title="java.util.Map[String,org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper]">Map</span><span class="delimiter">[</span>String, PomModuleDescriptorBuilder.ConfMapper<span class="delimiter">]</span><span class="delimiter">]</span>
      <a href="#org.apache.ivy.plugins.parser.m2.ReplaceMavenConfigurationMappings.init.map" title="java.util.Map[String,org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper]">map</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#org.apache.ivy.plugins.parser.m2.ReplaceMavenConfigurationMappings.init.map" title="java.util.Map[String,org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper]">map</a>.<span title="(x$1: java.util.Map[_ &lt;: String, _ &lt;: org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper])Unit">putAll</span><span class="delimiter">(</span><a href="#org.apache.ivy.plugins.parser.m2.ReplaceMavenConfigurationMappings.REPLACEMENT_MAVEN_MAPPINGS" title="=&gt; java.util.HashMap[String,org.apache.ivy.plugins.parser.m2.PomModuleDescriptorBuilder.ConfMapper]">REPLACEMENT_MAVEN_MAPPINGS</a><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Exception" id="org.apache.ivy.plugins.parser.m2.ReplaceMavenConfigurationMappings.init.e">e</a>: <span title="Exception">Exception</span> =&gt;
        <span class="comment">// TODO - Log that Ivy may not be configured correctly and you could have maven/ivy issues.</span>
        <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String, x$2: Throwable)RuntimeException" class="keyword">new</span> <span title="RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="String(&quot;FAILURE to install Ivy maven hooks.  Your ivy-maven interaction may suffer resolution errors&quot;)" class="string">&quot;FAILURE to install Ivy maven hooks.  Your ivy-maven interaction may suffer resolution errors&quot;</span>, <a href="#org.apache.ivy.plugins.parser.m2.ReplaceMavenConfigurationMappings.init.e" title="Exception">e</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
