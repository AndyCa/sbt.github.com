<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>sbt/compiler/javac/JavacProcessLogger.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> sbt
<span class="keyword">package</span> compiler
<span class="keyword">package</span> javac

<span class="keyword">import</span> java.util.StringTokenizer

<span class="keyword">import</span> xsbti._
<span class="keyword">import</span> java.io.File

<span class="comment">/**
 * An adapted process logger which can feed semantic error events from Javac as well as just
 * dump logs.
 *
 *
 * @param log  The logger where all input will go.
 * @param reporter  A reporter for semantic Javac error messages.
 * @param cwd The current working directory of the Javac process, used when parsing Filenames.
 */</span>
<span class="keyword">final</span> <span class="keyword">class</span> <a title="class JavacLogger extends AnyRef with sbt.ProcessLogger" id="sbt.compiler.javac;JavacLogger">JavacLogger</a><a href="#sbt.compiler.javac;JavacLogger" title="sbt.compiler.javac.JavacLogger" class="delimiter">(</a><a title="sbt.Logger" id="sbt.compiler.javac;JavacLogger.log">log</a>: sbt.<a href="../../Logger.scala.html#sbt;Logger" title="sbt.Logger">Logger</a>, <a title="xsbti.Reporter" id="sbt.compiler.javac;JavacLogger.reporter">reporter</a>: <a href="../../../xsbti/Reporter.java.html#xsbti;Reporter" title="xsbti.Reporter">Reporter</a>, <a title="java.io.File" id="sbt.compiler.javac;JavacLogger.cwd">cwd</a>: <span title="java.io.File">File</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="../../Process.scala.html#sbt;ProcessLogger" title="sbt.ProcessLogger">ProcessLogger</a> <span class="delimiter">{</span>
  <span class="keyword">import</span> scala.collection.mutable.ListBuffer
  <span class="keyword">import</span> <a href="../../Level.scala.html#sbt.Level" title="sbt.Level.type">Level</a>.<span class="delimiter">{</span> Info, Warn, Error, Value =&gt; LogLevel <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.mutable.ListBuffer[(sbt.Level.Value, String)]" id="sbt.compiler.javac;JavacLogger.msgs">msgs</a>: <span title="scala.collection.mutable.ListBuffer[(sbt.Level.Value, String)]">ListBuffer</span><span class="delimiter">[</span><span class="delimiter">(</span>LogLevel, String<span class="delimiter">)</span><span class="delimiter">]</span> = <span title="scala.collection.mutable.ListBuffer[(sbt.Level.Value, String)]" class="keyword">new</span> <span title="scala.collection.mutable.ListBuffer[(sbt.Level.Value, String)]">ListBuffer</span><span class="delimiter">(</span><span class="delimiter">)</span>

  <span class="keyword">def</span> <a title="(s: =&gt; String)Unit" id="sbt.compiler.javac;JavacLogger.info">info</a><span class="delimiter">(</span><a title="=&gt; String" id="sbt.compiler.javac;JavacLogger.info.s">s</a>: =&gt; String<span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <a href="#sbt.compiler.javac;JavacLogger" title="(x$1: scala.collection.mutable.ListBuffer[(sbt.Level.Value, String)])scala.collection.mutable.ListBuffer[(sbt.Level.Value, String)]">synchronized</a> <span title="Unit" class="delimiter">{</span> <a href="#sbt.compiler.javac;JavacLogger.msgs" title="=&gt; scala.collection.mutable.ListBuffer[(sbt.Level.Value, String)]">msgs</a> <span title="(x: (sbt.Level.Value, String))JavacLogger.this.msgs.type">+=</span> <span class="delimiter">(</span><span title="(_1: sbt.Level.Value, _2: String)(sbt.Level.Value, String)" class="delimiter">(</span><a href="../../Level.scala.html#sbt.Level.Info" title="=&gt; sbt.Level.Value">Info</a>, <a href="#sbt.compiler.javac;JavacLogger.info.s" title="=&gt; String">s</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(s: =&gt; String)Unit" id="sbt.compiler.javac;JavacLogger.error">error</a><span class="delimiter">(</span><a title="=&gt; String" id="sbt.compiler.javac;JavacLogger.error.s">s</a>: =&gt; String<span class="delimiter">)</span>: <span title="Unit">Unit</span> =
    <a href="#sbt.compiler.javac;JavacLogger" title="(x$1: scala.collection.mutable.ListBuffer[(sbt.Level.Value, String)])scala.collection.mutable.ListBuffer[(sbt.Level.Value, String)]">synchronized</a> <span title="Unit" class="delimiter">{</span> <a href="#sbt.compiler.javac;JavacLogger.msgs" title="=&gt; scala.collection.mutable.ListBuffer[(sbt.Level.Value, String)]">msgs</a> <span title="(x: (sbt.Level.Value, String))JavacLogger.this.msgs.type">+=</span> <span class="delimiter">(</span><span title="(_1: sbt.Level.Value, _2: String)(sbt.Level.Value, String)" class="delimiter">(</span><a href="../../Level.scala.html#sbt.Level.Error" title="=&gt; sbt.Level.Value">Error</a>, <a href="#sbt.compiler.javac;JavacLogger.error.s" title="=&gt; String">s</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="[T](f: =&gt; T)T" id="sbt.compiler.javac;JavacLogger.buffer">buffer</a><span class="delimiter">[</span><a title="" id="sbt.compiler.javac;JavacLogger.buffer;T">T</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="=&gt; T" id="sbt.compiler.javac;JavacLogger.buffer.f">f</a>: =&gt; T<span class="delimiter">)</span>: <a href="#sbt.compiler.javac;JavacLogger.buffer;T" title="T">T</a> = <a href="#sbt.compiler.javac;JavacLogger.buffer.f" title="=&gt; T">f</a>

  <span class="keyword">private</span> <span class="keyword">def</span> <a title="(desiredLevel: sbt.Level.Value)(t: (sbt.Level.Value, String))Unit" id="sbt.compiler.javac;JavacLogger.print">print</a><span class="delimiter">(</span><a title="sbt.Level.Value" id="sbt.compiler.javac;JavacLogger.print.desiredLevel">desiredLevel</a>: <span title="sbt.Level.Value">LogLevel</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="(sbt.Level.Value, String)" id="sbt.compiler.javac;JavacLogger.print.t">t</a>: <span title="(sbt.Level.Value, String)" class="delimiter">(</span>LogLevel, String<span class="delimiter">)</span><span class="delimiter">)</span> = <a href="#sbt.compiler.javac;JavacLogger.print.t" title="(sbt.Level.Value, String)">t</a> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <span class="delimiter">(</span><a href="../../Level.scala.html#sbt.Level.Info" title="=&gt; sbt.Level.Value">Info</a>, <span title="String">msg</span><span class="delimiter">)</span>  =&gt; <a href="#sbt.compiler.javac;JavacLogger.log" title="sbt.Logger">log</a>.<a href="../../Logger.scala.html#sbt;Logger.info(83d3728a3c)" title="(message: =&gt; String)Unit">info</a><span class="delimiter">(</span><span title="String">msg</span><span class="delimiter">)</span>
    <span class="keyword">case</span> <span class="delimiter">(</span><a href="../../Level.scala.html#sbt.Level.Error" title="=&gt; sbt.Level.Value">Error</a>, <span title="String">msg</span><span class="delimiter">)</span> =&gt; <a href="#sbt.compiler.javac;JavacLogger.log" title="sbt.Logger">log</a>.<a href="../../Logger.scala.html#sbt;Logger.log(e9c8c5e119)" title="(level: sbt.Level.Value, message: =&gt; String)Unit">log</a><span class="delimiter">(</span><a href="#sbt.compiler.javac;JavacLogger.print.desiredLevel" title="sbt.Level.Value">desiredLevel</a>, <span title="String">msg</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">// Helper method to dump all semantic errors.</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="()Unit" id="sbt.compiler.javac;JavacLogger.parseAndDumpSemanticErrors">parseAndDumpSemanticErrors</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="String" id="sbt.compiler.javac;JavacLogger.parseAndDumpSemanticErrors.input">input</a> =
      <a href="#sbt.compiler.javac;JavacLogger.msgs" title="=&gt; scala.collection.mutable.ListBuffer[(sbt.Level.Value, String)]">msgs</a> <span title="(pf: PartialFunction[(sbt.Level.Value, String),String])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ListBuffer[(sbt.Level.Value, String)],String,scala.collection.mutable.ListBuffer[String]])scala.collection.mutable.ListBuffer[String]">collect</span> <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[(sbt.Level.Value, String),String] with Serializable" id="sbt.compiler.javac;JavacLogger.parseAndDumpSemanticErrors.input;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
        <span class="keyword">case</span> <span class="delimiter">(</span><a href="../../Level.scala.html#sbt.Level.Error" title="=&gt; sbt.Level.Value">Error</a>, <a title="String" id="sbt.compiler.javac;JavacLogger.parseAndDumpSemanticErrors.input;$anonfun.isDefinedAt.msg">msg</a><span class="delimiter">)</span> =&gt; <a href="#sbt.compiler.javac;JavacLogger.parseAndDumpSemanticErrors.input;$anonfun.isDefinedAt.msg" title="String">msg</a>
      <span class="delimiter">}</span> <span title="(sep: String)String">mkString</span> <span title="String(&quot;\n&quot;)" class="string">&quot;\n&quot;</span>
    <span class="keyword">val</span> <a title="sbt.compiler.javac.JavaErrorParser" id="sbt.compiler.javac;JavacLogger.parseAndDumpSemanticErrors.parser">parser</a> = <span title="sbt.compiler.javac.JavaErrorParser" class="keyword">new</span> <a href="JavaErrorParser.scala.html#sbt.compiler.javac;JavaErrorParser" title="sbt.compiler.javac.JavaErrorParser">JavaErrorParser</a><span class="delimiter">(</span><a href="#sbt.compiler.javac;JavacLogger.cwd" title="java.io.File">cwd</a><span class="delimiter">)</span>
    <a href="#sbt.compiler.javac;JavacLogger.parseAndDumpSemanticErrors.parser" title="sbt.compiler.javac.JavaErrorParser">parser</a>.<a href="JavaErrorParser.scala.html#sbt.compiler.javac;JavaErrorParser.parseProblems" title="(in: String, logger: sbt.Logger)Seq[xsbti.Problem]">parseProblems</a><span class="delimiter">(</span><a href="#sbt.compiler.javac;JavacLogger.parseAndDumpSemanticErrors.input" title="String">input</a>, <a href="#sbt.compiler.javac;JavacLogger.log" title="sbt.Logger">log</a><span class="delimiter">)</span> <span title="(f: xsbti.Problem =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a title="xsbti.Problem" id="sbt.compiler.javac;JavacLogger.parseAndDumpSemanticErrors.$anonfun.e">e</a> =&gt;
      <a href="#sbt.compiler.javac;JavacLogger.reporter" title="xsbti.Reporter">reporter</a>.<a href="../../../xsbti/Reporter.java.html#xsbti;Reporter.log" title="(pos: xsbti.Position, msg: String, sev: xsbti.Severity)Unit">log</a><span class="delimiter">(</span><a href="#sbt.compiler.javac;JavacLogger.parseAndDumpSemanticErrors.$anonfun.e" title="xsbti.Problem">e</a>.<a href="../../../xsbti/Problem.java.html#xsbti;Problem.position" title="()xsbti.Position">position</a>, <a href="#sbt.compiler.javac;JavacLogger.parseAndDumpSemanticErrors.$anonfun.e" title="xsbti.Problem">e</a>.<a href="../../../xsbti/Problem.java.html#xsbti;Problem.message" title="()String">message</a>, <a href="#sbt.compiler.javac;JavacLogger.parseAndDumpSemanticErrors.$anonfun.e" title="xsbti.Problem">e</a>.<a href="../../../xsbti/Problem.java.html#xsbti;Problem.severity" title="()xsbti.Severity">severity</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(exitCode: Int)Unit" id="sbt.compiler.javac;JavacLogger.flush">flush</a><span class="delimiter">(</span><a title="Int" id="sbt.compiler.javac;JavacLogger.flush.exitCode">exitCode</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <a href="#sbt.compiler.javac;JavacLogger.parseAndDumpSemanticErrors" title="()Unit">parseAndDumpSemanticErrors</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="sbt.Level.Value" id="sbt.compiler.javac;JavacLogger.flush.level">level</a> = <span title="sbt.Level.Value" class="keyword">if</span> <span class="delimiter">(</span><a href="#sbt.compiler.javac;JavacLogger.flush.exitCode" title="Int">exitCode</a> <span title="(x: Int)Boolean">==</span> <span title="Int(0)" class="int">0</span><span class="delimiter">)</span> <a href="../../Level.scala.html#sbt.Level.Warn" title="=&gt; sbt.Level.Value">Warn</a> <span class="keyword">else</span> <a href="../../Level.scala.html#sbt.Level.Error" title="=&gt; sbt.Level.Value">Error</a>
    <span class="comment">// Here we only display things that wouldn't otherwise be output by the error reporter.</span>
    <span class="comment">// TODO - NOTES may not be displayed correctly!</span>
    <a href="#sbt.compiler.javac;JavacLogger.msgs" title="=&gt; scala.collection.mutable.ListBuffer[(sbt.Level.Value, String)]">msgs</a> <span title="(pf: PartialFunction[(sbt.Level.Value, String),String])(implicit bf: scala.collection.generic.CanBuildFrom[scala.collection.mutable.ListBuffer[(sbt.Level.Value, String)],String,scala.collection.mutable.ListBuffer[String]])scala.collection.mutable.ListBuffer[String]">collect</span> <a title="anonymous class $anonfun extends scala.runtime.AbstractPartialFunction[(sbt.Level.Value, String),String] with Serializable" id="sbt.compiler.javac;JavacLogger.flush;$anonfun.isDefinedAt.defaultCase$" class="delimiter">{</a>
      <span class="keyword">case</span> <span class="delimiter">(</span><a href="../../Level.scala.html#sbt.Level.Info" title="=&gt; sbt.Level.Value">Info</a>, <a title="String" id="sbt.compiler.javac;JavacLogger.flush;$anonfun.isDefinedAt.msg">msg</a><span class="delimiter">)</span> =&gt; <a href="#sbt.compiler.javac;JavacLogger.flush;$anonfun.isDefinedAt.msg" title="String">msg</a>
    <span class="delimiter">}</span> <span title="(f: String =&gt; Unit)Unit">foreach</span> <span class="delimiter">{</span> <a title="String" id="sbt.compiler.javac;JavacLogger.flush.$anonfun.msg">msg</a> =&gt;
      <a href="#sbt.compiler.javac;JavacLogger.log" title="sbt.Logger">log</a>.<a href="../../Logger.scala.html#sbt;Logger.info(83d3728a3c)" title="(message: =&gt; String)Unit">info</a><span class="delimiter">(</span><a href="#sbt.compiler.javac;JavacLogger.flush.$anonfun.msg" title="String">msg</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#sbt.compiler.javac;JavacLogger.msgs" title="=&gt; scala.collection.mutable.ListBuffer[(sbt.Level.Value, String)]">msgs</a>.<span title="()Unit">clear</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>
        </pre>
    </body>
</html>
