---
layout: content
title: Deploying to Sonatype
---

Deploying to sonatype is easy!  Just follow these simple steps:

## First - PGP Signatures ##

You'll need to PGP sign your artifacts for the Sonatype repository.  Don't worry, there's a [plugin for that](http://scala-sbt.org/xsbt-gpg-plugin).  Follow the instructions for the plugin and you'll have PGP signed artifacts in no time.

*Note: The plugin is a jvm-only solution to generate PGP keys and sign artifacts.  It can work with the GPG command line tool, but the command line is not needed.*


## Second - Maven Publishing Settings ##

To publish to a maven repository, you'll need to configure a few settings so that the correct metadata is generated.

{% highlight scala %}
publishMavenStyle := true
{% endhighlight %}

is used to ensure POMs are generated and pushed.  Next, you have to set up the repositories you wish to push too.  Luckily, Sonatype's OSSRH uses the same URLs for everyone:

{% highlight scala %}
publishTo <<= version { (v: String) =>
  val nexus = "https://oss.sonatype.org/"
  if (v.trim.endsWith("SNAPSHOT")) Some("snapshots" at nexus + "content/repositories/snapshots") 
  else                             Some("releases"  at nexus + "service/local/staging/deploy/maven2")
}
{% endhighlight %}

Another good idea is to not publish your test artifacts:

{% highlight scala %}
publishArtifact in Test := false
{% endhighlight %}

## Third - POM Metadata ##

Now, we want to control what's available in the `pom.xml` file.  This file describes our project in the maven repository and is used by indexing services for search and discover.   This means it's important that `pom.xml` should have all information we wish to advertise as well as required info!

First, let's make sure no repositories show up in the POM file.   To publish on maven-central, all *required* artifacts must also be hosted on maven central.  However, sometimes we have optional dependencies for special features.   If that's the case, let's remove the repositories for optional dependencies in our artifact:

{% highlight scala %}
pomIncludeRepository := { x => false },
{% endhighlight %}

Next, the POM metadata that isn't generated by SBT must be added.   This is done through the `pomExtra` configuration option:

{% highlight xml %}
pomExtra := (
  <url>http://jsuereth.com/scala-arm</url>
    <licenses>
	    <license>
		    <name>BSD-style</name>
		    <url>http://www.opensource.org/licenses/bsd-license.php</url>
		    <distribution>repo</distribution>
	    </license>
    </licenses>
  <scm>
    <url>git@github.com:jsuereth/scala-arm.git</url>
    <connection>scm:git:git@github.com:jsuereth/scala-arm.git</connection>
  </scm>
  <developers>
    <developer>
      <id>jsuereth</id>
      <name>Josh Suereth</name>
      <url>http://jsuereth.com</url>
    </developer>
  </developers>)
{% endhighlight %}

Specifically, the `url`, `license`, `scm.url`, `scm.connection` and `developer` sections are required.   The  above is an example from the [scala-arm](http://jsuereth.com/scala-arm) project.

*The full format of a pom.xml file is [outlined here](http://maven.apache.org/pom.html).*

## Fourth - Adding credentials ##

The credentails for your Sonatype OSSRH account need to be added somewhere.  Common convention is a `~/.sbt/sonatype.sbt` file with the following:

{% highlight scala %}
credentials += Credentials("Sonatype Nexus Repository Manager", "oss.sonatype.org", "<your username>", "<your password>")
{% endhighlight %}

*Note: The first two strings **must** be `"Sonatype Nexus Repository Manager"` and `"oss.sonatype.org"` for Ivy to use the credentials.*

## Finally - Publish ##

In SBT, run `publish` and you should see something like the following:

    > publish
    Please enter your PGP passphrase> ***********
    [info] Packaging /home/josh/projects/typesafe/scala-arm/target/scala-2.9.1/scala-arm_2.9.1-1.2.jar ...
    [info] Wrote /home/josh/projects/typesafe/scala-arm/target/scala-2.9.1/scala-arm_2.9.1-1.2.pom
    [info] Packaging /home/josh/projects/typesafe/scala-arm/target/scala-2.9.1/scala-arm_2.9.1-1.2-javadoc.jar ...
    [info] Packaging /home/josh/projects/typesafe/scala-arm/target/scala-2.9.1/scala-arm_2.9.1-1.2-sources.jar ...
    [info] :: delivering :: com.jsuereth#scala-arm_2.9.1;1.2 :: 1.2 :: release :: Mon Jan 23 13:16:57 EST 2012
    [info] Done packaging.
    [info] Done packaging.
    [info] Done packaging.
    [info] 	delivering ivy file to /home/josh/projects/typesafe/scala-arm/target/scala-2.9.1/ivy-1.2.xml
    [info] 	published scala-arm_2.9.1 to https://oss.sonatype.org/service/local/staging/deploy/maven2/com/jsuereth/scala-arm_2.9.1/1.2/scala-arm_2.9.1-1.2-sources.jar
    [info] 	published scala-arm_2.9.1 to https://oss.sonatype.org/service/local/staging/deploy/maven2/com/jsuereth/scala-arm_2.9.1/1.2/scala-arm_2.9.1-1.2-javadoc.jar.asc
    [info] 	published scala-arm_2.9.1 to https://oss.sonatype.org/service/local/staging/deploy/maven2/com/jsuereth/scala-arm_2.9.1/1.2/scala-arm_2.9.1-1.2-sources.jar.asc
    [info] 	published scala-arm_2.9.1 to https://oss.sonatype.org/service/local/staging/deploy/maven2/com/jsuereth/scala-arm_2.9.1/1.2/scala-arm_2.9.1-1.2.jar
    [info] 	published scala-arm_2.9.1 to https://oss.sonatype.org/service/local/staging/deploy/maven2/com/jsuereth/scala-arm_2.9.1/1.2/scala-arm_2.9.1-1.2.jar.asc
    [info] 	published scala-arm_2.9.1 to https://oss.sonatype.org/service/local/staging/deploy/maven2/com/jsuereth/scala-arm_2.9.1/1.2/scala-arm_2.9.1-1.2.pom.asc
    [info] 	published scala-arm_2.9.1 to https://oss.sonatype.org/service/local/staging/deploy/maven2/com/jsuereth/scala-arm_2.9.1/1.2/scala-arm_2.9.1-1.2.pom
    [info] 	published scala-arm_2.9.1 to https://oss.sonatype.org/service/local/staging/deploy/maven2/com/jsuereth/scala-arm_2.9.1/1.2/scala-arm_2.9.1-1.2-javadoc.jar
    [success] Total time: 9 s, completed Jan 23, 2012 1:17:03 PM



After publishing you have to follow the [Release workflow of nexus](https://docs.sonatype.org/display/Repository/Sonatype+OSS+Maven+Repository+Usage+Guide#SonatypeOSSMavenRepositoryUsageGuide-8.ReleaseIt).  In the future, we hope to provide a Nexus SBT plugin that allows the release workflow procedures to be performed directly from SBT.

*Note: Staged releases allow testing across large projects of independent releases before pushing the full project.*



