<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>sbt/compiler/javac/JavaCompilerAdapter.scala</title>
        <script type="text/javascript" src="../../../jquery-all.js"></script>
        <script type="text/javascript" src="../../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> sbt.compiler.javac

<span class="keyword">import</span> java.io.File

<span class="keyword">import</span> sbt.compiler.<span class="delimiter">{</span> CompileFailed, CompilerArguments <span class="delimiter">}</span>
<span class="keyword">import</span> sbt.<span class="delimiter">{</span> ClasspathOptions, Logger, LoggerReporter <span class="delimiter">}</span>
<span class="keyword">import</span> xsbti.Reporter
<span class="keyword">import</span> xsbti.compile.<span class="delimiter">{</span> MultipleOutput, SingleOutput, Output <span class="delimiter">}</span>

<span class="comment">/**
 * This class adapts the new java compiler with the classpath/argument option hackery needed to handle scala.
 *
 * The xsbti.Compiler interface is used by the IncrementalCompiler classes, so this lets us adapt a more generic
 * wrapper around running Javac (forked or direct) into the interfaces used by incremental compiler.
 *
 */</span>
<span class="keyword">class</span> <a title="class JavaCompilerAdapter extends Object with xsbti.compile.JavaCompiler" id="sbt.compiler.javac;JavaCompilerAdapter">JavaCompilerAdapter</a><a href="#sbt.compiler.javac;JavaCompilerAdapter" title="sbt.compiler.javac.JavaCompilerAdapter" class="delimiter">(</a><a title="sbt.compiler.javac.JavaTool" id="sbt.compiler.javac;JavaCompilerAdapter.delegate">delegate</a>: <a href="JavaCompiler.scala.html#sbt.compiler.javac;JavaTool" title="sbt.compiler.javac.JavaTool">JavaTool</a>, <a title="xsbti.compile.ScalaInstance" id="sbt.compiler.javac;JavaCompilerAdapter.scalaInstance">scalaInstance</a>: xsbti.compile.<a href="../../../xsbti/compile/ScalaInstance.java.html#xsbti.compile;ScalaInstance" title="xsbti.compile.ScalaInstance">ScalaInstance</a>, <a title="xsbti.compile.ClasspathOptions" id="sbt.compiler.javac;JavaCompilerAdapter.cpOptions">cpOptions</a>: xsbti.compile.<a href="../../../xsbti/compile/ClasspathOptions.java.html#xsbti.compile;ClasspathOptions" title="xsbti.compile.ClasspathOptions">ClasspathOptions</a><span class="delimiter">)</span> <span class="keyword">extends</span> xsbti.compile.<a href="../../../xsbti/compile/JavaCompiler.java.html#xsbti.compile;JavaCompiler" title="xsbti.compile.JavaCompiler">JavaCompiler</a> <span class="delimiter">{</span>
  <span class="keyword">override</span> <span class="keyword">final</span> <span class="keyword">def</span> <a title="(sources: Array[java.io.File], classpath: Array[java.io.File], output: xsbti.compile.Output, options: Array[String], log: xsbti.Logger)Unit" id="sbt.compiler.javac;JavaCompilerAdapter.compile">compile</a><span class="delimiter">(</span><a title="Array[java.io.File]" id="sbt.compiler.javac;JavaCompilerAdapter.compile.sources">sources</a>: <span title="Array[java.io.File]">Array</span><span class="delimiter">[</span>File<span class="delimiter">]</span>, <a title="Array[java.io.File]" id="sbt.compiler.javac;JavaCompilerAdapter.compile.classpath">classpath</a>: <span title="Array[java.io.File]">Array</span><span class="delimiter">[</span>File<span class="delimiter">]</span>, <a title="xsbti.compile.Output" id="sbt.compiler.javac;JavaCompilerAdapter.compile.output">output</a>: <a href="../../../xsbti/compile/Output.java.html#xsbti.compile;Output" title="xsbti.compile.Output">Output</a>, <a title="Array[String]" id="sbt.compiler.javac;JavaCompilerAdapter.compile.options">options</a>: <span title="Array[String]">Array</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="xsbti.Logger" id="sbt.compiler.javac;JavaCompilerAdapter.compile.log">log</a>: xsbti.<a href="../../../xsbti/Logger.java.html#xsbti;Logger" title="xsbti.Logger">Logger</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="comment">// TODO - 5 max errors ok?  We're not expecting this code path to be called, ever.  This is only for clients who try to use the xsbti.compile.JavaCompiler interface</span>
    <span class="comment">// outside of the incremental compiler, for some reason.</span>
    <span class="keyword">val</span> <a title="sbt.LoggerReporter" id="sbt.compiler.javac;JavaCompilerAdapter.compile.reporter">reporter</a> = <a href="../../LoggerReporter.scala.html#sbt.LoggerReporter.<init>$default$3" title="sbt.LoggerReporter" class="keyword">new</a> <a href="../../LoggerReporter.scala.html#sbt;LoggerReporter" title="sbt.LoggerReporter">LoggerReporter</a><span class="delimiter">(</span><span title="Int(5)" class="int">5</span>, <a href="../../Logger.scala.html#sbt.Logger.xlog2Log" title="implicit sbt.Logger.xlog2Log : (lg: xsbti.Logger)sbt.Logger">log</a><span class="delimiter">)</span>
    <a href="#sbt.compiler.javac;JavaCompilerAdapter.compileWithReporter" title="(sources: Array[java.io.File], classpath: Array[java.io.File], output: xsbti.compile.Output, options: Array[String], reporter: xsbti.Reporter, log: xsbti.Logger)Unit">compileWithReporter</a><span class="delimiter">(</span><a href="#sbt.compiler.javac;JavaCompilerAdapter.compile.sources" title="Array[java.io.File]">sources</a>, <a href="#sbt.compiler.javac;JavaCompilerAdapter.compile.classpath" title="Array[java.io.File]">classpath</a>, <a href="#sbt.compiler.javac;JavaCompilerAdapter.compile.output" title="xsbti.compile.Output">output</a>, <a href="#sbt.compiler.javac;JavaCompilerAdapter.compile.options" title="Array[String]">options</a>, <a href="#sbt.compiler.javac;JavaCompilerAdapter.compile.reporter" title="sbt.LoggerReporter">reporter</a>, <a href="#sbt.compiler.javac;JavaCompilerAdapter.compile.log" title="xsbti.Logger">log</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  <span class="keyword">override</span> <span class="keyword">final</span> <span class="keyword">def</span> <a title="(sources: Array[java.io.File], classpath: Array[java.io.File], output: xsbti.compile.Output, options: Array[String], reporter: xsbti.Reporter, log: xsbti.Logger)Unit" id="sbt.compiler.javac;JavaCompilerAdapter.compileWithReporter">compileWithReporter</a><span class="delimiter">(</span><a title="Array[java.io.File]" id="sbt.compiler.javac;JavaCompilerAdapter.compileWithReporter.sources">sources</a>: <span title="Array[java.io.File]">Array</span><span class="delimiter">[</span>File<span class="delimiter">]</span>, <a title="Array[java.io.File]" id="sbt.compiler.javac;JavaCompilerAdapter.compileWithReporter.classpath">classpath</a>: <span title="Array[java.io.File]">Array</span><span class="delimiter">[</span>File<span class="delimiter">]</span>, <a title="xsbti.compile.Output" id="sbt.compiler.javac;JavaCompilerAdapter.compileWithReporter.output">output</a>: <a href="../../../xsbti/compile/Output.java.html#xsbti.compile;Output" title="xsbti.compile.Output">Output</a>, <a title="Array[String]" id="sbt.compiler.javac;JavaCompilerAdapter.compileWithReporter.options">options</a>: <span title="Array[String]">Array</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="xsbti.Reporter" id="sbt.compiler.javac;JavaCompilerAdapter.compileWithReporter.reporter">reporter</a>: <a href="../../../xsbti/Reporter.java.html#xsbti;Reporter" title="xsbti.Reporter">Reporter</a>, <a title="xsbti.Logger" id="sbt.compiler.javac;JavaCompilerAdapter.compileWithReporter.log">log</a>: xsbti.<a href="../../../xsbti/Logger.java.html#xsbti;Logger" title="xsbti.Logger">Logger</a><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.io.File" id="sbt.compiler.javac;JavaCompilerAdapter.compileWithReporter.target">target</a> = <a href="#sbt.compiler.javac;JavaCompilerAdapter.compileWithReporter.output" title="xsbti.compile.Output">output</a> <span title="java.io.File" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="xsbti.compile.SingleOutput" id="sbt.compiler.javac;JavaCompilerAdapter.compileWithReporter.target.so">so</a>: <a href="../../../xsbti/compile/SingleOutput.java.html#xsbti.compile;SingleOutput" title="xsbti.compile.SingleOutput">SingleOutput</a>   =&gt; <a href="#sbt.compiler.javac;JavaCompilerAdapter.compileWithReporter.target.so" title="xsbti.compile.SingleOutput">so</a>.<a href="../../../xsbti/compile/SingleOutput.java.html#xsbti.compile;SingleOutput.outputDirectory" title="()java.io.File">outputDirectory</a>
      <span class="keyword">case</span> <a title="xsbti.compile.MultipleOutput" id="sbt.compiler.javac;JavaCompilerAdapter.compileWithReporter.target.mo">mo</a>: <a href="../../../xsbti/compile/MultipleOutput.java.html#xsbti.compile;MultipleOutput" title="xsbti.compile.MultipleOutput">MultipleOutput</a> =&gt; <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)RuntimeException" class="keyword">new</span> <span title="RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="String(&quot;Javac doesn\'t support multiple output directories&quot;)" class="string">&quot;Javac doesn't support multiple output directories&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">val</span> <a title="Seq[String]" id="sbt.compiler.javac;JavaCompilerAdapter.compileWithReporter.args">args</a> = <a href="#sbt.compiler.javac;JavaCompilerAdapter.commandArguments" title="(sources: Seq[java.io.File], classpath: Seq[java.io.File], outputDirectory: java.io.File, options: Seq[String], log: sbt.Logger)Seq[String]">commandArguments</a><span class="delimiter">(</span><span title="(elems: Nothing*)Seq[Nothing]">Seq</span><span class="delimiter">(</span><span class="delimiter">)</span>, <a href="#sbt.compiler.javac;JavaCompilerAdapter.compileWithReporter.classpath" title="(xs: Array[java.io.File])scala.collection.mutable.WrappedArray[java.io.File]">classpath</a>, <a href="#sbt.compiler.javac;JavaCompilerAdapter.compileWithReporter.target" title="java.io.File">target</a>, <a href="#sbt.compiler.javac;JavaCompilerAdapter.compileWithReporter.options" title="(xs: Array[String])scala.collection.mutable.WrappedArray[String]">options</a>, <a href="../../Logger.scala.html#sbt.Logger.xlog2Log" title="implicit sbt.Logger.xlog2Log : (lg: xsbti.Logger)sbt.Logger">log</a><span class="delimiter">)</span>
    <span class="comment">// We sort the sources for deterministic results.</span>
    <span class="keyword">val</span> <a title="Boolean" id="sbt.compiler.javac;JavaCompilerAdapter.compileWithReporter.success">success</a> = <a href="#sbt.compiler.javac;JavaCompilerAdapter.delegate" title="sbt.compiler.javac.JavaTool">delegate</a>.<a href="JavaCompiler.scala.html#sbt.compiler.javac;JavaTool.run" title="(sources: Seq[java.io.File], options: Seq[String])(implicit log: sbt.Logger, implicit reporter: xsbti.Reporter)Boolean">run</a><span class="delimiter">(</span><a href="#sbt.compiler.javac;JavaCompilerAdapter.compileWithReporter.sources" title="(xs: Array[java.io.File])scala.collection.mutable.ArrayOps[java.io.File]">sources</a>.<span title="(f: java.io.File =&gt; String)(implicit ord: scala.math.Ordering[String])Array[java.io.File]">sortBy</span><span title="(xs: Array[java.io.File])scala.collection.mutable.WrappedArray[java.io.File]" class="delimiter">(</span><a href="#sbt.compiler.javac;JavaCompilerAdapter.compileWithReporter.success.$anonfun.x$1" title="java.io.File">_</a>.<span title="()String">getAbsolutePath</span><span class="delimiter">)</span>, <a href="#sbt.compiler.javac;JavaCompilerAdapter.compileWithReporter.args" title="Seq[String]">args</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="../../Logger.scala.html#sbt.Logger.xlog2Log" title="implicit sbt.Logger.xlog2Log : (lg: xsbti.Logger)sbt.Logger">log</a>, <a href="#sbt.compiler.javac;JavaCompilerAdapter.compileWithReporter.reporter" title="xsbti.Reporter">reporter</a><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#sbt.compiler.javac;JavaCompilerAdapter.compileWithReporter.success" title="Boolean">success</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <span class="comment">// TODO - Will the reporter have problems from Scalac?  It appears like it does not, only from the most recent run.</span>
      <span class="comment">// This is because the incremental compiler will not run javac if scalac fails.</span>
      <span title="Nothing" class="keyword">throw</span> <span title="sbt.compiler.CompileFailed" class="keyword">new</span> <a href="../RawCompiler.scala.html#sbt.compiler;CompileFailed" title="sbt.compiler.CompileFailed">CompileFailed</a><span class="delimiter">(</span><a href="#sbt.compiler.javac;JavaCompilerAdapter.compileWithReporter.args" title="Seq[String]">args</a>.<span title="(implicit evidence$1: scala.reflect.ClassTag[String])Array[String]">toArray</span>, <span title="String(&quot;javac returned nonzero exit code&quot;)" class="string">&quot;javac returned nonzero exit code&quot;</span>, <a href="#sbt.compiler.javac;JavaCompilerAdapter.compileWithReporter.reporter" title="xsbti.Reporter">reporter</a>.<a href="../../../xsbti/Reporter.java.html#xsbti;Reporter.problems" title="()Array[xsbti.Problem]">problems</a><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  <span class="keyword">private</span><span class="delimiter">[</span><span class="keyword">this</span><span class="delimiter">]</span> <span class="keyword">def</span> <a title="(sources: Seq[java.io.File], classpath: Seq[java.io.File], outputDirectory: java.io.File, options: Seq[String], log: sbt.Logger)Seq[String]" id="sbt.compiler.javac;JavaCompilerAdapter.commandArguments">commandArguments</a><span class="delimiter">(</span><a title="Seq[java.io.File]" id="sbt.compiler.javac;JavaCompilerAdapter.commandArguments.sources">sources</a>: <span title="Seq[java.io.File]">Seq</span><span class="delimiter">[</span>File<span class="delimiter">]</span>, <a title="Seq[java.io.File]" id="sbt.compiler.javac;JavaCompilerAdapter.commandArguments.classpath">classpath</a>: <span title="Seq[java.io.File]">Seq</span><span class="delimiter">[</span>File<span class="delimiter">]</span>, <a title="java.io.File" id="sbt.compiler.javac;JavaCompilerAdapter.commandArguments.outputDirectory">outputDirectory</a>: <span title="java.io.File">File</span>, <a title="Seq[String]" id="sbt.compiler.javac;JavaCompilerAdapter.commandArguments.options">options</a>: <span title="Seq[String]">Seq</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="sbt.Logger" id="sbt.compiler.javac;JavaCompilerAdapter.commandArguments.log">log</a>: <a href="../../Logger.scala.html#sbt;Logger" title="sbt.Logger">Logger</a><span class="delimiter">)</span>: <span title="Seq[String]">Seq</span><span class="delimiter">[</span>String<span class="delimiter">]</span> =
    <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Seq[java.io.File]" id="sbt.compiler.javac;JavaCompilerAdapter.commandArguments.augmentedClasspath">augmentedClasspath</a> = <span title="Seq[java.io.File]" class="keyword">if</span> <span class="delimiter">(</span><a href="#sbt.compiler.javac;JavaCompilerAdapter.cpOptions" title="xsbti.compile.ClasspathOptions">cpOptions</a>.<a href="../../../xsbti/compile/ClasspathOptions.java.html#xsbti.compile;ClasspathOptions.autoBoot" title="()Boolean">autoBoot</a><span class="delimiter">)</span> <a href="#sbt.compiler.javac;JavaCompilerAdapter.commandArguments.classpath" title="Seq[java.io.File]">classpath</a> <span title="(that: scala.collection.GenTraversableOnce[java.io.File])(implicit bf: scala.collection.generic.CanBuildFrom[Seq[java.io.File],java.io.File,Seq[java.io.File]])Seq[java.io.File]">++</span> <span title="(elems: java.io.File*)Seq[java.io.File]">Seq</span><span class="delimiter">(</span><a href="#sbt.compiler.javac;JavaCompilerAdapter.scalaInstance" title="xsbti.compile.ScalaInstance">scalaInstance</a>.<a href="../../../xsbti/compile/ScalaInstance.java.html#xsbti.compile;ScalaInstance.libraryJar" title="()java.io.File">libraryJar</a><span class="delimiter">)</span> <span class="keyword">else</span> <a href="#sbt.compiler.javac;JavaCompilerAdapter.commandArguments.classpath" title="Seq[java.io.File]">classpath</a>
      <span class="keyword">val</span> <a title="sbt.ClasspathOptions" id="sbt.compiler.javac;JavaCompilerAdapter.commandArguments.javaCp">javaCp</a> = <a href="../../ClasspathOptions.scala.html#sbt.ClasspathOptions" title="sbt.ClasspathOptions.type">ClasspathOptions</a>.<a href="../../ClasspathOptions.scala.html#sbt.ClasspathOptions.javac" title="(compiler: Boolean)sbt.ClasspathOptions">javac</a><span class="delimiter">(</span><a href="#sbt.compiler.javac;JavaCompilerAdapter.cpOptions" title="xsbti.compile.ClasspathOptions">cpOptions</a>.<a href="../../../xsbti/compile/ClasspathOptions.java.html#xsbti.compile;ClasspathOptions.compiler" title="()Boolean">compiler</a><span class="delimiter">)</span>
      <span class="delimiter">(</span><a href="../CompilerArguments.scala.html#sbt.compiler;CompilerArguments.apply" title="(sources: Seq[java.io.File], classpath: Seq[java.io.File], outputDirectory: Option[java.io.File], options: Seq[String])Seq[String]" class="keyword">new</a> <a href="../CompilerArguments.scala.html#sbt.compiler;CompilerArguments" title="sbt.compiler.CompilerArguments">CompilerArguments</a><span class="delimiter">(</span><a href="#sbt.compiler.javac;JavaCompilerAdapter.scalaInstance" title="xsbti.compile.ScalaInstance">scalaInstance</a>, <a href="#sbt.compiler.javac;JavaCompilerAdapter.commandArguments.javaCp" title="sbt.ClasspathOptions">javaCp</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#sbt.compiler.javac;JavaCompilerAdapter.commandArguments.sources" title="Seq[java.io.File]">sources</a>, <a href="#sbt.compiler.javac;JavaCompilerAdapter.commandArguments.augmentedClasspath" title="Seq[java.io.File]">augmentedClasspath</a>, <span title="(x: java.io.File)Some[java.io.File]">Some</span><span class="delimiter">(</span><a href="#sbt.compiler.javac;JavaCompilerAdapter.commandArguments.outputDirectory" title="java.io.File">outputDirectory</a><span class="delimiter">)</span>, <a href="#sbt.compiler.javac;JavaCompilerAdapter.commandArguments.options" title="Seq[String]">options</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
