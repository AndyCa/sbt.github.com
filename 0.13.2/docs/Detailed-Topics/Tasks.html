

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Tasks &mdash; sbt Documentation</title>
    
    <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/issuetracker.css" type="text/css" />
    <link rel="stylesheet" href="../_static/base.css" type="text/css" />
    <link rel="stylesheet" href="../_static/docs.css" type="text/css" />
    <link rel="stylesheet" href="../_static/syntax.css" type="text/css" />
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Exo:300,400,600,700" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.13.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  false
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../versions.js"></script>
    <script type="text/javascript" src="../_static/set-versions.js"></script>
    <script type="text/javascript" src="../../../assets/warnOldDocs.js"></script>
    <link rel="top" title="sbt Documentation" href="../index.html" />
    <link rel="up" title="Tasks, Commands, and Plugins" href="Tasks-and-Commands.html" />
    <link rel="next" title="Input Tasks" href="../Extending/Input-Tasks.html" />
    <link rel="prev" title="Tasks, Commands, and Plugins" href="Tasks-and-Commands.html" /> 
  </head>
  <body>
  <div class="navbar">
    <div class="navbar-inner">
      <div class="container">
        <ul class="nav">
          <li><a href="http://www.scala-sbt.org/">Home</a></li>
          <li><a href="../index.html">Documentation</a></li>
          <li><a href="../Getting-Started/Setup.html">Download</a></li>
          <li><a href="https://groups.google.com/forum/#!forum/sbt-dev">Mailing List</a></li>
          <li><a href="http://github.com/sbt/sbt">Project</a></li>           
        </ul>
      </div>
    </div>
  </div>
  <div class="main">
    <div class="container">
      <div class="page-title">Tasks</div>
      <div class="search-box">
        <form method="get" action="http://www.google.com/search" id="search">
          <input type="search" placeholder="Search 0.13.2 on Google" name="q" results="10" size="29" id="search-input">
          <input type="hidden"  name="sitesearch" value="http://www.scala-sbt.org/0.13.2/docs/"> 
          <input type="submit" id="submit-search">
        </form>
      </div>
    </div>
    <div class="main-container">
      <div class="container">
        <div class="row">
          <div class="span12">
            <ul class="breadcrumb">        
              <li>
                 <span class="divider">|</span> <a href="../Extending/Input-Tasks.html">Input Tasks</a> <span class="divider">»</span>
              </li>
              <li>
                 <span class="divider">&gt;</span><a href="index.html">Detailed Topics</a>
              </li>
              <li>
                <a href="../index.html">Contents</a>
              </li>
              <li>
                <span class="divider">«</span> <a href="Tasks-and-Commands.html">Tasks, Commands, and Plugins</a> <span class="divider">|</span>
              </li>
              <li>
                <select id="versions"><option selected value="0.13.2">Version 0.13.2</option></select>
              </li>
            </ul>         
          </div>
        </div>
        <div class="row">
          <div class="span9">
            
  <div class="section" id="tasks">
<h1>Tasks<a class="headerlink" href="#tasks" title="Permalink to this headline">¶</a></h1>
<p>Tasks and settings are introduced in the <a class="reference internal" href="../Getting-Started/Basic-Def.html"><em>getting started guide</em></a>,
which you may wish to read first.
This page has additional details and background and is intended more as a reference.</p>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>Both settings and tasks produce values, but there are two major
differences between them:</p>
<ol class="arabic simple">
<li>Settings are evaluated at project load time. Tasks are executed on
demand, often in response to a command from the user.</li>
<li>At the beginning of project loading, settings and their dependencies
are fixed. Tasks can introduce new tasks during execution, however.</li>
</ol>
</div>
<div class="section" id="features">
<h2>Features<a class="headerlink" href="#features" title="Permalink to this headline">¶</a></h2>
<p>There are several features of the task system:</p>
<ol class="arabic simple">
<li>By integrating with the settings system, tasks can be added, removed,
and modified as easily and flexibly as settings.</li>
<li><a class="reference internal" href="../Extending/Input-Tasks.html"><em>Input Tasks</em></a> use <a class="reference internal" href="Parsing-Input.html"><em>parser combinators</em></a> to define the syntax for their arguments.
This allows flexible syntax and tab-completions in the same way as <a class="reference internal" href="../Extending/Commands.html"><em>Commands</em></a>.</li>
<li>Tasks produce values. Other tasks can access a task's value by calling <span class="pre">value</span> on it within a task definition.</li>
<li>Dynamically changing the structure of the task graph is possible.
Tasks can be injected into the execution graph based on the result of another task.</li>
<li>There are ways to handle task failure, similar to <span class="pre">try/catch/finally</span>.</li>
<li>Each task has access to its own Logger that by default persists the
logging for that task at a more verbose level than is initially
printed to the screen.</li>
</ol>
<p>These features are discussed in detail in the following sections.</p>
</div>
<div class="section" id="defining-a-task">
<h2>Defining a Task<a class="headerlink" href="#defining-a-task" title="Permalink to this headline">¶</a></h2>
<div class="section" id="hello-world-example-sbt">
<h3>Hello World example (sbt)<a class="headerlink" href="#hello-world-example-sbt" title="Permalink to this headline">¶</a></h3>
<p>build.sbt</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">lazy</span> <span class="k">val</span> <span class="n">hello</span> <span class="k">=</span> <span class="n">taskKey</span><span class="o">[</span><span class="kt">Unit</span><span class="o">](</span><span class="s">&quot;Prints &#39;Hello World&#39;&quot;</span><span class="o">)</span>

<span class="n">hello</span> <span class="o">:=</span> <span class="n">println</span><span class="o">(</span><span class="s">&quot;hello world!&quot;</span><span class="o">)</span>
</pre></div>
</div>
<p>Run &quot;sbt hello&quot; from command line to invoke the task. Run &quot;sbt tasks&quot; to
see this task listed.</p>
</div>
<div class="section" id="define-the-key">
<h3>Define the key<a class="headerlink" href="#define-the-key" title="Permalink to this headline">¶</a></h3>
<p>To declare a new task, define a lazy val of type <span class="pre">TaskKey</span>:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">lazy</span> <span class="k">val</span> <span class="n">sampleTask</span> <span class="k">=</span> <span class="n">taskKey</span><span class="o">[</span><span class="kt">Int</span><span class="o">](</span><span class="s">&quot;A sample task.&quot;</span><span class="o">)</span>
</pre></div>
</div>
<p>The name of the <span class="pre">val</span> is used when referring to the task in Scala code and at the command line.
The string passed to the <span class="pre">taskKey</span> method is a description of the task.
The type parameter passed to <span class="pre">taskKey</span> (here, <span class="pre">Int</span>) is the type of value produced by the task.</p>
<p>We'll define a couple of other keys for the examples:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">lazy</span> <span class="k">val</span> <span class="n">intTask</span> <span class="k">=</span> <span class="n">taskKey</span><span class="o">[</span><span class="kt">Int</span><span class="o">](</span><span class="s">&quot;An int task&quot;</span><span class="o">)</span>
<span class="k">lazy</span> <span class="k">val</span> <span class="n">stringTask</span> <span class="k">=</span> <span class="n">taskKey</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="s">&quot;A string task&quot;</span><span class="o">)</span>
</pre></div>
</div>
<p>The examples themselves are valid entries in a <span class="pre">build.sbt</span> or can be
provided as part of a sequence to <span class="pre">Project.settings</span> (see
<a class="reference internal" href="../Getting-Started/Full-Def.html"><em>Full Configuration</em></a>).</p>
</div>
<div class="section" id="implement-the-task">
<h3>Implement the task<a class="headerlink" href="#implement-the-task" title="Permalink to this headline">¶</a></h3>
<p>There are three main parts to implementing a task once its key is
defined:</p>
<ol class="arabic simple">
<li>Determine the settings and other tasks needed by the task. They are
the task's inputs.</li>
<li>Define the code that implements the task in terms of these inputs.</li>
<li>Determine the scope the task will go in.</li>
</ol>
<p>These parts are then combined just like the parts of a setting are combined.</p>
<div class="section" id="defining-a-basic-task">
<h4>Defining a basic task<a class="headerlink" href="#defining-a-basic-task" title="Permalink to this headline">¶</a></h4>
<p>A task is defined using <span class="pre">:=</span></p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">intTask</span> <span class="o">:=</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span>

<span class="n">stringTask</span> <span class="o">:=</span> <span class="nc">System</span><span class="o">.</span><span class="n">getProperty</span><span class="o">(</span><span class="s">&quot;user.name&quot;</span><span class="o">)</span>

<span class="n">sampleTask</span> <span class="o">:=</span> <span class="o">{</span>
   <span class="k">val</span> <span class="n">sum</span> <span class="k">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span>
   <span class="n">println</span><span class="o">(</span><span class="s">&quot;sum: &quot;</span> <span class="o">+</span> <span class="n">sum</span><span class="o">)</span>
   <span class="n">sum</span>
<span class="o">}</span>
</pre></div>
</div>
<p>As mentioned in the introduction, a task is evaluated on demand.
Each time <span class="pre">sampleTask</span> is invoked, for example, it will print the sum.
If the username changes between runs, <span class="pre">stringTask</span> will take different values in those separate runs.
(Within a run, each task is evaluated at most once.)
In contrast, settings are evaluated once on project load and are fixed until the next reload.</p>
</div>
<div class="section" id="tasks-with-inputs">
<h4>Tasks with inputs<a class="headerlink" href="#tasks-with-inputs" title="Permalink to this headline">¶</a></h4>
<p>Tasks with other tasks or settings as inputs are also defined using <span class="pre">:=</span>.
The values of the inputs are referenced by the <span class="pre">value</span> method.  This method
is special syntax and can only be called when defining a task, such as in the
argument to <span class="pre">:=</span>.  The following defines a task that adds one to the value
produced by <span class="pre">intTask</span> and returns the result.</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">sampleTask</span> <span class="o">:=</span> <span class="n">intTask</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Multiple settings are handled similarly:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">stringTask</span> <span class="o">:=</span> <span class="s">&quot;Sample: &quot;</span> <span class="o">+</span> <span class="n">sampleTask</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="s">&quot;, int: &quot;</span> <span class="o">+</span> <span class="n">intTask</span><span class="o">.</span><span class="n">value</span>
</pre></div>
</div>
</div>
<div class="section" id="task-scope">
<h4>Task Scope<a class="headerlink" href="#task-scope" title="Permalink to this headline">¶</a></h4>
<p>As with settings, tasks can be defined in a specific scope. For example,
there are separate <a class="pre reference external" href="../../sxr/sbt/Keys.scala.html#sbt.Keys.compile">compile</a> tasks for the <span class="pre">compile</span> and <span class="pre">test</span>
scopes. The scope of a task is defined the same as for a setting. In the
following example, <span class="pre">test:sampleTask</span> uses the result of
<span class="pre">compile:intTask</span>.</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">sampleTask</span> <span class="n">in</span> <span class="nc">Test</span> <span class="o">:=</span> <span class="o">(</span><span class="n">intTask</span> <span class="n">in</span> <span class="nc">Compile</span><span class="o">).</span><span class="n">value</span> <span class="o">*</span> <span class="mi">3</span>
</pre></div>
</div>
</div>
<div class="section" id="on-precedence">
<h4>On precedence<a class="headerlink" href="#on-precedence" title="Permalink to this headline">¶</a></h4>
<p>As a reminder, infix method precedence is by the name of the method and postfix methods have lower precedence than infix methods.</p>
<ol class="arabic simple">
<li>Assignment methods have the lowest precedence. These are methods with
names ending in <span class="pre">=</span>, except for <span class="pre">!=</span>, <span class="pre">&lt;=</span>, <span class="pre">&gt;=</span>, and names
that start with <span class="pre">=</span>.</li>
<li>Methods starting with a letter have the next highest precedence.</li>
<li>Methods with names that start with a symbol and aren't included in 1.
have the highest precedence. (This category is divided further
according to the specific character it starts with. See the Scala
specification for details.)</li>
</ol>
<p>Therefore, the the previous example is equivalent to the following:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="o">(</span><span class="n">sampleTask</span> <span class="n">in</span> <span class="nc">Test</span><span class="o">).:=(</span> <span class="o">(</span><span class="n">intTask</span> <span class="n">in</span> <span class="nc">Compile</span><span class="o">).</span><span class="n">value</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">)</span>
</pre></div>
</div>
<p>Additionally, the braces in the following are necessary:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">helloTask</span> <span class="o">:=</span> <span class="o">{</span> <span class="s">&quot;echo Hello&quot;</span> <span class="o">!</span> <span class="o">}</span>
</pre></div>
</div>
<p>Without them, Scala interprets the line as <span class="pre">( helloTask.:=(&quot;echo Hello&quot;) ).!</span>
instead of the desired <span class="pre">helloTask.:=( &quot;echo Hello&quot;.! )</span>.</p>
</div>
</div>
<div class="section" id="separating-implementations">
<h3>Separating implementations<a class="headerlink" href="#separating-implementations" title="Permalink to this headline">¶</a></h3>
<p>The implementation of a task can be separated from the binding.
For example, a basic separate definition looks like:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="c1">// Define a new, standalone task implemention</span>
<span class="k">lazy</span> <span class="k">val</span> <span class="n">intTaskImpl</span><span class="k">:</span> <span class="kt">Initialize</span><span class="o">[</span><span class="kt">Task</span><span class="o">[</span><span class="kt">Int</span><span class="o">]]</span> <span class="k">=</span>
   <span class="nc">Def</span><span class="o">.</span><span class="n">task</span> <span class="o">{</span> <span class="n">sampleTask</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">}</span>

<span class="c1">// Bind the implementation to a specific key</span>
<span class="n">intTask</span> <span class="o">:=</span> <span class="n">intTaskImpl</span><span class="o">.</span><span class="n">value</span>
</pre></div>
</div>
<p>Note that whenever <span class="pre">.value</span> is used, it must be within a task definition, such as
within <span class="pre">Def.task</span> above or as an argument to <span class="pre">:=</span>.</p>
</div>
<div class="section" id="modifying-an-existing-task">
<h3>Modifying an Existing Task<a class="headerlink" href="#modifying-an-existing-task" title="Permalink to this headline">¶</a></h3>
<p>In the general case, modify a task by declaring the previous task as an
input.</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="c1">// initial definition</span>
<span class="n">intTask</span> <span class="o">:=</span> <span class="mi">3</span>

<span class="c1">// overriding definition that references the previous definition</span>
<span class="n">intTask</span> <span class="o">:=</span> <span class="n">intTask</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Completely override a task by not declaring the previous task as an
input. Each of the definitions in the following example completely
overrides the previous one. That is, when <span class="pre">intTask</span> is run, it will
only print <span class="pre">#3</span>.</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">intTask</span> <span class="o">:=</span> <span class="o">{</span>
    <span class="n">println</span><span class="o">(</span><span class="s">&quot;#1&quot;</span><span class="o">)</span>
    <span class="mi">3</span>
<span class="o">}</span>

<span class="n">intTask</span> <span class="o">:=</span> <span class="o">{</span>
    <span class="n">println</span><span class="o">(</span><span class="s">&quot;#2&quot;</span><span class="o">)</span>
    <span class="mi">5</span>
<span class="o">}</span>

<span class="n">intTask</span> <span class="o">:=</span>  <span class="o">{</span>
    <span class="n">println</span><span class="o">(</span><span class="s">&quot;#3&quot;</span><span class="o">)</span>
    <span class="n">sampleTask</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="mi">3</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="getting-values-from-multiple-scopes">
<span id="multiple-scopes"></span><h2>Getting values from multiple scopes<a class="headerlink" href="#getting-values-from-multiple-scopes" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3>Introduction<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>The general form of an expression that gets values from multiple scopes is:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="o">&lt;</span><span class="n">setting</span><span class="o">-</span><span class="n">or</span><span class="o">-</span><span class="n">task</span><span class="o">&gt;.</span><span class="n">all</span><span class="o">(&lt;</span><span class="n">scope</span><span class="o">-</span><span class="n">filter</span><span class="o">&gt;).</span><span class="n">value</span>
</pre></div>
</div>
<p>The <span class="pre">all</span> method is implicitly added to tasks and settings.
It accepts a <span class="pre">ScopeFilter</span> that will select the <span class="pre">Scopes</span>.
The result has type <span class="pre">Seq[T]</span>, where <span class="pre">T</span> is the key's underlying type.</p>
</div>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>A common scenario is getting the sources for all subprojects for processing all at once, such as passing them to scaladoc.
The task that we want to obtain values for is <a class="pre reference external" href="../../sxr/sbt/Keys.scala.html#sbt.Keys.sources">sources</a> and we want to get the values in all non-root projects and in the <span class="pre">Compile</span> configuration.
This looks like:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">lazy</span> <span class="k">val</span> <span class="n">core</span> <span class="k">=</span> <span class="n">project</span>

<span class="k">lazy</span> <span class="k">val</span> <span class="n">util</span> <span class="k">=</span> <span class="n">project</span>

<span class="k">lazy</span> <span class="k">val</span> <span class="n">root</span> <span class="k">=</span> <span class="n">project</span><span class="o">.</span><span class="n">settings</span><span class="o">(</span>
   <span class="n">sources</span> <span class="o">:=</span> <span class="o">{</span>
      <span class="k">val</span> <span class="n">filter</span> <span class="k">=</span> <span class="nc">ScopeFilter</span><span class="o">(</span> <span class="n">inProjects</span><span class="o">(</span><span class="n">core</span><span class="o">,</span> <span class="n">util</span><span class="o">),</span> <span class="n">inConfigurations</span><span class="o">(</span><span class="nc">Compile</span><span class="o">)</span> <span class="o">)</span>
      <span class="c1">// each sources definition is of type Seq[File],</span>
      <span class="c1">//   giving us a Seq[Seq[File]] that we then flatten to Seq[File]</span>
      <span class="k">val</span> <span class="n">allSources</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[</span><span class="kt">Seq</span><span class="o">[</span><span class="kt">File</span><span class="o">]]</span> <span class="k">=</span> <span class="n">sources</span><span class="o">.</span><span class="n">all</span><span class="o">(</span><span class="n">filter</span><span class="o">).</span><span class="n">value</span>
      <span class="n">allSources</span><span class="o">.</span><span class="n">flatten</span>
   <span class="o">}</span>
<span class="o">)</span>
</pre></div>
</div>
<p>The next section describes various ways to construct a ScopeFilter.</p>
</div>
<div class="section" id="scopefilter">
<h3>ScopeFilter<a class="headerlink" href="#scopefilter" title="Permalink to this headline">¶</a></h3>
<p>A basic <span class="pre">ScopeFilter</span> is constructed by the <span class="pre">ScopeFilter.apply</span> method.
This method makes a <span class="pre">ScopeFilter</span> from filters on the parts of a <span class="pre">Scope</span>: a <span class="pre">ProjectFilter</span>, <span class="pre">ConfigurationFilter</span>, and <span class="pre">TaskFilter</span>.
The simplest case is explicitly specifying the values for the parts:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">val</span> <span class="n">filter</span><span class="k">:</span> <span class="kt">ScopeFilter</span> <span class="o">=</span>
   <span class="nc">ScopeFilter</span><span class="o">(</span>
      <span class="n">inProjects</span><span class="o">(</span> <span class="n">core</span><span class="o">,</span> <span class="n">util</span> <span class="o">),</span>
      <span class="n">inConfigurations</span><span class="o">(</span> <span class="nc">Compile</span><span class="o">,</span> <span class="nc">Test</span> <span class="o">)</span>
   <span class="o">)</span>
</pre></div>
</div>
<div class="section" id="unspecified-filters">
<h4>Unspecified filters<a class="headerlink" href="#unspecified-filters" title="Permalink to this headline">¶</a></h4>
<p>If the task filter is not specified, as in the example above, the default is to select scopes without a specific task (global).
Similarly, an unspecified configuration filter will select scopes in the global configuration.
The project filter should usually be explicit, but if left unspecified, the current project context will be used.</p>
</div>
<div class="section" id="more-on-filter-construction">
<h4>More on filter construction<a class="headerlink" href="#more-on-filter-construction" title="Permalink to this headline">¶</a></h4>
<p>The example showed the basic methods <span class="pre">inProjects</span> and <span class="pre">inConfigurations</span>.
This section describes all methods for constructing a <span class="pre">ProjectFilter</span>, <span class="pre">ConfigurationFilter</span>, or <span class="pre">TaskFilter</span>.
These methods can be organized into four groups:</p>
<ul class="simple">
<li>Explicit member list (<span class="pre">inProjects</span>, <span class="pre">inConfigurations</span>, <span class="pre">inTasks</span>)</li>
<li>Global value (<span class="pre">inGlobalProject</span>, <span class="pre">inGlobalConfiguration</span>, <span class="pre">inGlobalTask</span>)</li>
<li>Default filter (<span class="pre">inAnyProject</span>, <span class="pre">inAnyConfiguration</span>, <span class="pre">inAnyTask</span>)</li>
<li>Project relationships (<span class="pre">inAggregates</span>, <span class="pre">inDependencies</span>)</li>
</ul>
<p>See the <a class="reference external" href="../../api/sbt/ScopeFilter$$Make.html">API documentation</a> for details.</p>
</div>
<div class="section" id="combining-scopefilters">
<h4>Combining ScopeFilters<a class="headerlink" href="#combining-scopefilters" title="Permalink to this headline">¶</a></h4>
<p><span class="pre">ScopeFilters</span> may be combined with the <span class="pre">&amp;&amp;</span>, <span class="pre">||</span>, <span class="pre">--</span>, and <span class="pre">-</span> methods:</p>
<dl class="docutils">
<dt>a &amp;&amp; b</dt>
<dd>Selects scopes that match both <span class="pre">a</span> and <span class="pre">b</span></dd>
<dt>a || b</dt>
<dd>Selects scopes that match either <span class="pre">a</span> or <span class="pre">b</span></dd>
<dt>a -- b</dt>
<dd>Selects scopes that match <span class="pre">a</span> but not <span class="pre">b</span></dd>
<dt>-b</dt>
<dd>Selects scopes that do not match <span class="pre">b</span></dd>
</dl>
<p>For example, the following selects the scope for the <span class="pre">Compile</span> and <span class="pre">Test</span> configurations of the <span class="pre">core</span> project
and the global configuration of the <span class="pre">util</span> project:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">val</span> <span class="n">filter</span><span class="k">:</span> <span class="kt">ScopeFilter</span> <span class="o">=</span>
   <span class="nc">ScopeFilter</span><span class="o">(</span> <span class="n">inProjects</span><span class="o">(</span><span class="n">core</span><span class="o">),</span> <span class="n">inConfigurations</span><span class="o">(</span><span class="nc">Compile</span><span class="o">,</span> <span class="nc">Test</span><span class="o">))</span> <span class="o">||</span>
   <span class="nc">ScopeFilter</span><span class="o">(</span> <span class="n">inProjects</span><span class="o">(</span><span class="n">util</span><span class="o">),</span> <span class="n">inGlobalConfiguration</span> <span class="o">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="more-operations">
<h3>More operations<a class="headerlink" href="#more-operations" title="Permalink to this headline">¶</a></h3>
<p>The <span class="pre">all</span> method applies to both settings (values of type <span class="pre">Initialize[T]</span>)
and tasks (values of type <span class="pre">Initialize[Task[T]]</span>).
It returns a setting or task that provides a <span class="pre">Seq[T]</span>, as shown in this table:</p>
<table border="1" class="docutils">
<colgroup>
<col width="44%" />
<col width="56%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Target</th>
<th class="head">Result</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Initialize[T]</td>
<td>Initialize[Seq[T]]</td>
</tr>
<tr class="row-odd"><td>Initialize[Task[T]]</td>
<td>Initialize[Task[Seq[T]]]</td>
</tr>
</tbody>
</table>
<p>This means that the <span class="pre">all</span> method can be combined with methods that construct tasks and settings.</p>
<div class="section" id="missing-values">
<h4>Missing values<a class="headerlink" href="#missing-values" title="Permalink to this headline">¶</a></h4>
<p>Some scopes might not define a setting or task.
The <span class="pre">?</span> and <span class="pre">??</span> methods can help in this case.
They are both defined on settings and tasks and indicate what to do when a key is undefined.</p>
<dl class="docutils">
<dt><span class="pre">?</span></dt>
<dd>On a setting or task with underlying type <span class="pre">T</span>, this accepts no arguments and returns a setting or task (respectively) of type <span class="pre">Option[T]</span>.
The result is <span class="pre">None</span> if the setting/task is undefined and <span class="pre">Some[T]</span> with the value if it is.</dd>
<dt><span class="pre">??</span></dt>
<dd>On a setting or task with underlying type <span class="pre">T</span>, this accepts an argument of type <span class="pre">T</span> and uses this argument if the setting/task is undefined.</dd>
</dl>
<p>The following contrived example sets the maximum errors to be the maximum of all aggregates of the current project.</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">maxErrors</span> <span class="o">:=</span> <span class="o">{</span>
   <span class="c1">// select the transitive aggregates for this project, but not the project itself</span>
   <span class="k">val</span> <span class="n">filter</span><span class="k">:</span> <span class="kt">ScopeFilter</span> <span class="o">=</span>
      <span class="nc">ScopeFilter</span><span class="o">(</span> <span class="n">inAggregates</span><span class="o">(</span><span class="nc">ThisProject</span><span class="o">,</span> <span class="n">includeRoot</span><span class="k">=</span><span class="kc">false</span><span class="o">)</span> <span class="o">)</span>
   <span class="c1">// get the configured maximum errors in each selected scope,</span>
   <span class="c1">// using 0 if not defined in a scope</span>
   <span class="k">val</span> <span class="n">allVersions</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">=</span>
      <span class="o">(</span><span class="n">maxErrors</span> <span class="o">??</span> <span class="mi">0</span><span class="o">).</span><span class="n">all</span><span class="o">(</span><span class="n">filter</span><span class="o">).</span><span class="n">value</span>
   <span class="n">allVersions</span><span class="o">.</span><span class="n">max</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="multiple-values-from-multiple-scopes">
<h4>Multiple values from multiple scopes<a class="headerlink" href="#multiple-values-from-multiple-scopes" title="Permalink to this headline">¶</a></h4>
<p>The target of <span class="pre">all</span> is any task or setting, including anonymous ones.
This means it is possible to get multiple values at once without defining a new task or setting in each scope.
A common use case is to pair each value obtained with the project, configuration, or full scope it came from.</p>
<dl class="docutils">
<dt><a class="pre reference external" href="../../sxr/sbt/Keys.scala.html#sbt.Keys.resolvedScoped">resolvedScoped</a></dt>
<dd>Provides the full enclosing <span class="pre">ScopedKey</span> (which is a <span class="pre">Scope</span> + <span class="pre">AttributeKey[_]</span>)</dd>
<dt><a class="pre reference external" href="../../sxr/sbt/Keys.scala.html#sbt.Keys.thisProject">thisProject</a></dt>
<dd>Provides the <span class="pre">Project</span> associated with this scope (undefined at the global and build levels)</dd>
<dt><a class="pre reference external" href="../../sxr/sbt/Keys.scala.html#sbt.Keys.thisProjectRef">thisProjectRef</a></dt>
<dd>Provides the <span class="pre">ProjectRef</span> for the context (undefined at the global and build levels)</dd>
<dt><a class="pre reference external" href="../../sxr/sbt/Keys.scala.html#sbt.Keys.configuration">configuration</a></dt>
<dd>Provides the <span class="pre">Configuration</span> for the context (undefined for the global configuration)</dd>
</dl>
<p>For example, the following defines a task that prints non-Compile configurations that define
sbt plugins.  This might be used to identify an incorrectly configured build (or not, since this is
a fairly contrived example):</p>
<div class="highlight-scala"><div class="highlight"><pre> <span class="c1">// Select all configurations in the current project except for Compile</span>
 <span class="k">lazy</span> <span class="k">val</span> <span class="n">filter</span><span class="k">:</span> <span class="kt">ScopeFilter</span> <span class="o">=</span> <span class="nc">ScopeFilter</span><span class="o">(</span>
    <span class="n">inProjects</span><span class="o">(</span><span class="nc">ThisProject</span><span class="o">),</span>
    <span class="n">inAnyConfiguration</span> <span class="o">--</span> <span class="n">inConfigurations</span><span class="o">(</span><span class="nc">Compile</span><span class="o">)</span>
<span class="o">)</span>

 <span class="c1">// Define a task that provides the name of the current configuration</span>
 <span class="c1">//   and the set of sbt plugins defined in the configuration</span>
 <span class="k">lazy</span> <span class="k">val</span> <span class="n">pluginsWithConfig</span><span class="k">:</span> <span class="kt">Initialize</span><span class="o">[</span><span class="kt">Task</span><span class="o">[</span> <span class="o">(</span><span class="kt">String</span>, <span class="kt">Set</span><span class="o">[</span><span class="kt">String</span><span class="o">])</span> <span class="o">]]</span> <span class="k">=</span>
    <span class="nc">Def</span><span class="o">.</span><span class="n">task</span> <span class="o">{</span>
       <span class="o">(</span> <span class="n">configuration</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">name</span><span class="o">,</span> <span class="n">definedSbtPlugins</span><span class="o">.</span><span class="n">value</span> <span class="o">)</span>
    <span class="o">}</span>

 <span class="n">checkPluginsTask</span> <span class="o">:=</span> <span class="o">{</span>
    <span class="k">val</span> <span class="n">oddPlugins</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[(</span><span class="kt">String</span>, <span class="kt">Set</span><span class="o">[</span><span class="kt">String</span><span class="o">])]</span> <span class="k">=</span>
       <span class="n">pluginsWithConfig</span><span class="o">.</span><span class="n">all</span><span class="o">(</span><span class="n">filter</span><span class="o">).</span><span class="n">value</span>
    <span class="c1">// Print each configuration that defines sbt plugins</span>
    <span class="k">for</span><span class="o">(</span> <span class="o">(</span><span class="n">config</span><span class="o">,</span> <span class="n">plugins</span><span class="o">)</span> <span class="k">&lt;-</span> <span class="n">oddPlugins</span> <span class="k">if</span> <span class="n">plugins</span><span class="o">.</span><span class="n">nonEmpty</span> <span class="o">)</span>
       <span class="n">println</span><span class="o">(</span><span class="n">s</span><span class="s">&quot;$config defines sbt plugins: ${plugins.mkString(&quot;</span><span class="o">,</span> <span class="s">&quot;)}&quot;</span><span class="o">)</span>
 <span class="o">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="advanced-task-operations">
<h2>Advanced Task Operations<a class="headerlink" href="#advanced-task-operations" title="Permalink to this headline">¶</a></h2>
<p>The examples in this section use the task keys defined in the previous section.</p>
<div class="section" id="streams-per-task-logging">
<h3>Streams: Per-task logging<a class="headerlink" href="#streams-per-task-logging" title="Permalink to this headline">¶</a></h3>
<p>Per-task loggers are part of a more general system for task-specific data called Streams.
This allows controlling the verbosity of stack traces and logging individually for tasks as well
as recalling the last logging for a task.
Tasks also have access to their own persisted binary or text data.</p>
<p>To use Streams, get the value of the <a class="pre reference external" href="../../sxr/sbt/Keys.scala.html#sbt.Keys.streams">streams</a> task. This is a
special task that provides an instance of
<a class="reference external" href="../../api/sbt/std/TaskStreams.html">TaskStreams</a>
for the defining task. This type provides access to named binary and
text streams, named loggers, and a default logger. The default
<a class="reference external" href="../../api/sbt/Logger.html">Logger</a>,
which is the most commonly used aspect, is obtained by the <span class="pre">log</span>
method:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">myTask</span> <span class="o">:=</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">s</span><span class="k">:</span> <span class="kt">TaskStreams</span> <span class="o">=</span> <span class="n">streams</span><span class="o">.</span><span class="n">value</span>
  <span class="n">s</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="o">(</span><span class="s">&quot;Saying hi...&quot;</span><span class="o">)</span>
  <span class="n">s</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="o">(</span><span class="s">&quot;Hello!&quot;</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
</div>
<p>You can scope logging settings by the specific task's scope:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">logLevel</span> <span class="n">in</span> <span class="n">myTask</span> <span class="o">:=</span> <span class="nc">Level</span><span class="o">.</span><span class="nc">Debug</span>

<span class="n">traceLevel</span> <span class="n">in</span> <span class="n">myTask</span> <span class="o">:=</span> <span class="mi">5</span>
</pre></div>
</div>
<p>To obtain the last logging output from a task, use the <span class="pre">last</span> command:</p>
<div class="highlight-console"><div class="highlight"><pre><span class="gp">$</span> last myTask
<span class="go">[debug] Saying hi...</span>
<span class="go">[info] Hello!</span>
</pre></div>
</div>
<p>The verbosity with which logging is persisted is controlled using the
<a class="pre reference external" href="../../sxr/sbt/Keys.scala.html#sbt.Keys.persistLogLevel">persistLogLevel</a> and <a class="pre reference external" href="../../sxr/sbt/Keys.scala.html#sbt.Keys.persistTraceLevel">persistTraceLevel</a> settings. The <span class="pre">last</span>
command displays what was logged according to these levels. The levels
do not affect already logged information.</p>
</div>
<div class="section" id="dynamic-computations-with-def-taskdyn">
<h3>Dynamic Computations with <span class="pre">Def.taskDyn</span><a class="headerlink" href="#dynamic-computations-with-def-taskdyn" title="Permalink to this headline">¶</a></h3>
<p>It can be useful to use the result of a task to determine the
next tasks to evaluate.  This is done using <span class="pre">Def.taskDyn</span>.  The
result of <span class="pre">taskDyn</span> is called a dynamic task because it introduces
dependencies at runtime.  The <span class="pre">taskDyn</span> method supports the same
syntax as <span class="pre">Def.task</span> and <span class="pre">:=</span> except that you return a task instead
of a plain value.</p>
<p>For example,</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">val</span> <span class="n">dynamic</span> <span class="k">=</span> <span class="nc">Def</span><span class="o">.</span><span class="n">taskDyn</span> <span class="o">{</span>
   <span class="c1">// decide what to evaluate based on the value of `stringTask`</span>
   <span class="k">if</span><span class="o">(</span><span class="n">stringTask</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s">&quot;dev&quot;</span><span class="o">)</span>
      <span class="c1">// create the dev-mode task: this is only evaluated if the</span>
      <span class="c1">//   value of stringTask is &quot;dev&quot;</span>
      <span class="nc">Def</span><span class="o">.</span><span class="n">task</span> <span class="o">{</span>
         <span class="mi">3</span>
      <span class="o">}</span>
   <span class="k">else</span>
      <span class="c1">// create the production task: only evaluated if the value</span>
      <span class="c1">//    of the stringTask is not &quot;dev&quot;</span>
      <span class="nc">Def</span><span class="o">.</span><span class="n">task</span> <span class="o">{</span>
         <span class="n">intTask</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="mi">5</span>
      <span class="o">}</span>
<span class="o">}</span>


<span class="n">myTask</span> <span class="o">:=</span> <span class="o">{</span>
   <span class="k">val</span> <span class="n">num</span> <span class="k">=</span> <span class="n">dynamic</span><span class="o">.</span><span class="n">value</span>
             <span class="n">println</span><span class="o">(</span><span class="n">s</span><span class="s">&quot;Number selected was $num&quot;</span><span class="o">)</span>
     <span class="o">}</span>
</pre></div>
</div>
<p>The only static dependency of <span class="pre">myTask</span> is <span class="pre">stringTask</span>.
The dependency on <span class="pre">intTask</span> is only introduced in non-dev mode.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A dynamic task cannot refer to itself or a circular dependency will result.
In the example above, there would be a circular dependency if the code passed to <span class="pre">taskDyn</span> referenced <span class="pre">myTask</span>.</p>
</div>
</div>
<div class="section" id="handling-failure">
<h3>Handling Failure<a class="headerlink" href="#handling-failure" title="Permalink to this headline">¶</a></h3>
<p>This section discusses the <span class="pre">failure</span>, <span class="pre">result</span>, and <span class="pre">andFinally</span>
methods, which are used to handle failure of other tasks.</p>
<div class="section" id="failure">
<h4><span class="pre">failure</span><a class="headerlink" href="#failure" title="Permalink to this headline">¶</a></h4>
<p>The <span class="pre">failure</span> method creates a new task that returns the <span class="pre">Incomplete</span> value
when the original task fails to complete normally.  If the original task succeeds,
the new task fails.
<a class="reference external" href="../../api/sbt/Incomplete.html">Incomplete</a>
is an exception with information about any tasks that caused the failure
and any underlying exceptions thrown during task execution.</p>
<p>For example:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">intTask</span> <span class="o">:=</span> <span class="n">error</span><span class="o">(</span><span class="s">&quot;Failed.&quot;</span><span class="o">)</span>

<span class="n">intTask</span> <span class="o">:=</span> <span class="o">{</span>
   <span class="n">println</span><span class="o">(</span><span class="s">&quot;Ignoring failure: &quot;</span> <span class="o">+</span> <span class="n">intTask</span><span class="o">.</span><span class="n">failure</span><span class="o">.</span><span class="n">value</span><span class="o">)</span>
   <span class="mi">3</span>
<span class="o">}</span>
</pre></div>
</div>
<p>This overrides the <span class="pre">intTask</span> so that the original exception is printed and the constant <span class="pre">3</span> is returned.</p>
<p><span class="pre">failure</span> does not prevent other tasks that depend on the target
from failing. Consider the following example:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">intTask</span> <span class="o">:=</span> <span class="k">if</span><span class="o">(</span><span class="n">shouldSucceed</span><span class="o">)</span> <span class="mi">5</span> <span class="k">else</span> <span class="n">error</span><span class="o">(</span><span class="s">&quot;Failed.&quot;</span><span class="o">)</span>

<span class="c1">// Return 3 if intTask fails. If intTask succeeds, this task will fail.</span>
<span class="n">aTask</span> <span class="o">:=</span> <span class="n">intTask</span><span class="o">.</span><span class="n">failure</span><span class="o">.</span><span class="n">value</span> <span class="o">-</span> <span class="mi">2</span>

<span class="c1">// A new task that increments the result of intTask.</span>
<span class="n">bTask</span> <span class="o">:=</span> <span class="n">intTask</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="mi">1</span>

<span class="n">cTask</span> <span class="o">:=</span> <span class="n">aTask</span><span class="o">.</span><span class="n">value</span> <span class="o">+</span> <span class="n">bTask</span><span class="o">.</span><span class="n">value</span>
</pre></div>
</div>
<p>The following table lists the results of each task depending on the initially invoked task:</p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="18%" />
<col width="15%" />
<col width="17%" />
<col width="17%" />
<col width="17%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">invoked task</th>
<th class="head">intTask result</th>
<th class="head">aTask result</th>
<th class="head">bTask result</th>
<th class="head">cTask result</th>
<th class="head">overall result</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>intTask</td>
<td>failure</td>
<td>not run</td>
<td>not run</td>
<td>not run</td>
<td>failure</td>
</tr>
<tr class="row-odd"><td>aTask</td>
<td>failure</td>
<td>success</td>
<td>not run</td>
<td>not run</td>
<td>success</td>
</tr>
<tr class="row-even"><td>bTask</td>
<td>failure</td>
<td>not run</td>
<td>failure</td>
<td>not run</td>
<td>failure</td>
</tr>
<tr class="row-odd"><td>cTask</td>
<td>failure</td>
<td>success</td>
<td>failure</td>
<td>failure</td>
<td>failure</td>
</tr>
<tr class="row-even"><td>intTask</td>
<td>success</td>
<td>not run</td>
<td>not run</td>
<td>not run</td>
<td>success</td>
</tr>
<tr class="row-odd"><td>aTask</td>
<td>success</td>
<td>failure</td>
<td>not run</td>
<td>not run</td>
<td>failure</td>
</tr>
<tr class="row-even"><td>bTask</td>
<td>success</td>
<td>not run</td>
<td>success</td>
<td>not run</td>
<td>success</td>
</tr>
<tr class="row-odd"><td>cTask</td>
<td>success</td>
<td>failure</td>
<td>success</td>
<td>failure</td>
<td>failure</td>
</tr>
</tbody>
</table>
<p>The overall result is always the same as the root task (the directly
invoked task). A <span class="pre">failure</span> turns a success into a failure, and a failure into an <span class="pre">Incomplete</span>.
A normal task definition fails when any of its inputs fail and computes its value otherwise.</p>
</div>
<div class="section" id="result">
<h4><span class="pre">result</span><a class="headerlink" href="#result" title="Permalink to this headline">¶</a></h4>
<p>The <span class="pre">result</span> method creates a new task that returns the full <span class="pre">Result[T]</span> value for the original task.
<a class="reference external" href="../../api/sbt/Result.html">Result</a>
has the same structure as <span class="pre">Either[Incomplete, T]</span> for a task result of
type <span class="pre">T</span>. That is, it has two subtypes:</p>
<ul class="simple">
<li><span class="pre">Inc</span>, which wraps <span class="pre">Incomplete</span> in case of failure</li>
<li><span class="pre">Value</span>, which wraps a task's result in case of success.</li>
</ul>
<p>Thus, the task created by <span class="pre">result</span> executes whether or not the original task succeeds or fails.</p>
<p>For example:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">intTask</span> <span class="o">:=</span> <span class="n">error</span><span class="o">(</span><span class="s">&quot;Failed.&quot;</span><span class="o">)</span>

<span class="n">intTask</span> <span class="o">:=</span> <span class="n">intTask</span><span class="o">.</span><span class="n">result</span><span class="o">.</span><span class="n">value</span> <span class="k">match</span> <span class="o">{</span>
   <span class="k">case</span> <span class="nc">Inc</span><span class="o">(</span><span class="n">inc</span><span class="k">:</span> <span class="kt">Incomplete</span><span class="o">)</span> <span class="k">=&gt;</span>
      <span class="n">println</span><span class="o">(</span><span class="s">&quot;Ignoring failure: &quot;</span> <span class="o">+</span> <span class="n">inc</span><span class="o">)</span>
      <span class="mi">3</span>
   <span class="k">case</span> <span class="nc">Value</span><span class="o">(</span><span class="n">v</span><span class="o">)</span> <span class="k">=&gt;</span>
      <span class="n">println</span><span class="o">(</span><span class="s">&quot;Using successful result: &quot;</span> <span class="o">+</span> <span class="n">v</span><span class="o">)</span>
      <span class="n">v</span>
<span class="o">}</span>
</pre></div>
</div>
<p>This overrides the original <span class="pre">intTask</span> definition so that if the original task fails, the exception is printed and the constant <span class="pre">3</span> is returned. If it succeeds, the value is printed and returned.</p>
</div>
<div class="section" id="andfinally">
<h4>andFinally<a class="headerlink" href="#andfinally" title="Permalink to this headline">¶</a></h4>
<p>The <span class="pre">andFinally</span> method defines a new task that runs the original task
and evaluates a side effect regardless of whether the original task
succeeded. The result of the task is the result of the original task.
For example:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">intTask</span> <span class="o">:=</span> <span class="n">error</span><span class="o">(</span><span class="s">&quot;I didn&#39;t succeed.&quot;</span><span class="o">)</span>

<span class="k">lazy</span> <span class="k">val</span> <span class="n">intTaskImpl</span> <span class="k">=</span> <span class="n">intTask</span> <span class="n">andFinally</span> <span class="o">{</span> <span class="n">println</span><span class="o">(</span><span class="s">&quot;andFinally&quot;</span><span class="o">)</span> <span class="o">}</span>

<span class="n">intTask</span> <span class="o">:=</span> <span class="n">intTaskImpl</span><span class="o">.</span><span class="n">value</span>
</pre></div>
</div>
<p>This modifies the original <span class="pre">intTask</span> to always print &quot;andFinally&quot; even
if the task fails.</p>
<p>Note that <span class="pre">andFinally</span> constructs a new task. This means that the new
task has to be invoked in order for the extra block to run. This is
important when calling andFinally on another task instead of overriding
a task like in the previous example. For example, consider this code:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="n">intTask</span> <span class="o">:=</span> <span class="n">error</span><span class="o">(</span><span class="s">&quot;I didn&#39;t succeed.&quot;</span><span class="o">)</span>

<span class="k">lazy</span> <span class="k">val</span> <span class="n">intTaskImpl</span> <span class="k">=</span> <span class="n">intTask</span> <span class="n">andFinally</span> <span class="o">{</span> <span class="n">println</span><span class="o">(</span><span class="s">&quot;andFinally&quot;</span><span class="o">)</span> <span class="o">}</span>

<span class="n">otherIntTask</span> <span class="o">:=</span> <span class="n">intTaskImpl</span><span class="o">.</span><span class="n">value</span>
</pre></div>
</div>
<p>If <span class="pre">intTask</span> is run directly, <span class="pre">otherIntTask</span> is never involved in
execution. This case is similar to the following plain Scala code:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">def</span> <span class="n">intTask</span><span class="o">()</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span>
  <span class="n">error</span><span class="o">(</span><span class="s">&quot;I didn&#39;t succeed.&quot;</span><span class="o">)</span>

<span class="k">def</span> <span class="n">otherIntTask</span><span class="o">()</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span>
  <span class="k">try</span> <span class="o">{</span> <span class="n">intTask</span><span class="o">()</span> <span class="o">}</span>
  <span class="k">finally</span> <span class="o">{</span> <span class="n">println</span><span class="o">(</span><span class="s">&quot;finally&quot;</span><span class="o">)</span> <span class="o">}</span>

<span class="n">intTask</span><span class="o">()</span>
</pre></div>
</div>
<p>It is obvious here that calling intTask() will never result in &quot;finally&quot;
being printed.</p>
<p><p class="page-source"><a class="reference external" href="https://github.com/sbt/sbt/raw/0.13.2/src/sphinx/Detailed-Topics/Tasks.rst">Source for this page</a></p>
</p>
</div>
</div>
</div>
</div>


          </div>
          <div class="span3"><p class="contents-title">Contents</p>
              <div id="scroller-anchor">
                <div id="scroller">
                  <div id="toc"><ul>
<li><a class="reference internal" href="#">Tasks</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#features">Features</a></li>
<li><a class="reference internal" href="#defining-a-task">Defining a Task</a><ul>
<li><a class="reference internal" href="#hello-world-example-sbt">Hello World example (sbt)</a></li>
<li><a class="reference internal" href="#define-the-key">Define the key</a></li>
<li><a class="reference internal" href="#implement-the-task">Implement the task</a><ul>
<li><a class="reference internal" href="#defining-a-basic-task">Defining a basic task</a></li>
<li><a class="reference internal" href="#tasks-with-inputs">Tasks with inputs</a></li>
<li><a class="reference internal" href="#task-scope">Task Scope</a></li>
<li><a class="reference internal" href="#on-precedence">On precedence</a></li>
</ul>
</li>
<li><a class="reference internal" href="#separating-implementations">Separating implementations</a></li>
<li><a class="reference internal" href="#modifying-an-existing-task">Modifying an Existing Task</a></li>
</ul>
</li>
<li><a class="reference internal" href="#getting-values-from-multiple-scopes">Getting values from multiple scopes</a><ul>
<li><a class="reference internal" href="#id1">Introduction</a></li>
<li><a class="reference internal" href="#example">Example</a></li>
<li><a class="reference internal" href="#scopefilter">ScopeFilter</a><ul>
<li><a class="reference internal" href="#unspecified-filters">Unspecified filters</a></li>
<li><a class="reference internal" href="#more-on-filter-construction">More on filter construction</a></li>
<li><a class="reference internal" href="#combining-scopefilters">Combining ScopeFilters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#more-operations">More operations</a><ul>
<li><a class="reference internal" href="#missing-values">Missing values</a></li>
<li><a class="reference internal" href="#multiple-values-from-multiple-scopes">Multiple values from multiple scopes</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#advanced-task-operations">Advanced Task Operations</a><ul>
<li><a class="reference internal" href="#streams-per-task-logging">Streams: Per-task logging</a></li>
<li><a class="reference internal" href="#dynamic-computations-with-def-taskdyn">Dynamic Computations with <span class="pre">Def.taskDyn</span></a></li>
<li><a class="reference internal" href="#handling-failure">Handling Failure</a><ul>
<li><a class="reference internal" href="#failure"><span class="pre">failure</span></a></li>
<li><a class="reference internal" href="#result"><span class="pre">result</span></a></li>
<li><a class="reference internal" href="#andfinally">andFinally</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
                </div>
              </div></div>
        </div>
      </div>
    </div>
  </div>  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-41449189-1', 'scala-sbt.org');
  ga('send', 'pageview');

  </script>
  

  </body>
</html>