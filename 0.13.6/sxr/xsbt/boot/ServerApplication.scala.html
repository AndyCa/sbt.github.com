<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>xsbt/boot/ServerApplication.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> xsbt
<span class="keyword">package</span> boot

<span class="keyword">import</span> java.io.File
<span class="keyword">import</span> scala.util.control.NonFatal
<span class="keyword">import</span> java.net.URI
<span class="keyword">import</span> java.io.IOException
<span class="keyword">import</span> <a href="Pre.scala.html#xsbt.boot.Pre" title="xsbt.boot.Pre.type">Pre</a>._
<span class="keyword">import</span> scala.annotation.tailrec

<span class="comment">/** A wrapper around 'raw' static methods to meet the sbt application interface. */</span>
<span class="keyword">class</span> <a title="class ServerApplication extends Object with xsbti.AppMain" id="xsbt.boot;ServerApplication">ServerApplication</a> <a href="#xsbt.boot;ServerApplication" title="xsbt.boot.ServerApplication" class="keyword">private</a> <span class="delimiter">(</span><a title="xsbti.AppProvider" id="xsbt.boot;ServerApplication.provider">provider</a>: xsbti.<a href="../../xsbti/AppProvider.java.html#xsbti;AppProvider" title="xsbti.AppProvider">AppProvider</a><span class="delimiter">)</span> <span class="keyword">extends</span> xsbti.<a href="../../xsbti/AppMain.java.html#xsbti;AppMain" title="xsbti.AppMain">AppMain</a> <span class="delimiter">{</span>
  <span class="keyword">import</span> <a href="#xsbt.boot.ServerApplication" title="xsbt.boot.ServerApplication.type">ServerApplication</a>._

  <span class="keyword">override</span> <span class="keyword">def</span> <a title="(configuration: xsbti.AppConfiguration)xsbti.MainResult" id="xsbt.boot;ServerApplication.run">run</a><span class="delimiter">(</span><a title="xsbti.AppConfiguration" id="xsbt.boot;ServerApplication.run.configuration">configuration</a>: xsbti.<a href="../../xsbti/AppConfiguration.java.html#xsbti;AppConfiguration" title="xsbti.AppConfiguration">AppConfiguration</a><span class="delimiter">)</span>: xsbti.<a href="../../xsbti/MainResult.java.html#xsbti;MainResult" title="xsbti.MainResult">MainResult</a> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="xsbti.ServerMain" id="xsbt.boot;ServerApplication.run.serverMain">serverMain</a> = <a href="#xsbt.boot;ServerApplication.provider" title="xsbti.AppProvider">provider</a>.<a href="../../xsbti/AppProvider.java.html#xsbti;AppProvider.entryPoint" title="()Class[_]">entryPoint</a>.<span title="(x$1: Class[xsbti.ServerMain])Class[_ &lt;: xsbti.ServerMain]">asSubclass</span><span class="delimiter">(</span><a href="#xsbt.boot.ServerApplication.ServerMainClass" title="=&gt; Class[xsbti.ServerMain]">ServerMainClass</a><span class="delimiter">)</span>.<span title="()?0">newInstance</span>
    <span class="keyword">val</span> <a title="xsbti.Server" id="xsbt.boot;ServerApplication.run.server">server</a> = <a href="#xsbt.boot;ServerApplication.run.serverMain" title="xsbti.ServerMain">serverMain</a>.<a href="../../xsbti/ServerMain.java.html#xsbti;ServerMain.start" title="(configuration: xsbti.AppConfiguration)xsbti.Server">start</a><span class="delimiter">(</span><a href="#xsbt.boot;ServerApplication.run.configuration" title="xsbti.AppConfiguration">configuration</a><span class="delimiter">)</span>
    <span title="System.type">System</span>.<span title="java.io.PrintStream">out</span>.<span title="(x$1: String)Unit">println</span><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;&quot;)">$</span><span class="delimiter">{</span><a href="#xsbt.boot.ServerApplication.SERVER_SYNCH_TEXT" title="=&gt; String">SERVER_SYNCH_TEXT</a><span class="delimiter">}</span><span title="String(&quot;&quot;)">$</span><span class="delimiter">{</span><a href="#xsbt.boot;ServerApplication.run.server" title="xsbti.Server">server</a>.<a href="../../xsbti/Server.java.html#xsbti;Server.uri" title="()java.net.URI">uri</a><span class="delimiter">}</span><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span>
    <a href="#xsbt.boot;ServerApplication.run.server" title="xsbti.Server">server</a>.<a href="../../xsbti/Server.java.html#xsbti;Server.awaitTermination" title="()xsbti.MainResult">awaitTermination</a><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>
<span class="comment">/** An object that lets us detect compatible &quot;plain&quot; applications and launch them reflectively. */</span>
<span class="keyword">object</span> <a title="xsbt.boot.ServerApplication.type" id="xsbt.boot.ServerApplication">ServerApplication</a> <a href="#xsbt.boot.ServerApplication" title="xsbt.boot.ServerApplication.type" class="delimiter">{</a>
  <span class="keyword">val</span> <a title="String" id="xsbt.boot.ServerApplication.SERVER_SYNCH_TEXT">SERVER_SYNCH_TEXT</a> = <span title="String(&quot;[SERVER-URI]&quot;)" class="string">&quot;[SERVER-URI]&quot;</span>
  <span class="keyword">val</span> <a title="Class[xsbti.ServerMain]" id="xsbt.boot.ServerApplication.ServerMainClass">ServerMainClass</a> = classOf<span title="Class[xsbti.ServerMain](classOf[xsbti.ServerMain])" class="delimiter">[</span>xsbti.ServerMain<span class="delimiter">]</span>
  <span class="comment">// TODO - We should also adapt friendly static methods into servers, perhaps...</span>
  <span class="comment">// We could even structurally type things that have a uri + awaitTermination method...</span>
  <span class="keyword">def</span> <a title="(clazz: Class[_])Boolean" id="xsbt.boot.ServerApplication.isServerApplication">isServerApplication</a><span class="delimiter">(</span><a title="Class[_]" id="xsbt.boot.ServerApplication.isServerApplication.clazz">clazz</a>: <span title="Class[_]">Class</span><span class="delimiter">[</span>_<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> =
    <a href="#xsbt.boot.ServerApplication.ServerMainClass" title="=&gt; Class[xsbti.ServerMain]">ServerMainClass</a>.<span title="(x$1: Class[_])Boolean">isAssignableFrom</span><span class="delimiter">(</span><a href="#xsbt.boot.ServerApplication.isServerApplication.clazz" title="Class[_]">clazz</a><span class="delimiter">)</span>
  <span class="keyword">def</span> <a title="(provider: xsbti.AppProvider)xsbti.AppMain" id="xsbt.boot.ServerApplication.apply">apply</a><span class="delimiter">(</span><a title="xsbti.AppProvider" id="xsbt.boot.ServerApplication.apply.provider">provider</a>: xsbti.<a href="../../xsbti/AppProvider.java.html#xsbti;AppProvider" title="xsbti.AppProvider">AppProvider</a><span class="delimiter">)</span>: xsbti.<a href="../../xsbti/AppMain.java.html#xsbti;AppMain" title="xsbti.AppMain">AppMain</a> =
    <span title="xsbt.boot.ServerApplication" class="keyword">new</span> <a href="#xsbt.boot;ServerApplication" title="xsbt.boot.ServerApplication">ServerApplication</a><span class="delimiter">(</span><a href="#xsbt.boot.ServerApplication.apply.provider" title="xsbti.AppProvider">provider</a><span class="delimiter">)</span>

<span class="delimiter">}</span>
<span title="AnyRef" class="keyword">object</span> <a title="xsbt.boot.ServerLocator.type" id="xsbt.boot.ServerLocator">ServerLocator</a> <a href="#xsbt.boot.ServerLocator" title="xsbt.boot.ServerLocator.type" class="delimiter">{</a>
  <span class="comment">// TODO - Probably want to drop this to reduce classfile size</span>
  <span class="keyword">private</span> <span class="keyword">def</span> <a title="[U](file: java.io.File)(f: =&gt; U)U" id="xsbt.boot.ServerLocator.locked">locked</a><span class="delimiter">[</span><a title="" id="xsbt.boot.ServerLocator.locked;U">U</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="java.io.File" id="xsbt.boot.ServerLocator.locked.file">file</a>: <span title="java.io.File">File</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="=&gt; U" id="xsbt.boot.ServerLocator.locked.f">f</a>: =&gt; U<span class="delimiter">)</span>: <a href="#xsbt.boot.ServerLocator.locked;U" title="U">U</a> = <span class="delimiter">{</span>
    <a href="Locks.scala.html#xsbt.boot.Locks.apply" title="(file: java.io.File, action: java.util.concurrent.Callable[U])U">Locks</a><span class="delimiter">(</span><a href="#xsbt.boot.ServerLocator.locked.file" title="java.io.File">file</a>, <a href="#xsbt.boot.ServerLocator.locked;$anon" title="java.util.concurrent.Callable[U]" class="keyword">new</a> <a title="anonymous class $anon extends Object with java.util.concurrent.Callable[U]" id="xsbt.boot.ServerLocator.locked;$anon">java</a>.util.concurrent.<span title="java.util.concurrent.Callable[U]">Callable</span><span class="delimiter">[</span>U<span class="delimiter">]</span> <span class="delimiter">{</span>
      <span class="keyword">def</span> <a title="()U" id="xsbt.boot.ServerLocator.locked;$anon.call">call</a><span class="delimiter">(</span><span class="delimiter">)</span>: <a href="#xsbt.boot.ServerLocator.locked;U" title="U">U</a> = <a href="#xsbt.boot.ServerLocator.locked.f" title="=&gt; U">f</a>
    <span class="delimiter">}</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  <span class="comment">// We use the lock file they give us to write the server info.  However,</span>
  <span class="comment">// it seems we cannot both use the server info file for locking *and*</span>
  <span class="comment">// read from it successfully.  Locking seems to blank the file. SO, we create</span>
  <span class="comment">// another file near the info file to lock.a</span>
  <span class="keyword">def</span> <a title="(f: java.io.File)java.io.File" id="xsbt.boot.ServerLocator.makeLockFile">makeLockFile</a><span class="delimiter">(</span><a title="java.io.File" id="xsbt.boot.ServerLocator.makeLockFile.f">f</a>: <span title="java.io.File">File</span><span class="delimiter">)</span>: <span title="java.io.File">File</span> =
    <span title="(x$1: java.io.File, x$2: String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span><span class="delimiter">(</span><a href="#xsbt.boot.ServerLocator.makeLockFile.f" title="java.io.File">f</a>.<span title="()java.io.File">getParentFile</span>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;&quot;)">$</span><span class="delimiter">{</span><a href="#xsbt.boot.ServerLocator.makeLockFile.f" title="java.io.File">f</a>.<span title="()String">getName</span><span class="delimiter">}</span><span title="String(&quot;.lock&quot;)" class="string">.lock&quot;</span><span class="delimiter">)</span>
  <span class="comment">// Launch the process and read the port...</span>
  <span class="keyword">def</span> <a title="(currentDirectory: java.io.File, config: xsbt.boot.LaunchConfiguration)java.net.URI" id="xsbt.boot.ServerLocator.locate">locate</a><span class="delimiter">(</span><a title="java.io.File" id="xsbt.boot.ServerLocator.locate.currentDirectory">currentDirectory</a>: <span title="java.io.File">File</span>, <a title="xsbt.boot.LaunchConfiguration" id="xsbt.boot.ServerLocator.locate.config">config</a>: <a href="LaunchConfiguration.scala.html#xsbt.boot;LaunchConfiguration" title="xsbt.boot.LaunchConfiguration">LaunchConfiguration</a><span class="delimiter">)</span>: <span title="java.net.URI">URI</span> =
    <a href="#xsbt.boot.ServerLocator.locate.config" title="xsbt.boot.LaunchConfiguration">config</a>.<a href="LaunchConfiguration.scala.html#xsbt.boot;LaunchConfiguration.serverConfig" title="=&gt; Option[xsbt.boot.ServerConfiguration]">serverConfig</a> <span title="java.net.URI" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="None.type">None</span> =&gt; sys.<span title="(message: String)Nothing">error</span><span class="delimiter">(</span><span title="String(&quot;No server lock file configured.  Cannot locate server.&quot;)" class="string">&quot;No server lock file configured.  Cannot locate server.&quot;</span><span class="delimiter">)</span>
      <span class="keyword">case</span> Some<span class="delimiter">(</span><a title="xsbt.boot.ServerConfiguration" id="xsbt.boot.ServerLocator.locate.sc">sc</a><span class="delimiter">)</span> =&gt; <a href="#xsbt.boot.ServerLocator.locked" title="(file: java.io.File)(f: =&gt; java.net.URI)java.net.URI">locked</a><span class="delimiter">(</span><a href="#xsbt.boot.ServerLocator.makeLockFile" title="(f: java.io.File)java.io.File">makeLockFile</a><span class="delimiter">(</span><a href="#xsbt.boot.ServerLocator.locate.sc" title="xsbt.boot.ServerConfiguration">sc</a>.<a href="LaunchConfiguration.scala.html#xsbt.boot;ServerConfiguration.lockFile" title="=&gt; java.io.File">lockFile</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
        <a href="#xsbt.boot.ServerLocator.readProperties" title="(f: java.io.File)Option[java.net.URI]">readProperties</a><span class="delimiter">(</span><a href="#xsbt.boot.ServerLocator.locate.sc" title="xsbt.boot.ServerConfiguration">sc</a>.<a href="LaunchConfiguration.scala.html#xsbt.boot;ServerConfiguration.lockFile" title="=&gt; java.io.File">lockFile</a><span class="delimiter">)</span> <span title="java.net.URI" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> Some<span class="delimiter">(</span><span title="java.net.URI">uri</span><span class="delimiter">)</span> <span class="keyword">if</span> <a href="#xsbt.boot.ServerLocator.isReachable" title="(uri: java.net.URI)Boolean">isReachable</a><span class="delimiter">(</span><span title="java.net.URI">uri</span><span class="delimiter">)</span> =&gt; <span title="java.net.URI">uri</span>
          <span class="keyword">case</span> _ =&gt;
            <span class="keyword">val</span> <span title="java.net.URI">uri</span> = <a href="#xsbt.boot.ServerLauncher" title="xsbt.boot.ServerLauncher.type">ServerLauncher</a>.<a href="#xsbt.boot.ServerLauncher.startServer" title="(currentDirectory: java.io.File, config: xsbt.boot.LaunchConfiguration)java.net.URI">startServer</a><span class="delimiter">(</span><a href="#xsbt.boot.ServerLocator.locate.currentDirectory" title="java.io.File">currentDirectory</a>, <a href="#xsbt.boot.ServerLocator.locate.config" title="xsbt.boot.LaunchConfiguration">config</a><span class="delimiter">)</span>
            <a href="#xsbt.boot.ServerLocator.writeProperties" title="(f: java.io.File, uri: java.net.URI)Unit">writeProperties</a><span class="delimiter">(</span><a href="#xsbt.boot.ServerLocator.locate.sc" title="xsbt.boot.ServerConfiguration">sc</a>.<a href="LaunchConfiguration.scala.html#xsbt.boot;ServerConfiguration.lockFile" title="=&gt; java.io.File">lockFile</a>, <span title="java.net.URI">uri</span><span class="delimiter">)</span>
            <span title="java.net.URI">uri</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>

  <span class="keyword">private</span> <span class="keyword">val</span> <a title="String" id="xsbt.boot.ServerLocator.SERVER_URI_PROPERTY">SERVER_URI_PROPERTY</a> = <span title="String(&quot;server.uri&quot;)" class="string">&quot;server.uri&quot;</span>
  <span class="keyword">def</span> <a title="(f: java.io.File)Option[java.net.URI]" id="xsbt.boot.ServerLocator.readProperties">readProperties</a><span class="delimiter">(</span><a title="java.io.File" id="xsbt.boot.ServerLocator.readProperties.f">f</a>: <span title="java.io.File">File</span><span class="delimiter">)</span>: <span title="Option[java.net.URI]">Option</span><span class="delimiter">[</span>java.net.URI<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="java.util.Properties" id="xsbt.boot.ServerLocator.readProperties.props">props</a> = <a href="Pre.scala.html#xsbt.boot.Pre" title="xsbt.boot.Pre.type">Pre</a>.<a href="Pre.scala.html#xsbt.boot.Pre.readProperties" title="(propertiesFile: java.io.File)java.util.Properties">readProperties</a><span class="delimiter">(</span><a href="#xsbt.boot.ServerLocator.readProperties.f" title="java.io.File">f</a><span class="delimiter">)</span>
      <a href="#xsbt.boot.ServerLocator.readProperties.props" title="java.util.Properties">props</a>.<span title="(x$1: String)String">getProperty</span><span class="delimiter">(</span><a href="#xsbt.boot.ServerLocator.SERVER_URI_PROPERTY" title="=&gt; String">SERVER_URI_PROPERTY</a><span class="delimiter">)</span> <span title="Option[java.net.URI]" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> <span title="Null(null)" class="keyword">null</span> =&gt; <span title="None.type">None</span>
        <span class="keyword">case</span> <a title="String" id="xsbt.boot.ServerLocator.readProperties.uri">uri</a>  =&gt; <span title="(x: java.net.URI)Some[java.net.URI]">Some</span><span class="delimiter">(</span><span title="java.net.URI" class="keyword">new</span> java.net.<span title="java.net.URI">URI</span><span class="delimiter">(</span><a href="#xsbt.boot.ServerLocator.readProperties.uri" title="String">uri</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="java.io.IOException" id="xsbt.boot.ServerLocator.readProperties.e">e</a>: <span title="java.io.IOException">IOException</span> =&gt; <span title="None.type">None</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
  <span class="keyword">def</span> <a title="(f: java.io.File, uri: java.net.URI)Unit" id="xsbt.boot.ServerLocator.writeProperties">writeProperties</a><span class="delimiter">(</span><a title="java.io.File" id="xsbt.boot.ServerLocator.writeProperties.f">f</a>: <span title="java.io.File">File</span>, <a title="java.net.URI" id="xsbt.boot.ServerLocator.writeProperties.uri">uri</a>: <span title="java.net.URI">URI</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="java.util.Properties" id="xsbt.boot.ServerLocator.writeProperties.props">props</a> = <span title="java.util.Properties" class="keyword">new</span> java.util.<span title="java.util.Properties">Properties</span>
    <a href="#xsbt.boot.ServerLocator.writeProperties.props" title="java.util.Properties">props</a>.<span title="(x$1: String, x$2: String)Object">setProperty</span><span class="delimiter">(</span><a href="#xsbt.boot.ServerLocator.SERVER_URI_PROPERTY" title="=&gt; String">SERVER_URI_PROPERTY</a>, <a href="#xsbt.boot.ServerLocator.writeProperties.uri" title="java.net.URI">uri</a>.<span title="()String">toASCIIString</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="java.io.FileOutputStream" id="xsbt.boot.ServerLocator.writeProperties.output">output</a> = <span title="(x$1: java.io.File)java.io.FileOutputStream" class="keyword">new</span> java.io.<span title="java.io.FileOutputStream">FileOutputStream</span><span class="delimiter">(</span><a href="#xsbt.boot.ServerLocator.writeProperties.f" title="java.io.File">f</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="java.text.SimpleDateFormat" id="xsbt.boot.ServerLocator.writeProperties.df">df</a> = <span title="(x$1: String)java.text.SimpleDateFormat" class="keyword">new</span> java.text.<span title="java.text.SimpleDateFormat">SimpleDateFormat</span><span class="delimiter">(</span><span title="String(&quot;yyyy-MM-dd\'T\'HH:mmZ&quot;)" class="string">&quot;yyyy-MM-dd'T'HH:mmZ&quot;</span><span class="delimiter">)</span>
    <a href="#xsbt.boot.ServerLocator.writeProperties.df" title="java.text.SimpleDateFormat">df</a>.<span title="(x$1: java.util.TimeZone)Unit">setTimeZone</span><span class="delimiter">(</span>java.util.<span title="java.util.TimeZone.type">TimeZone</span>.<span title="(x$1: String)java.util.TimeZone">getTimeZone</span><span class="delimiter">(</span><span title="String(&quot;UTC&quot;)" class="string">&quot;UTC&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <a href="Pre.scala.html#xsbt.boot.Pre" title="xsbt.boot.Pre.type">Pre</a>.<a href="Pre.scala.html#xsbt.boot.Pre.writeProperties" title="(properties: java.util.Properties, file: java.io.File, msg: String)Unit">writeProperties</a><span class="delimiter">(</span><a href="#xsbt.boot.ServerLocator.writeProperties.props" title="java.util.Properties">props</a>, <a href="#xsbt.boot.ServerLocator.writeProperties.f" title="java.io.File">f</a>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Server Startup at &quot;)">Server Startup at $</span><span class="delimiter">{</span><a href="#xsbt.boot.ServerLocator.writeProperties.df" title="java.text.SimpleDateFormat">df</a>.<span title="(x$1: java.util.Date)String">format</span><span class="delimiter">(</span><span title="java.util.Date" class="keyword">new</span> java.util.<span title="java.util.Date">Date</span><span class="delimiter">)</span><span class="delimiter">}</span><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(uri: java.net.URI)Boolean" id="xsbt.boot.ServerLocator.isReachable">isReachable</a><span class="delimiter">(</span><a title="java.net.URI" id="xsbt.boot.ServerLocator.isReachable.uri">uri</a>: java.net.<span title="java.net.URI">URI</span><span class="delimiter">)</span>: <span title="Boolean">Boolean</span> =
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <span class="comment">// TODO - For now we assume if we can connect, it means</span>
      <span class="comment">// that the server is working...</span>
      <span class="keyword">val</span> <a title="java.net.Socket" id="xsbt.boot.ServerLocator.isReachable.socket">socket</a> = <span title="(x$1: String, x$2: Int)java.net.Socket" class="keyword">new</span> java.net.<span title="java.net.Socket">Socket</span><span class="delimiter">(</span><a href="#xsbt.boot.ServerLocator.isReachable.uri" title="java.net.URI">uri</a>.<span title="()String">getHost</span>, <a href="#xsbt.boot.ServerLocator.isReachable.uri" title="java.net.URI">uri</a>.<span title="()Int">getPort</span><span class="delimiter">)</span>
      <span class="keyword">try</span> <a href="#xsbt.boot.ServerLocator.isReachable.socket" title="java.net.Socket">socket</a>.<span title="()Boolean">isConnected</span>
      <span class="keyword">finally</span> <a href="#xsbt.boot.ServerLocator.isReachable.socket" title="java.net.Socket">socket</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="java.io.IOException" id="xsbt.boot.ServerLocator.isReachable.e">e</a>: <span title="java.io.IOException">IOException</span> =&gt; <span title="Boolean(false)" class="keyword">false</span>
    <span class="delimiter">}</span>
<span class="delimiter">}</span>
<span class="comment">/** A helper class that dumps incoming values into a print stream. */</span>
<span title="AnyRef" class="keyword">class</span> <a title="class StreamDumper extends Thread" id="xsbt.boot;StreamDumper">StreamDumper</a><a href="#xsbt.boot;StreamDumper" title="xsbt.boot.StreamDumper" class="delimiter">(</a><a title="java.io.BufferedReader" id="xsbt.boot;StreamDumper.in">in</a>: java.io.<span title="java.io.BufferedReader">BufferedReader</span>, <a title="java.io.PrintStream" id="xsbt.boot;StreamDumper.out">out</a>: java.io.<span title="java.io.PrintStream">PrintStream</span><span class="delimiter">)</span> <span class="keyword">extends</span> <span title="Thread">Thread</span> <span class="delimiter">{</span>
  <span class="comment">// Don't block the application for this thread.</span>
  <a href="#xsbt.boot;StreamDumper" title="(x$1: Boolean)Unit">setDaemon</a><span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
  <span class="keyword">val</span> <a title="java.util.concurrent.atomic.AtomicLong" id="xsbt.boot;StreamDumper.endTime">endTime</a> = <span title="java.util.concurrent.atomic.AtomicLong" class="keyword">new</span> java.util.concurrent.atomic.<span title="java.util.concurrent.atomic.AtomicLong">AtomicLong</span><span class="delimiter">(</span>Long.<span title="Long(9223372036854775807L)">MaxValue</span><span class="delimiter">)</span>
  <span class="keyword">override</span> <span class="keyword">def</span> <a title="()Unit" id="xsbt.boot;StreamDumper.run">run</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="keyword">def</span> <a title="()Unit" id="xsbt.boot;StreamDumper.run.read">read</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#xsbt.boot;StreamDumper.endTime" title="=&gt; java.util.concurrent.atomic.AtomicLong">endTime</a>.<span title="()Long">get</span> <span title="(x: Long)Boolean">&gt;</span> <span title="System.type">System</span>.<span title="()Long">currentTimeMillis</span><span class="delimiter">)</span> <a href="#xsbt.boot;StreamDumper.in" title="java.io.BufferedReader">in</a>.<span title="()String">readLine</span> <span title="Unit" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Null(null)" class="keyword">null</span> =&gt; <span title="Unit" class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="String" id="xsbt.boot;StreamDumper.run.read.line">line</a> =&gt;
        <a href="#xsbt.boot;StreamDumper.out" title="java.io.PrintStream">out</a>.<span title="(x$1: String)Unit">println</span><span class="delimiter">(</span><a href="#xsbt.boot;StreamDumper.run.read.line" title="String">line</a><span class="delimiter">)</span>
        <a href="#xsbt.boot;StreamDumper.out" title="java.io.PrintStream">out</a>.<span title="()Unit">flush</span><span class="delimiter">(</span><span class="delimiter">)</span>
        <a href="#xsbt.boot;StreamDumper.run.read" title="()Unit">read</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <a href="#xsbt.boot;StreamDumper.run.read" title="()Unit">read</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#xsbt.boot;StreamDumper.out" title="java.io.PrintStream">out</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(waitForErrors: Boolean)Unit" id="xsbt.boot;StreamDumper.close">close</a><span class="delimiter">(</span><a title="Boolean" id="xsbt.boot;StreamDumper.close.waitForErrors">waitForErrors</a>: <span title="Boolean">Boolean</span><span class="delimiter">)</span>: <span title="Unit">Unit</span> = <span class="delimiter">{</span>
    <span class="comment">// closing &quot;in&quot; blocks forever on Windows, so don't do it;</span>
    <span class="comment">// just wait a couple seconds to read more stuff if there is</span>
    <span class="comment">// any stuff.</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><a href="#xsbt.boot;StreamDumper.close.waitForErrors" title="Boolean">waitForErrors</a><span class="delimiter">)</span> <span class="delimiter">{</span>
      <a href="#xsbt.boot;StreamDumper.endTime" title="=&gt; java.util.concurrent.atomic.AtomicLong">endTime</a>.<span title="(x$1: Long)Unit">set</span><span class="delimiter">(</span><span title="System.type">System</span>.<span title="()Long">currentTimeMillis</span> <span title="(x: Int)Long">+</span> <span title="Int(5000)" class="int">5000</span><span class="delimiter">)</span>
      <span class="comment">// at this point we'd rather the dumper thread run</span>
      <span class="comment">// before we check whether to sleep</span>
      <span title="Thread.type">Thread</span>.<span title="()Unit">`yield`</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="comment">// let ourselves read more (thread should exit on earlier of endTime or EOF)</span>
      <span title="Unit" class="keyword">while</span> <span class="delimiter">(</span><a href="#xsbt.boot;StreamDumper" title="()Boolean">isAlive</a><span class="delimiter">(</span><span class="delimiter">)</span> <span title="(x: Boolean)Boolean">&amp;&amp;</span> <span class="delimiter">(</span><a href="#xsbt.boot;StreamDumper.endTime" title="=&gt; java.util.concurrent.atomic.AtomicLong">endTime</a>.<span title="()Long">get</span> <span title="(x: Long)Boolean">&gt;</span> <span title="System.type">System</span>.<span title="()Long">currentTimeMillis</span><span class="delimiter">)</span><span class="delimiter">)</span>
        <span title="Thread.type">Thread</span>.<span title="(x$1: Long)Unit">sleep</span><a href="#xsbt.boot;StreamDumper.close.while$1" title="()Unit" class="delimiter">(</a><span title="Long(50L)" class="int">50</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <a href="#xsbt.boot;StreamDumper.endTime" title="=&gt; java.util.concurrent.atomic.AtomicLong">endTime</a>.<span title="(x$1: Long)Unit">set</span><span class="delimiter">(</span><span title="System.type">System</span>.<span title="()Long">currentTimeMillis</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>
<span class="delimiter">}</span>
<span class="keyword">object</span> <a title="xsbt.boot.ServerLauncher.type" id="xsbt.boot.ServerLauncher">ServerLauncher</a> <a href="#xsbt.boot.ServerLauncher" title="xsbt.boot.ServerLauncher.type" class="delimiter">{</a>
  <span class="keyword">import</span> <a href="#xsbt.boot.ServerApplication" title="xsbt.boot.ServerApplication.type">ServerApplication</a>.SERVER_SYNCH_TEXT
  <span class="keyword">def</span> <a title="(currentDirectory: java.io.File, config: xsbt.boot.LaunchConfiguration)java.net.URI" id="xsbt.boot.ServerLauncher.startServer">startServer</a><span class="delimiter">(</span><a title="java.io.File" id="xsbt.boot.ServerLauncher.startServer.currentDirectory">currentDirectory</a>: <span title="java.io.File">File</span>, <a title="xsbt.boot.LaunchConfiguration" id="xsbt.boot.ServerLauncher.startServer.config">config</a>: <a href="LaunchConfiguration.scala.html#xsbt.boot;LaunchConfiguration" title="xsbt.boot.LaunchConfiguration">LaunchConfiguration</a><span class="delimiter">)</span>: <span title="java.net.URI">URI</span> = <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="xsbt.boot.ServerConfiguration" id="xsbt.boot.ServerLauncher.startServer.serverConfig">serverConfig</a> = <a href="#xsbt.boot.ServerLauncher.startServer.config" title="xsbt.boot.LaunchConfiguration">config</a>.<a href="LaunchConfiguration.scala.html#xsbt.boot;LaunchConfiguration.serverConfig" title="=&gt; Option[xsbt.boot.ServerConfiguration]">serverConfig</a> <span title="xsbt.boot.ServerConfiguration" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> Some<span class="delimiter">(</span><a title="xsbt.boot.ServerConfiguration" id="xsbt.boot.ServerLauncher.startServer.serverConfig.c">c</a><span class="delimiter">)</span> =&gt; <a href="#xsbt.boot.ServerLauncher.startServer.serverConfig.c" title="xsbt.boot.ServerConfiguration">c</a>
      <span class="keyword">case</span> <span title="None.type">None</span>    =&gt; <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)RuntimeException" class="keyword">new</span> <span title="RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="String(&quot;Logic Failure:  Attempting to start a server that isn\'t configured to be a server.  Please report a bug.&quot;)" class="string">&quot;Logic Failure:  Attempting to start a server that isn't configured to be a server.  Please report a bug.&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">val</span> <a title="java.io.File" id="xsbt.boot.ServerLauncher.startServer.launchConfig">launchConfig</a> = java.io.<span title="java.io.File.type">File</span>.<span title="(x$1: String, x$2: String)java.io.File">createTempFile</span><span class="delimiter">(</span><span title="String(&quot;sbtlaunch&quot;)" class="string">&quot;sbtlaunch&quot;</span>, <span title="String(&quot;config&quot;)" class="string">&quot;config&quot;</span><span class="delimiter">)</span>
    <span title="Unit" class="keyword">if</span> <span class="delimiter">(</span><span title="System.type">System</span>.<span title="(x$1: String)String">getenv</span><span class="delimiter">(</span><span title="String(&quot;SBT_SERVER_SAVE_TEMPS&quot;)" class="string">&quot;SBT_SERVER_SAVE_TEMPS&quot;</span><span class="delimiter">)</span> <span title="(x$1: AnyRef)Boolean">eq</span> <span title="Null(null)" class="keyword">null</span><span class="delimiter">)</span>
      <a href="#xsbt.boot.ServerLauncher.startServer.launchConfig" title="java.io.File">launchConfig</a>.<span title="()Unit">deleteOnExit</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="LaunchConfiguration.scala.html#xsbt.boot.LaunchConfiguration" title="xsbt.boot.LaunchConfiguration.type">LaunchConfiguration</a>.<a href="LaunchConfiguration.scala.html#xsbt.boot.LaunchConfiguration.save" title="(config: xsbt.boot.LaunchConfiguration, f: java.io.File)Unit">save</a><span class="delimiter">(</span><a href="#xsbt.boot.ServerLauncher.startServer.config" title="xsbt.boot.LaunchConfiguration">config</a>, <a href="#xsbt.boot.ServerLauncher.startServer.launchConfig" title="java.io.File">launchConfig</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="List[String]" id="xsbt.boot.ServerLauncher.startServer.jvmArgs">jvmArgs</a>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <a href="#xsbt.boot.ServerLauncher.serverJvmArgs(e7f93a569a)" title="(currentDirectory: java.io.File, serverConfig: xsbt.boot.ServerConfiguration)List[String]">serverJvmArgs</a><span class="delimiter">(</span><a href="#xsbt.boot.ServerLauncher.startServer.currentDirectory" title="java.io.File">currentDirectory</a>, <a href="#xsbt.boot.ServerLauncher.startServer.serverConfig" title="xsbt.boot.ServerConfiguration">serverConfig</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="List[String]" id="xsbt.boot.ServerLauncher.startServer.cmd">cmd</a>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span> =
      <span class="delimiter">(</span><span title="String(&quot;java&quot;)" class="string">&quot;java&quot;</span> <a href="#xsbt.boot.ServerLauncher.startServer.cmd.x$1" title="(x: String)List[String]">::</a> <a href="#xsbt.boot.ServerLauncher.startServer.jvmArgs" title="List[String]">jvmArgs</a><span class="delimiter">)</span> <span title="(that: scala.collection.GenTraversableOnce[String])(implicit bf: scala.collection.generic.CanBuildFrom[List[String],String,List[String]])List[String]">++</span>
        <span class="delimiter">(</span><span title="String(&quot;-jar&quot;)" class="string">&quot;-jar&quot;</span> <a href="#xsbt.boot.ServerLauncher.startServer.cmd.x$4" title="(x: String)List[String]">::</a> <a href="#xsbt.boot.ServerLauncher.defaultLauncherLookup" title="=&gt; java.io.File">defaultLauncherLookup</a>.<span title="()String">getCanonicalPath</span> <a href="#xsbt.boot.ServerLauncher.startServer.cmd.x$3" title="(x: String)List[String]">::</a> <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;@load:&quot;)">@load:$</span><span class="delimiter">{</span><a href="#xsbt.boot.ServerLauncher.startServer.launchConfig" title="java.io.File">launchConfig</a>.<span title="()java.net.URI">toURI</span>.<span title="()java.net.URL">toURL</span>.<span title="()String">toString</span><span class="delimiter">}</span><span title="String(&quot;&quot;)" class="string">&quot;</span> <a href="#xsbt.boot.ServerLauncher.startServer.cmd.x$2" title="(x: String)List[String]">::</a> <span title="scala.collection.immutable.Nil.type">Nil</span><span class="delimiter">)</span>
    <a href="#xsbt.boot.ServerLauncher.launchProcessAndGetUri" title="(cmd: List[String], cwd: java.io.File)java.net.URI">launchProcessAndGetUri</a><span class="delimiter">(</span><a href="#xsbt.boot.ServerLauncher.startServer.cmd" title="List[String]">cmd</a>, <a href="#xsbt.boot.ServerLauncher.startServer.currentDirectory" title="java.io.File">currentDirectory</a><span class="delimiter">)</span>
  <span class="delimiter">}</span>

  <span class="comment">// Here we try to isolate all the stupidity of dealing with Java processes.</span>
  <span class="keyword">def</span> <a title="(cmd: List[String], cwd: java.io.File)java.net.URI" id="xsbt.boot.ServerLauncher.launchProcessAndGetUri">launchProcessAndGetUri</a><span class="delimiter">(</span><a title="List[String]" id="xsbt.boot.ServerLauncher.launchProcessAndGetUri.cmd">cmd</a>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span>, <a title="java.io.File" id="xsbt.boot.ServerLauncher.launchProcessAndGetUri.cwd">cwd</a>: <span title="java.io.File">File</span><span class="delimiter">)</span>: <span title="java.net.URI">URI</span> = <span class="delimiter">{</span>
    <span class="comment">// TODO - Handle windows path stupidity in arguments.</span>
    <span class="keyword">val</span> <a title="ProcessBuilder" id="xsbt.boot.ServerLauncher.launchProcessAndGetUri.pb">pb</a> = <span title="(x$1: &lt;repeated...&gt;[String])ProcessBuilder" class="keyword">new</span> java.lang.<span title="ProcessBuilder">ProcessBuilder</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <a href="#xsbt.boot.ServerLauncher.launchProcessAndGetUri.pb" title="ProcessBuilder">pb</a>.<span title="(x$1: &lt;repeated...&gt;[String])ProcessBuilder">command</span><span class="delimiter">(</span><a href="#xsbt.boot.ServerLauncher.launchProcessAndGetUri.cmd" title="List[String]">cmd</a>: _*<span class="delimiter">)</span>
    <a href="#xsbt.boot.ServerLauncher.launchProcessAndGetUri.pb" title="ProcessBuilder">pb</a>.<span title="(x$1: java.io.File)ProcessBuilder">directory</span><span class="delimiter">(</span><a href="#xsbt.boot.ServerLauncher.launchProcessAndGetUri.cwd" title="java.io.File">cwd</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Process" id="xsbt.boot.ServerLauncher.launchProcessAndGetUri.process">process</a> = <a href="#xsbt.boot.ServerLauncher.launchProcessAndGetUri.pb" title="ProcessBuilder">pb</a>.<span title="()Process">start</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="comment">// First we need to grab all the input streams, and close the ones we don't care about.</span>
    <a href="#xsbt.boot.ServerLauncher.launchProcessAndGetUri.process" title="Process">process</a>.<span title="()java.io.OutputStream">getOutputStream</span>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="java.io.InputStream" id="xsbt.boot.ServerLauncher.launchProcessAndGetUri.stderr">stderr</a> = <a href="#xsbt.boot.ServerLauncher.launchProcessAndGetUri.process" title="Process">process</a>.<span title="()java.io.InputStream">getErrorStream</span>
    <span class="keyword">val</span> <a title="java.io.InputStream" id="xsbt.boot.ServerLauncher.launchProcessAndGetUri.stdout">stdout</a> = <a href="#xsbt.boot.ServerLauncher.launchProcessAndGetUri.process" title="Process">process</a>.<span title="()java.io.InputStream">getInputStream</span>
    <span class="comment">// Now we start dumping out errors.</span>
    <span class="keyword">val</span> <a title="xsbt.boot.StreamDumper" id="xsbt.boot.ServerLauncher.launchProcessAndGetUri.errorDumper">errorDumper</a> = <span title="xsbt.boot.StreamDumper" class="keyword">new</span> <a href="#xsbt.boot;StreamDumper" title="xsbt.boot.StreamDumper">StreamDumper</a><span class="delimiter">(</span><span title="(x$1: java.io.Reader)java.io.BufferedReader" class="keyword">new</span> java.io.<span title="java.io.BufferedReader">BufferedReader</span><span class="delimiter">(</span><span title="java.io.InputStreamReader" class="keyword">new</span> java.io.<span title="java.io.InputStreamReader">InputStreamReader</span><span class="delimiter">(</span><a href="#xsbt.boot.ServerLauncher.launchProcessAndGetUri.stderr" title="java.io.InputStream">stderr</a><span class="delimiter">)</span><span class="delimiter">)</span>, <span title="System.type">System</span>.<span title="java.io.PrintStream">err</span><span class="delimiter">)</span>
    <a href="#xsbt.boot.ServerLauncher.launchProcessAndGetUri.errorDumper" title="xsbt.boot.StreamDumper">errorDumper</a>.<span title="()Unit">start</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="comment">// Now we look for the URI synch value, and then make sure we close the output files.</span>
    <span class="keyword">try</span> <a href="#xsbt.boot.ServerLauncher.readUntilSynch" title="(in: java.io.BufferedReader)Option[java.net.URI]">readUntilSynch</a><span class="delimiter">(</span><span title="(x$1: java.io.Reader)java.io.BufferedReader" class="keyword">new</span> java.io.<span title="java.io.BufferedReader">BufferedReader</span><span class="delimiter">(</span><span title="java.io.InputStreamReader" class="keyword">new</span> java.io.<span title="java.io.InputStreamReader">InputStreamReader</span><span class="delimiter">(</span><a href="#xsbt.boot.ServerLauncher.launchProcessAndGetUri.stdout" title="java.io.InputStream">stdout</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="java.net.URI" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> Some<span class="delimiter">(</span><a title="java.net.URI" id="xsbt.boot.ServerLauncher.launchProcessAndGetUri.uri">uri</a><span class="delimiter">)</span> =&gt; <a href="#xsbt.boot.ServerLauncher.launchProcessAndGetUri.uri" title="java.net.URI">uri</a>
      <span class="keyword">case</span> _ =&gt;
        <span class="comment">// attempt to get rid of the server (helps prevent hanging / stuck locks,</span>
        <span class="comment">// though this is not reliable)</span>
        <span class="keyword">try</span> <a href="#xsbt.boot.ServerLauncher.launchProcessAndGetUri.process" title="Process">process</a>.<span title="()Unit">destroy</span><span class="delimiter">(</span><span class="delimiter">)</span> <span class="keyword">catch</span> <span class="delimiter">{</span> <span class="keyword">case</span> <a title="Exception" id="xsbt.boot.ServerLauncher.launchProcessAndGetUri.e">e</a>: <span title="Exception">Exception</span> =&gt; <span class="delimiter">}</span>
        <span class="comment">// block a second to try to get stuff from stderr</span>
        <a href="#xsbt.boot.ServerLauncher.launchProcessAndGetUri.errorDumper" title="xsbt.boot.StreamDumper">errorDumper</a>.<a href="#xsbt.boot;StreamDumper.close" title="(waitForErrors: Boolean)Unit">close</a><span class="delimiter">(</span>waitForErrors = <span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>
        sys.<span title="(message: String)Nothing">error</span><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Failed to start server process in &quot;)">Failed to start server process in $</span><span class="delimiter">{</span><a href="#xsbt.boot.ServerLauncher.launchProcessAndGetUri.pb" title="ProcessBuilder">pb</a>.<span title="()java.io.File">directory</span><span class="delimiter">}</span><span title="String(&quot; command line &quot;)"> command line $</span><span class="delimiter">{</span><a href="#xsbt.boot.ServerLauncher.launchProcessAndGetUri.pb" title="ProcessBuilder">pb</a>.<span title="()java.util.List[String]">command</span><span class="delimiter">}</span><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
      <a href="#xsbt.boot.ServerLauncher.launchProcessAndGetUri.errorDumper" title="xsbt.boot.StreamDumper">errorDumper</a>.<a href="#xsbt.boot;StreamDumper.close" title="(waitForErrors: Boolean)Unit">close</a><span class="delimiter">(</span>waitForErrors = <span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span>
      <a href="#xsbt.boot.ServerLauncher.launchProcessAndGetUri.stdout" title="java.io.InputStream">stdout</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="comment">// Do not close stderr here because on Windows that will block,</span>
      <span class="comment">// and since the child process has no reason to exit, it may</span>
      <span class="comment">// block forever. errorDumper.close() instead owns the problem</span>
      <span class="comment">// of deciding what to do with stderr.</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">object</span> <a title="xsbt.boot.ServerLauncher.ServerUriLine.type" id="xsbt.boot.ServerLauncher.ServerUriLine">ServerUriLine</a> <a href="#xsbt.boot.ServerLauncher.ServerUriLine" title="xsbt.boot.ServerLauncher.ServerUriLine.type" class="delimiter">{</a>
    <span class="keyword">def</span> <a title="(in: String)Option[java.net.URI]" id="xsbt.boot.ServerLauncher.ServerUriLine.unapply">unapply</a><span class="delimiter">(</span><a title="String" id="xsbt.boot.ServerLauncher.ServerUriLine.unapply.in">in</a>: <span title="String">String</span><span class="delimiter">)</span>: <span title="Option[java.net.URI]">Option</span><span class="delimiter">[</span>URI<span class="delimiter">]</span> =
      <span title="Option[java.net.URI]" class="keyword">if</span> <span class="delimiter">(</span><a href="#xsbt.boot.ServerLauncher.ServerUriLine.unapply.in" title="String">in</a> <span title="(x$1: String)Boolean">startsWith</span> <a href="#xsbt.boot.ServerApplication.SERVER_SYNCH_TEXT" title="=&gt; String">SERVER_SYNCH_TEXT</a><span class="delimiter">)</span> <span class="delimiter">{</span>
        <span title="(x: java.net.URI)Some[java.net.URI]">Some</span><span class="delimiter">(</span><span title="java.net.URI" class="keyword">new</span> <span title="java.net.URI">URI</span><span class="delimiter">(</span><a href="#xsbt.boot.ServerLauncher.ServerUriLine.unapply.in" title="String">in</a>.<span title="(x$1: Int)String">substring</span><span class="delimiter">(</span><a href="#xsbt.boot.ServerApplication.SERVER_SYNCH_TEXT" title="implicit scala.Predef.augmentString : (x: String)scala.collection.immutable.StringOps">SERVER_SYNCH_TEXT</a>.<span title="=&gt; Int">size</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span> <span class="keyword">else</span> <span title="None.type">None</span>
  <span class="delimiter">}</span>
  <span class="comment">/** Reads an input steam until it hits the server synch text and server URI. */</span>
  <span class="keyword">def</span> <a title="(in: java.io.BufferedReader)Option[java.net.URI]" id="xsbt.boot.ServerLauncher.readUntilSynch">readUntilSynch</a><span class="delimiter">(</span><a title="java.io.BufferedReader" id="xsbt.boot.ServerLauncher.readUntilSynch.in">in</a>: java.io.<span title="java.io.BufferedReader">BufferedReader</span><span class="delimiter">)</span>: <span title="Option[java.net.URI]">Option</span><span class="delimiter">[</span>URI<span class="delimiter">]</span> = <span class="delimiter">{</span>
    @tailrec
    <span class="keyword">def</span> <a title="()Option[java.net.URI]" id="xsbt.boot.ServerLauncher.readUntilSynch.read">read</a><span class="delimiter">(</span><span class="delimiter">)</span>: <span title="Option[java.net.URI]">Option</span><span class="delimiter">[</span>URI<span class="delimiter">]</span> = <a href="#xsbt.boot.ServerLauncher.readUntilSynch.in" title="java.io.BufferedReader">in</a>.<span title="()String">readLine</span> <span title="Option[java.net.URI]" class="keyword">match</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <span title="Null(null)" class="keyword">null</span>               =&gt; <span title="None.type">None</span>
      <span class="keyword">case</span> <a href="#xsbt.boot.ServerLauncher.ServerUriLine.unapply" title="(in: String)Option[java.net.URI]">ServerUriLine</a><span class="delimiter">(</span><a title="java.net.URI" id="xsbt.boot.ServerLauncher.readUntilSynch.read.uri">uri</a><span class="delimiter">)</span> =&gt; <span title="(x: java.net.URI)Some[java.net.URI]">Some</span><span class="delimiter">(</span><a href="#xsbt.boot.ServerLauncher.readUntilSynch.read.uri" title="java.net.URI">uri</a><span class="delimiter">)</span>
      <span class="keyword">case</span> <a title="String" id="xsbt.boot.ServerLauncher.readUntilSynch.read.line">line</a>               =&gt; <a href="#xsbt.boot.ServerLauncher.readUntilSynch.read" title="()Option[java.net.URI]">read</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>
    <span class="keyword">try</span> <a href="#xsbt.boot.ServerLauncher.readUntilSynch.read" title="()Option[java.net.URI]">read</a><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">finally</span> <a href="#xsbt.boot.ServerLauncher.readUntilSynch.in" title="java.io.BufferedReader">in</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
  <span class="delimiter">}</span>
  <span class="comment">/** Reads all the lines in a file. If it doesn't exist, returns an empty list.  Forces UTF-8 strings. */</span>
  <span class="keyword">def</span> <a title="(f: java.io.File)List[String]" id="xsbt.boot.ServerLauncher.readLines">readLines</a><span class="delimiter">(</span><a title="java.io.File" id="xsbt.boot.ServerLauncher.readLines.f">f</a>: <span title="java.io.File">File</span><span class="delimiter">)</span>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span> =
    <span title="List[String]" class="keyword">if</span> <span class="delimiter">(</span><span title="=&gt; Boolean">!</span><a href="#xsbt.boot.ServerLauncher.readLines.f" title="java.io.File">f</a>.<span title="()Boolean">exists</span><span class="delimiter">)</span> <span title="scala.collection.immutable.Nil.type">Nil</span> <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="java.io.BufferedReader" id="xsbt.boot.ServerLauncher.readLines.reader">reader</a> = <span title="(x$1: java.io.Reader)java.io.BufferedReader" class="keyword">new</span> java.io.<span title="java.io.BufferedReader">BufferedReader</span><span class="delimiter">(</span><span title="(x$1: java.io.InputStream, x$2: String)java.io.InputStreamReader" class="keyword">new</span> java.io.<span title="java.io.InputStreamReader">InputStreamReader</span><span class="delimiter">(</span><span title="(x$1: java.io.File)java.io.FileInputStream" class="keyword">new</span> java.io.<span title="java.io.FileInputStream">FileInputStream</span><span class="delimiter">(</span><a href="#xsbt.boot.ServerLauncher.readLines.f" title="java.io.File">f</a><span class="delimiter">)</span>, <span title="String(&quot;UTF-8&quot;)" class="string">&quot;UTF-8&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
      @tailrec
      <span class="keyword">def</span> <a title="(current: List[String])List[String]" id="xsbt.boot.ServerLauncher.readLines.read">read</a><span class="delimiter">(</span><a title="List[String]" id="xsbt.boot.ServerLauncher.readLines.read.current">current</a>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span> =
        <a href="#xsbt.boot.ServerLauncher.readLines.reader" title="java.io.BufferedReader">reader</a>.<span title="()String">readLine</span> <span title="List[String]" class="keyword">match</span> <span class="delimiter">{</span>
          <span class="keyword">case</span> <span title="Null(null)" class="keyword">null</span> =&gt; <a href="#xsbt.boot.ServerLauncher.readLines.read.current" title="List[String]">current</a>.<span title="=&gt; List[String]">reverse</span>
          <span class="keyword">case</span> <a title="String" id="xsbt.boot.ServerLauncher.readLines.read.line">line</a> =&gt; <a href="#xsbt.boot.ServerLauncher.readLines.read" title="(current: List[String])List[String]">read</a><span class="delimiter">(</span><a href="#xsbt.boot.ServerLauncher.readLines.read.line" title="String">line</a> <a href="#xsbt.boot.ServerLauncher.readLines.read.x$5" title="(x: String)List[String]">::</a> <a href="#xsbt.boot.ServerLauncher.readLines.read.current" title="List[String]">current</a><span class="delimiter">)</span>
        <span class="delimiter">}</span>
      <span class="keyword">try</span> <a href="#xsbt.boot.ServerLauncher.readLines.read" title="(current: List[String])List[String]">read</a><span class="delimiter">(</span><span title="scala.collection.immutable.Nil.type">Nil</span><span class="delimiter">)</span>
      <span class="keyword">finally</span> <a href="#xsbt.boot.ServerLauncher.readLines.reader" title="java.io.BufferedReader">reader</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="delimiter">}</span>

  <span class="comment">// None = couldn't figure it out</span>
  <span class="keyword">def</span> <a title="(currentDirectory: java.io.File, version: Int)Option[Boolean]" id="xsbt.boot.ServerLauncher.javaIsAbove">javaIsAbove</a><span class="delimiter">(</span><a title="java.io.File" id="xsbt.boot.ServerLauncher.javaIsAbove.currentDirectory">currentDirectory</a>: <span title="java.io.File">File</span>, <a title="Int" id="xsbt.boot.ServerLauncher.javaIsAbove.version">version</a>: <span title="Int">Int</span><span class="delimiter">)</span>: <span title="Option[Boolean]">Option</span><span class="delimiter">[</span>Boolean<span class="delimiter">]</span> = <span class="keyword">try</span> <span class="delimiter">{</span>
    <span class="keyword">val</span> <a title="ProcessBuilder" id="xsbt.boot.ServerLauncher.javaIsAbove.pb">pb</a> = <span title="(x$1: &lt;repeated...&gt;[String])ProcessBuilder" class="keyword">new</span> java.lang.<span title="ProcessBuilder">ProcessBuilder</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="comment">// hopefully &quot;java -version&quot; is a lot faster than booting the full JVM.</span>
    <span class="comment">// not sure how else we can do this.</span>
    <a href="#xsbt.boot.ServerLauncher.javaIsAbove.pb" title="ProcessBuilder">pb</a>.<span title="(x$1: &lt;repeated...&gt;[String])ProcessBuilder">command</span><span class="delimiter">(</span><span title="String(&quot;java&quot;)" class="string">&quot;java&quot;</span>, <span title="String(&quot;-version&quot;)" class="string">&quot;-version&quot;</span><span class="delimiter">)</span>
    <a href="#xsbt.boot.ServerLauncher.javaIsAbove.pb" title="ProcessBuilder">pb</a>.<span title="(x$1: java.io.File)ProcessBuilder">directory</span><span class="delimiter">(</span><a href="#xsbt.boot.ServerLauncher.javaIsAbove.currentDirectory" title="java.io.File">currentDirectory</a><span class="delimiter">)</span>
    <span class="keyword">val</span> <a title="Process" id="xsbt.boot.ServerLauncher.javaIsAbove.process">process</a> = <a href="#xsbt.boot.ServerLauncher.javaIsAbove.pb" title="ProcessBuilder">pb</a>.<span title="()Process">start</span><span class="delimiter">(</span><span class="delimiter">)</span>
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <a href="#xsbt.boot.ServerLauncher.javaIsAbove.process" title="Process">process</a>.<span title="()java.io.OutputStream">getOutputStream</span>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <a href="#xsbt.boot.ServerLauncher.javaIsAbove.process" title="Process">process</a>.<span title="()java.io.InputStream">getInputStream</span>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="java.io.LineNumberReader" id="xsbt.boot.ServerLauncher.javaIsAbove.stderr">stderr</a> = <span title="java.io.LineNumberReader" class="keyword">new</span> java.io.<span title="java.io.LineNumberReader">LineNumberReader</span><span class="delimiter">(</span><span title="java.io.InputStreamReader" class="keyword">new</span> java.io.<span title="java.io.InputStreamReader">InputStreamReader</span><span class="delimiter">(</span><a href="#xsbt.boot.ServerLauncher.javaIsAbove.process" title="Process">process</a>.<span title="()java.io.InputStream">getErrorStream</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="comment">// Looking for the first line which is `java version &quot;1.7.0_60&quot;` or similar</span>
      <span class="keyword">val</span> <a title="Option[String]" id="xsbt.boot.ServerLauncher.javaIsAbove.lineOption">lineOption</a> = <span class="keyword">try</span> <span title="(x: String)Option[String]">Option</span><span class="delimiter">(</span><a href="#xsbt.boot.ServerLauncher.javaIsAbove.stderr" title="java.io.LineNumberReader">stderr</a>.<span title="()String">readLine</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="keyword">finally</span> <a href="#xsbt.boot.ServerLauncher.javaIsAbove.stderr" title="java.io.LineNumberReader">stderr</a>.<span title="()Unit">close</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">val</span> <a title="java.util.regex.Pattern" id="xsbt.boot.ServerLauncher.javaIsAbove.pattern">pattern</a> = java.util.regex.<span title="java.util.regex.Pattern.type">Pattern</span>.<span title="(x$1: String)java.util.regex.Pattern">compile</span><span class="delimiter">(</span><span title="String(&quot;java version \&quot;[0-9]+\\.([0-9]+)\\..*\&quot;.*&quot;)" class="string">&quot;&quot;&quot;java version &quot;[0-9]+\.([0-9]+)\..*&quot;.*&quot;&quot;&quot;</span><span class="delimiter">)</span>
      <a href="#xsbt.boot.ServerLauncher.javaIsAbove.lineOption" title="Option[String]">lineOption</a> <span title="(f: String =&gt; Option[Boolean])Option[Boolean]">flatMap</span> <span class="delimiter">{</span> <a title="String" id="xsbt.boot.ServerLauncher.javaIsAbove.$anonfun.line">line</a> =&gt;
        <span class="keyword">val</span> <a title="java.util.regex.Matcher" id="xsbt.boot.ServerLauncher.javaIsAbove.$anonfun.matcher">matcher</a> = <a href="#xsbt.boot.ServerLauncher.javaIsAbove.pattern" title="java.util.regex.Pattern">pattern</a>.<span title="(x$1: CharSequence)java.util.regex.Matcher">matcher</span><span class="delimiter">(</span><a href="#xsbt.boot.ServerLauncher.javaIsAbove.$anonfun.line" title="String">line</a><span class="delimiter">)</span>
        <span title="Option[Boolean]" class="keyword">if</span> <span class="delimiter">(</span><a href="#xsbt.boot.ServerLauncher.javaIsAbove.$anonfun.matcher" title="java.util.regex.Matcher">matcher</a>.<span title="()Boolean">matches</span><span class="delimiter">(</span><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">{</span>
          <span class="keyword">try</span> <span title="(x: Boolean)Some[Boolean]">Some</span><span class="delimiter">(</span><span title="Integer.type">Integer</span>.<span title="(x$1: String)Int">parseInt</span><span class="delimiter">(</span><a href="#xsbt.boot.ServerLauncher.javaIsAbove.$anonfun.matcher" title="java.util.regex.Matcher">matcher</a>.<span title="(x$1: Int)String">group</span><span class="delimiter">(</span><span title="Int(1)" class="int">1</span><span class="delimiter">)</span><span class="delimiter">)</span> <span title="(x: Int)Boolean">&gt;</span> <a href="#xsbt.boot.ServerLauncher.javaIsAbove.version" title="Int">version</a><span class="delimiter">)</span> <span class="keyword">catch</span> <span class="delimiter">{</span> <span class="keyword">case</span> <a href="#xsbt.boot.ServerLauncher.javaIsAbove.$anonfun.<unapply-selector>" title="(t: Throwable)Option[Throwable]">NonFatal</a><span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt; <span title="None.type">None</span> <span class="delimiter">}</span>
        <span class="delimiter">}</span> <span class="keyword">else</span> <span class="delimiter">{</span>
          <span title="System.type">System</span>.<span title="java.io.PrintStream">err</span>.<span title="(x$1: String)Unit">println</span><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Failed to parse version from \'java -version\' output \'&quot;)">Failed to parse version from 'java -version' output '$</span><a href="#xsbt.boot.ServerLauncher.javaIsAbove.$anonfun.line" title="String">line</a><span title="String(&quot;\'&quot;)" class="string">'&quot;</span><span class="delimiter">)</span>
          <span title="None.type">None</span>
        <span class="delimiter">}</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span> <span class="keyword">finally</span> <span class="delimiter">{</span>
      <a href="#xsbt.boot.ServerLauncher.javaIsAbove.process" title="Process">process</a>.<span title="()Unit">destroy</span><span class="delimiter">(</span><span class="delimiter">)</span>
      <span class="keyword">try</span> <span class="delimiter">{</span> <a href="#xsbt.boot.ServerLauncher.javaIsAbove.process" title="Process">process</a>.<span title="()Int">waitFor</span><span title="Unit" class="delimiter">(</span><span class="delimiter">)</span> <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span> <span class="keyword">case</span> <a href="#xsbt.boot.ServerLauncher.javaIsAbove.<unapply-selector>" title="(t: Throwable)Option[Throwable]">NonFatal</a><span class="delimiter">(</span>_<span class="delimiter">)</span> =&gt; <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
    <span class="keyword">case</span> <a title="java.io.IOException" id="xsbt.boot.ServerLauncher.javaIsAbove.e">e</a>: <span title="java.io.IOException">IOException</span> =&gt;
      <span class="comment">// both process.start and reading the output streams can throw IOException.</span>
      <span class="comment">// all OS exceptions from process.start are supposed to be IOException.</span>
      <span title="System.type">System</span>.<span title="java.io.PrintStream">err</span>.<span title="(x$1: String)Unit">println</span><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;Failed to run \'java -version\': &quot;)">Failed to run 'java -version': $</span><span class="delimiter">{</span><a href="#xsbt.boot.ServerLauncher.javaIsAbove.e" title="java.io.IOException">e</a>.<span title="()Class[_]">getClass</span>.<span title="()String">getName</span><span class="delimiter">}</span><span title="String(&quot;: &quot;)">: $</span><span class="delimiter">{</span><a href="#xsbt.boot.ServerLauncher.javaIsAbove.e" title="java.io.IOException">e</a>.<span title="()String">getMessage</span><span class="delimiter">}</span><span title="String(&quot;&quot;)" class="string">&quot;</span><span class="delimiter">)</span>
      <span title="None.type">None</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="(currentDirectory: java.io.File, serverConfig: xsbt.boot.ServerConfiguration)List[String]" id="xsbt.boot.ServerLauncher.serverJvmArgs(e7f93a569a)">serverJvmArgs</a><span class="delimiter">(</span><a title="java.io.File" id="xsbt.boot.ServerLauncher.serverJvmArgs(e7f93a569a).currentDirectory">currentDirectory</a>: <span title="java.io.File">File</span>, <a title="xsbt.boot.ServerConfiguration" id="xsbt.boot.ServerLauncher.serverJvmArgs(e7f93a569a).serverConfig">serverConfig</a>: <a href="LaunchConfiguration.scala.html#xsbt.boot;ServerConfiguration" title="xsbt.boot.ServerConfiguration">ServerConfiguration</a><span class="delimiter">)</span>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span> =
    <a href="#xsbt.boot.ServerLauncher.serverJvmArgs(55e17e89f0)" title="(currentDirectory: java.io.File, baseArgs: List[String])List[String]">serverJvmArgs</a><span class="delimiter">(</span><a href="#xsbt.boot.ServerLauncher.serverJvmArgs(e7f93a569a).currentDirectory" title="java.io.File">currentDirectory</a>, <a href="#xsbt.boot.ServerLauncher.serverJvmArgs(e7f93a569a).serverConfig" title="xsbt.boot.ServerConfiguration">serverConfig</a>.<a href="LaunchConfiguration.scala.html#xsbt.boot;ServerConfiguration.jvmArgs" title="=&gt; Option[java.io.File]">jvmArgs</a> <span title="(f: java.io.File =&gt; List[String])Option[List[String]]">map</span> <a href="#xsbt.boot.ServerLauncher.readLines" title="(f: java.io.File)List[String]">readLines</a> <span title="(default: =&gt; List[String])List[String]">getOrElse</span> <span title="scala.collection.immutable.Nil.type">Nil</span><span class="delimiter">)</span>

  <span class="keyword">final</span> <span class="keyword">val</span> <a title="List[String]" id="xsbt.boot.ServerLauncher.memOptPrefixes">memOptPrefixes</a> = <span title="(xs: String*)List[String]">List</span><span class="delimiter">(</span><span title="String(&quot;-Xmx&quot;)" class="string">&quot;-Xmx&quot;</span>, <span title="String(&quot;-Xms&quot;)" class="string">&quot;-Xms&quot;</span>, <span title="String(&quot;-XX:MaxPermSize&quot;)" class="string">&quot;-XX:MaxPermSize&quot;</span>, <span title="String(&quot;-XX:PermSize&quot;)" class="string">&quot;-XX:PermSize&quot;</span>, <span title="String(&quot;-XX:ReservedCodeCacheSize&quot;)" class="string">&quot;-XX:ReservedCodeCacheSize&quot;</span>, <span title="String(&quot;-XX:MaxMetaspaceSize&quot;)" class="string">&quot;-XX:MaxMetaspaceSize&quot;</span>, <span title="String(&quot;-XX:MetaspaceSize&quot;)" class="string">&quot;-XX:MetaspaceSize&quot;</span><span class="delimiter">)</span>

  <span class="keyword">final</span> <span class="keyword">val</span> <a title="Int(256)" id="xsbt.boot.ServerLauncher.defaultMinHeapM">defaultMinHeapM</a> = <span title="Int(256)" class="int">256</span>
  <span class="keyword">final</span> <span class="keyword">val</span> <a title="Int(1024)" id="xsbt.boot.ServerLauncher.defaultMaxHeapM">defaultMaxHeapM</a> = defaultMinHeapM <span title="Int(1024)">*</span> <span class="int">4</span>
  <span class="keyword">final</span> <span class="keyword">val</span> <a title="Int(64)" id="xsbt.boot.ServerLauncher.defaultMinPermM">defaultMinPermM</a> = <span title="Int(64)" class="int">64</span>
  <span class="keyword">final</span> <span class="keyword">val</span> <a title="Int(256)" id="xsbt.boot.ServerLauncher.defaultMaxPermM">defaultMaxPermM</a> = defaultMinPermM <span title="Int(256)">*</span> <span class="int">4</span>

  <span class="comment">// this is separate just for the test suite</span>
  <span class="keyword">def</span> <a title="(currentDirectory: java.io.File, baseArgs: List[String])List[String]" id="xsbt.boot.ServerLauncher.serverJvmArgs(55e17e89f0)">serverJvmArgs</a><span class="delimiter">(</span><a title="java.io.File" id="xsbt.boot.ServerLauncher.serverJvmArgs(55e17e89f0).currentDirectory">currentDirectory</a>: <span title="java.io.File">File</span>, <a title="List[String]" id="xsbt.boot.ServerLauncher.serverJvmArgs(55e17e89f0).baseArgs">baseArgs</a>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span><span class="delimiter">)</span>: <span title="List[String]">List</span><span class="delimiter">[</span>String<span class="delimiter">]</span> = <span class="delimiter">{</span>
    <span class="comment">// ignore blank lines</span>
    <span class="keyword">val</span> <a title="List[String]" id="xsbt.boot.ServerLauncher.serverJvmArgs(55e17e89f0).trimmed">trimmed</a> = <a href="#xsbt.boot.ServerLauncher.serverJvmArgs(55e17e89f0).baseArgs" title="List[String]">baseArgs</a>.<span title="(f: String =&gt; String)(implicit bf: scala.collection.generic.CanBuildFrom[List[String],String,List[String]])List[String]">map</span><span title="scala.collection.generic.CanBuildFrom[scala.collection.immutable.List.Coll,String,List[String]]" class="delimiter">(</span><a href="#xsbt.boot.ServerLauncher.serverJvmArgs(55e17e89f0).trimmed.$anonfun.x$6" title="String">_</a>.<span title="()String">trim</span><span class="delimiter">)</span>.<span title="(p: String =&gt; Boolean)List[String]">filterNot</span><span class="delimiter">(</span><a href="#xsbt.boot.ServerLauncher.serverJvmArgs(55e17e89f0).trimmed.$anonfun.x$7" title="String">_</a>.<span title="()Boolean">isEmpty</span><span class="delimiter">)</span>
    <span class="comment">// If the user config has provided ANY memory options we bail out and do NOT add</span>
    <span class="comment">// any defaults. This means people can always fix our mistakes, and it avoids</span>
    <span class="comment">// issues where the JVM refuses to start because of (for example) min size greater</span>
    <span class="comment">// than max size. We don't want to deal with coordinating our changes with the</span>
    <span class="comment">// user configuration.</span>
    <span class="keyword">def</span> <a title="(s: String)Boolean" id="xsbt.boot.ServerLauncher.serverJvmArgs(55e17e89f0).isMemoryOption">isMemoryOption</a><span class="delimiter">(</span><a title="String" id="xsbt.boot.ServerLauncher.serverJvmArgs(55e17e89f0).isMemoryOption.s">s</a>: <span title="String">String</span><span class="delimiter">)</span> = <a href="#xsbt.boot.ServerLauncher.memOptPrefixes" title="=&gt; List[String]">memOptPrefixes</a>.<span title="(p: String =&gt; Boolean)Boolean">exists</span><span class="delimiter">(</span><a href="#xsbt.boot.ServerLauncher.serverJvmArgs(55e17e89f0).isMemoryOption.s" title="String">s</a>.<span title="(x$1: String)Boolean">startsWith</span><span class="delimiter">(</span><a href="#xsbt.boot.ServerLauncher.serverJvmArgs(55e17e89f0).isMemoryOption.$anonfun.x$8" title="String">_</a><span class="delimiter">)</span><span class="delimiter">)</span>
    <span title="List[String]" class="keyword">if</span> <span class="delimiter">(</span><a href="#xsbt.boot.ServerLauncher.serverJvmArgs(55e17e89f0).trimmed" title="List[String]">trimmed</a>.<span title="(p: String =&gt; Boolean)Boolean">exists</span><span class="delimiter">(</span><a href="#xsbt.boot.ServerLauncher.serverJvmArgs(55e17e89f0).isMemoryOption" title="(s: String)Boolean">isMemoryOption</a><span class="delimiter">(</span><a href="#xsbt.boot.ServerLauncher.serverJvmArgs(55e17e89f0).$anonfun.x$9" title="String">_</a><span class="delimiter">)</span><span class="delimiter">)</span><span class="delimiter">)</span>
      <a href="#xsbt.boot.ServerLauncher.serverJvmArgs(55e17e89f0).trimmed" title="List[String]">trimmed</a>
    <span class="keyword">else</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="List[String]" id="xsbt.boot.ServerLauncher.serverJvmArgs(55e17e89f0).permOptions">permOptions</a> = <a href="#xsbt.boot.ServerLauncher.javaIsAbove" title="(currentDirectory: java.io.File, version: Int)Option[Boolean]">javaIsAbove</a><span class="delimiter">(</span><a href="#xsbt.boot.ServerLauncher.serverJvmArgs(55e17e89f0).currentDirectory" title="java.io.File">currentDirectory</a>, <span title="Int(7)" class="int">7</span><span class="delimiter">)</span> <span title="List[String]" class="keyword">match</span> <span class="delimiter">{</span>
        <span class="keyword">case</span> Some<span class="delimiter">(</span><span title="Boolean(true)" class="keyword">true</span><span class="delimiter">)</span>  =&gt; <span title="(xs: String*)List[String]">List</span><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;-XX:MetaspaceSize=&quot;)">-XX:MetaspaceSize=$</span><span class="delimiter">{</span><span title="Int(64)">defaultMinPermM</span><span class="delimiter">}</span><span title="String(&quot;m&quot;)" class="string">m&quot;</span>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;-XX:MaxMetaspaceSize=&quot;)">-XX:MaxMetaspaceSize=$</span><span class="delimiter">{</span><span title="Int(256)">defaultMaxPermM</span><span class="delimiter">}</span><span title="String(&quot;m&quot;)" class="string">m&quot;</span><span class="delimiter">)</span>
        <span class="keyword">case</span> Some<span class="delimiter">(</span><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span> =&gt; <span title="(xs: String*)List[String]">List</span><span class="delimiter">(</span><span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;-XX:PermSize=&quot;)">-XX:PermSize=$</span><span class="delimiter">{</span><span title="Int(64)">defaultMinPermM</span><span class="delimiter">}</span><span title="String(&quot;m&quot;)" class="string">m&quot;</span>, <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;-XX:MaxPermSize=&quot;)">-XX:MaxPermSize=$</span><span class="delimiter">{</span><span title="Int(256)">defaultMaxPermM</span><span class="delimiter">}</span><span title="String(&quot;m&quot;)" class="string">m&quot;</span><span class="delimiter">)</span>
        <span class="keyword">case</span> <span title="None.type">None</span>        =&gt; <span title="scala.collection.immutable.Nil.type">Nil</span> <span class="comment">// don't know what we're doing, so don't set options</span>
      <span class="delimiter">}</span>
      <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;-Xms&quot;)">-Xms$</span><span class="delimiter">{</span><span title="Int(256)">defaultMinHeapM</span><span class="delimiter">}</span><span title="String(&quot;m&quot;)" class="string">m&quot;</span> <a href="#xsbt.boot.ServerLauncher.serverJvmArgs(55e17e89f0).x$11" title="(x: String)List[String]">::</a> <span title="(args: Any*)String">s</span>&quot;<span title="String(&quot;-Xmx&quot;)">-Xmx$</span><span class="delimiter">{</span><span title="Int(1024)">defaultMaxHeapM</span><span class="delimiter">}</span><span title="String(&quot;m&quot;)" class="string">m&quot;</span> <a href="#xsbt.boot.ServerLauncher.serverJvmArgs(55e17e89f0).x$10" title="(x: String)List[String]">::</a> <span class="delimiter">(</span><a href="#xsbt.boot.ServerLauncher.serverJvmArgs(55e17e89f0).permOptions" title="List[String]">permOptions</a> <span title="(that: scala.collection.GenTraversableOnce[String])(implicit bf: scala.collection.generic.CanBuildFrom[List[String],String,List[String]])List[String]">++</span> <a href="#xsbt.boot.ServerLauncher.serverJvmArgs(55e17e89f0).trimmed" title="List[String]">trimmed</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
  <span class="delimiter">}</span>

  <span class="keyword">def</span> <a title="=&gt; java.io.File" id="xsbt.boot.ServerLauncher.defaultLauncherLookup">defaultLauncherLookup</a>: <span title="java.io.File">File</span> =
    <span class="keyword">try</span> <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="Class[xsbt.boot.AppConfiguration]" id="xsbt.boot.ServerLauncher.defaultLauncherLookup.classInLauncher">classInLauncher</a> = classOf<span title="Class[xsbt.boot.AppConfiguration](classOf[xsbt.boot.AppConfiguration])" class="delimiter">[</span>AppConfiguration<span class="delimiter">]</span>
      <span class="keyword">val</span> <a title="Option[java.io.File]" id="xsbt.boot.ServerLauncher.defaultLauncherLookup.fileOpt">fileOpt</a> = <span class="keyword">for</span> <span class="delimiter">{</span>
        <a title="java.security.ProtectionDomain" id="xsbt.boot.ServerLauncher.defaultLauncherLookup.fileOpt.$anonfun.domain">domain</a> &lt;- <span title="(x: java.security.ProtectionDomain)Option[java.security.ProtectionDomain]">Option</span><span title="(f: java.security.ProtectionDomain =&gt; Option[java.io.File])Option[java.io.File]" class="delimiter">(</span><a href="#xsbt.boot.ServerLauncher.defaultLauncherLookup.classInLauncher" title="Class[xsbt.boot.AppConfiguration]">classInLauncher</a>.<span title="()java.security.ProtectionDomain">getProtectionDomain</span><span class="delimiter">)</span>
        <a title="java.security.CodeSource" id="xsbt.boot.ServerLauncher.defaultLauncherLookup.fileOpt.$anonfun.$anonfun.source">source</a> &lt;- <span title="(x: java.security.CodeSource)Option[java.security.CodeSource]">Option</span><span title="(f: java.security.CodeSource =&gt; (java.security.CodeSource, java.net.URL))Option[(java.security.CodeSource, java.net.URL)]" class="delimiter">(</span><a href="#xsbt.boot.ServerLauncher.defaultLauncherLookup.fileOpt.$anonfun.domain" title="java.security.ProtectionDomain">domain</a>.<span title="()java.security.CodeSource">getCodeSource</span><span class="delimiter">)</span>
        <a title="java.net.URL" id="xsbt.boot.ServerLauncher.defaultLauncherLookup.fileOpt.$anonfun.$anonfun.location">location</a> = <a href="#xsbt.boot.ServerLauncher.defaultLauncherLookup.fileOpt.$anonfun.$anonfun.source" title="java.security.CodeSource">source</a>.<span title="()java.net.URL">getLocation</span>
      <span class="delimiter">}</span> <span class="keyword">yield</span> <a href="Pre.scala.html#xsbt.boot.Pre.toFile" title="(url: java.net.URL)java.io.File">toFile</a><span class="delimiter">(</span><a href="#xsbt.boot.ServerLauncher.defaultLauncherLookup.fileOpt.$anonfun.$anonfun.location" title="java.net.URL">location</a><span class="delimiter">)</span>
      <a href="#xsbt.boot.ServerLauncher.defaultLauncherLookup.fileOpt" title="Option[java.io.File]">fileOpt</a>.<span title="(default: =&gt; java.io.File)java.io.File">getOrElse</span><span class="delimiter">(</span><span title="Nothing" class="keyword">throw</span> <span title="(x$1: String)RuntimeException" class="keyword">new</span> <span title="RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="String(&quot;Could not inspect protection domain or code source&quot;)" class="string">&quot;Could not inspect protection domain or code source&quot;</span><span class="delimiter">)</span><span class="delimiter">)</span>
    <span class="delimiter">}</span> <span class="keyword">catch</span> <span class="delimiter">{</span>
      <span class="keyword">case</span> <a title="Throwable" id="xsbt.boot.ServerLauncher.defaultLauncherLookup.e">e</a>: <span title="Throwable">Throwable</span> =&gt; <span title="Nothing" class="keyword">throw</span> <span title="(x$1: String, x$2: Throwable)RuntimeException" class="keyword">new</span> <span title="RuntimeException">RuntimeException</span><span class="delimiter">(</span><span title="String(&quot;Unable to find sbt-launch.jar.&quot;)" class="string">&quot;Unable to find sbt-launch.jar.&quot;</span>, <a href="#xsbt.boot.ServerLauncher.defaultLauncherLookup.e" title="Throwable">e</a><span class="delimiter">)</span>
    <span class="delimiter">}</span>
<span class="delimiter">}</span>

        </pre>
    </body>
</html>
