<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>sbt/SeparatedCache.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2009 Mark Harrah
 */</span>
<span class="keyword">package</span> sbt

<span class="keyword">import</span> <a href="Types.scala.html#sbt.Types" title="sbt.Types.type">Types</a>.:+:
<span class="keyword">import</span> sbinary.<span class="delimiter">{</span> DefaultProtocol, Format, Input, Output =&gt; Out <span class="delimiter">}</span>
<span class="keyword">import</span> <span title="sbinary.DefaultProtocol.type">DefaultProtocol</span>.ByteFormat
<span class="keyword">import</span> java.io.<span class="delimiter">{</span> File, InputStream, OutputStream <span class="delimiter">}</span>

<span class="keyword">trait</span> <a title="trait InputCache[I] extends AnyRef" id="sbt;InputCache">InputCache</a><span class="delimiter">[</span><a title="" id="sbt;InputCache;I">I</a><span class="delimiter">]</span> <span class="delimiter">{</span>
  <span class="keyword">type</span> <a title="" id="sbt;InputCache;Internal">Internal</a>
  <span class="keyword">def</span> <a title="(i: I)InputCache.this.Internal" id="sbt;InputCache.convert">convert</a><span class="delimiter">(</span><a title="I" id="sbt;InputCache.convert.i">i</a>: <a href="#sbt;InputCache;I" title="I">I</a><span class="delimiter">)</span>: <a href="#sbt;InputCache;Internal" title="InputCache.this.Internal">Internal</a>
  <span class="keyword">def</span> <a title="(from: sbinary.Input)InputCache.this.Internal" id="sbt;InputCache.read">read</a><span class="delimiter">(</span><a title="sbinary.Input" id="sbt;InputCache.read.from">from</a>: <span title="sbinary.Input">Input</span><span class="delimiter">)</span>: <a href="#sbt;InputCache;Internal" title="InputCache.this.Internal">Internal</a>
  <span class="keyword">def</span> <a title="(to: sbinary.Output, j: InputCache.this.Internal)Unit" id="sbt;InputCache.write">write</a><span class="delimiter">(</span><a title="sbinary.Output" id="sbt;InputCache.write.to">to</a>: <span title="sbinary.Output">Out</span>, <a title="InputCache.this.Internal" id="sbt;InputCache.write.j">j</a>: <a href="#sbt;InputCache;Internal" title="InputCache.this.Internal">Internal</a><span class="delimiter">)</span>: <span title="Unit">Unit</span>
  <span class="keyword">def</span> <a title="=&gt; Equiv[InputCache.this.Internal]" id="sbt;InputCache.equiv">equiv</a>: <span title="Equiv[InputCache.this.Internal]">Equiv</span><span class="delimiter">[</span>Internal<span class="delimiter">]</span>
<span class="delimiter">}</span>
<span title="AnyRef" class="keyword">object</span> <a title="sbt.InputCache.type" id="sbt.InputCache">InputCache</a> <a href="#sbt.InputCache" title="sbt.InputCache.type" class="delimiter">{</a>
  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="[I](implicit fmt: sbinary.Format[I], implicit eqv: Equiv[I])sbt.InputCache[I]" id="sbt.InputCache.basicInputCache">basicInputCache</a><span class="delimiter">[</span><a title="" id="sbt.InputCache.basicInputCache;I">I</a><span class="delimiter">]</span><span class="delimiter">(</span><span class="keyword">implicit</span> <a title="sbinary.Format[I]" id="sbt.InputCache.basicInputCache.fmt">fmt</a>: <span title="sbinary.Format[I]">Format</span><span class="delimiter">[</span>I<span class="delimiter">]</span>, <a title="Equiv[I]" id="sbt.InputCache.basicInputCache.eqv">eqv</a>: <span title="Equiv[I]">Equiv</span><span class="delimiter">[</span>I<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#sbt;InputCache" title="sbt.InputCache[I]">InputCache</a><span class="delimiter">[</span>I<span class="delimiter">]</span> =
    <a href="#sbt.InputCache.basicInputCache;$anon" title="sbt.InputCache[I]" class="keyword">new</a> <a title="anonymous class $anon extends AnyRef with sbt.InputCache[I]" id="sbt.InputCache.basicInputCache;$anon">InputCache</a><span class="delimiter">[</span>I<span class="delimiter">]</span> <span class="delimiter">{</span>
      <span class="keyword">type</span> <a title="I" id="sbt.InputCache.basicInputCache;$anon;Internal">Internal</a> = <a href="#sbt.InputCache.basicInputCache;I" title="I">I</a>
      <span class="keyword">def</span> <a title="(i: I)I" id="sbt.InputCache.basicInputCache;$anon.convert">convert</a><span class="delimiter">(</span><a title="I" id="sbt.InputCache.basicInputCache;$anon.convert.i">i</a>: <a href="#sbt.InputCache.basicInputCache;I" title="I">I</a><span class="delimiter">)</span> = <a href="#sbt.InputCache.basicInputCache;$anon.convert.i" title="I">i</a>
      <span class="keyword">def</span> <a title="(from: sbinary.Input)I" id="sbt.InputCache.basicInputCache;$anon.read">read</a><span class="delimiter">(</span><a title="sbinary.Input" id="sbt.InputCache.basicInputCache;$anon.read.from">from</a>: <span title="sbinary.Input">Input</span><span class="delimiter">)</span>: <a href="#sbt.InputCache.basicInputCache;I" title="I">I</a> = <a href="#sbt.InputCache.basicInputCache.fmt" title="sbinary.Format[I]">fmt</a>.<span title="(in: sbinary.Input)I">reads</span><span class="delimiter">(</span><a href="#sbt.InputCache.basicInputCache;$anon.read.from" title="sbinary.Input">from</a><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="(to: sbinary.Output, i: I)Unit" id="sbt.InputCache.basicInputCache;$anon.write">write</a><span class="delimiter">(</span><a title="sbinary.Output" id="sbt.InputCache.basicInputCache;$anon.write.to">to</a>: <span title="sbinary.Output">Out</span>, <a title="I" id="sbt.InputCache.basicInputCache;$anon.write.i">i</a>: <a href="#sbt.InputCache.basicInputCache;I" title="I">I</a><span class="delimiter">)</span> = <a href="#sbt.InputCache.basicInputCache.fmt" title="sbinary.Format[I]">fmt</a>.<span title="(out: sbinary.Output, value: I)Unit">writes</span><span class="delimiter">(</span><a href="#sbt.InputCache.basicInputCache;$anon.write.to" title="sbinary.Output">to</a>, <a href="#sbt.InputCache.basicInputCache;$anon.write.i" title="I">i</a><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="=&gt; Equiv[I]" id="sbt.InputCache.basicInputCache;$anon.equiv">equiv</a> = <a href="#sbt.InputCache.basicInputCache.eqv" title="Equiv[I]">eqv</a>
    <span class="delimiter">}</span>
  <span class="keyword">def</span> <a title="[I](mkIn: =&gt; sbt.InputCache[I])sbt.InputCache[I]" id="sbt.InputCache.lzy">lzy</a><span class="delimiter">[</span><a title="" id="sbt.InputCache.lzy;I">I</a><span class="delimiter">]</span><span class="delimiter">(</span><a title="=&gt; sbt.InputCache[I]" id="sbt.InputCache.lzy.mkIn">mkIn</a>: =&gt; InputCache<span class="delimiter">[</span>I<span class="delimiter">]</span><span class="delimiter">)</span>: <a href="#sbt;InputCache" title="sbt.InputCache[I]">InputCache</a><span class="delimiter">[</span>I<span class="delimiter">]</span> =
    <a href="#sbt.InputCache.lzy;$anon" title="sbt.InputCache[I]{}" class="keyword">new</a> <a title="anonymous class $anon extends AnyRef with sbt.InputCache[I]" id="sbt.InputCache.lzy;$anon">InputCache</a><span class="delimiter">[</span>I<span class="delimiter">]</span> <span class="delimiter">{</span>
      <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="sbt.InputCache[I]" id="sbt.InputCache.lzy;$anon.ic">ic</a> = <a href="#sbt.InputCache.lzy.mkIn" title="=&gt; sbt.InputCache[I]">mkIn</a>
      <span class="keyword">type</span> <a title="this.ic.Internal" id="sbt.InputCache.lzy;$anon;Internal">Internal</a> = ic.<a href="#sbt;InputCache;Internal" title="this.ic.Internal">Internal</a>
      <span class="keyword">def</span> <a title="(i: I)this.ic.Internal" id="sbt.InputCache.lzy;$anon.convert">convert</a><span class="delimiter">(</span><a title="I" id="sbt.InputCache.lzy;$anon.convert.i">i</a>: <a href="#sbt.InputCache.lzy;I" title="I">I</a><span class="delimiter">)</span> = <a href="#sbt.InputCache.lzy;$anon.ic" title="=&gt; sbt.InputCache[I]">ic</a> <a href="#sbt;InputCache.convert" title="(i: I)this.ic.Internal">convert</a> <a href="#sbt.InputCache.lzy;$anon.convert.i" title="I">i</a>
      <span class="keyword">def</span> <a title="(from: sbinary.Input)this.ic.Internal" id="sbt.InputCache.lzy;$anon.read">read</a><span class="delimiter">(</span><a title="sbinary.Input" id="sbt.InputCache.lzy;$anon.read.from">from</a>: <span title="sbinary.Input">Input</span><span class="delimiter">)</span>: ic.<a href="#sbt;InputCache;Internal" title="this.ic.Internal">Internal</a> = <a href="#sbt.InputCache.lzy;$anon.ic" title="=&gt; sbt.InputCache[I]">ic</a>.<a href="#sbt;InputCache.read" title="(from: sbinary.Input)this.ic.Internal">read</a><span class="delimiter">(</span><a href="#sbt.InputCache.lzy;$anon.read.from" title="sbinary.Input">from</a><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="(to: sbinary.Output, i: this.ic.Internal)Unit" id="sbt.InputCache.lzy;$anon.write">write</a><span class="delimiter">(</span><a title="sbinary.Output" id="sbt.InputCache.lzy;$anon.write.to">to</a>: <span title="sbinary.Output">Out</span>, <a title="this.ic.Internal" id="sbt.InputCache.lzy;$anon.write.i">i</a>: ic.<a href="#sbt;InputCache;Internal" title="this.ic.Internal">Internal</a><span class="delimiter">)</span> = <a href="#sbt.InputCache.lzy;$anon.ic" title="=&gt; sbt.InputCache[I]">ic</a>.<a href="#sbt;InputCache.write" title="(to: sbinary.Output, j: this.ic.Internal)Unit">write</a><span class="delimiter">(</span><a href="#sbt.InputCache.lzy;$anon.write.to" title="sbinary.Output">to</a>, <a href="#sbt.InputCache.lzy;$anon.write.i" title="this.ic.Internal">i</a><span class="delimiter">)</span>
      <span class="keyword">def</span> <a title="=&gt; Equiv[this.ic.Internal]" id="sbt.InputCache.lzy;$anon.equiv">equiv</a> = <a href="#sbt.InputCache.lzy;$anon.ic" title="=&gt; sbt.InputCache[I]">ic</a>.<a href="#sbt;InputCache.equiv" title="=&gt; Equiv[this.ic.Internal]">equiv</a>
    <span class="delimiter">}</span>
<span class="delimiter">}</span>

<span title="AnyRef" class="keyword">class</span> <a title="class BasicCache[I, O] extends AnyRef with sbt.Cache[I,O]" id="sbt;BasicCache">BasicCache</a><span class="delimiter">[</span><a title="" id="sbt;BasicCache;I">I</a>, <a title="" id="sbt;BasicCache;O">O</a><span class="delimiter">]</span><a href="#sbt;BasicCache" title="sbt.BasicCache[I,O]" class="delimiter">(</a><span class="keyword">implicit</span> <a title="sbt.InputCache[I]" id="sbt;BasicCache.input">input</a>: <a href="#sbt;InputCache" title="sbt.InputCache[I]">InputCache</a><span class="delimiter">[</span>I<span class="delimiter">]</span>, <a title="sbinary.Format[O]" id="sbt;BasicCache.outFormat">outFormat</a>: <span title="sbinary.Format[O]">Format</span><span class="delimiter">[</span>O<span class="delimiter">]</span><span class="delimiter">)</span> <span class="keyword">extends</span> <a href="Cache.scala.html#sbt;Cache" title="sbt.Cache[I,O]">Cache</a><span class="delimiter">[</span>I, O<span class="delimiter">]</span> <span class="delimiter">{</span>
  <span class="keyword">def</span> <a title="(file: java.io.File)(in: I)Either[O,O =&gt; Unit]" id="sbt;BasicCache.apply">apply</a><span class="delimiter">(</span><a title="java.io.File" id="sbt;BasicCache.apply.file">file</a>: <span title="java.io.File">File</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="I" id="sbt;BasicCache.apply.in">in</a>: <a href="#sbt;BasicCache;I" title="I">I</a><span class="delimiter">)</span> =
    <span class="delimiter">{</span>
      <span class="keyword">val</span> <a title="BasicCache.this.input.Internal" id="sbt;BasicCache.apply.j">j</a> = <a href="#sbt;BasicCache.input" title="sbt.InputCache[I]">input</a>.<a href="#sbt;InputCache.convert" title="(i: I)BasicCache.this.input.Internal">convert</a><span class="delimiter">(</span><a href="#sbt;BasicCache.apply.in" title="I">in</a><span class="delimiter">)</span>
      <span class="keyword">try</span> <span class="delimiter">{</span> <a href="#sbt;BasicCache.applyImpl" title="(file: java.io.File, in: BasicCache.this.input.Internal)Product with Serializable with scala.util.Either[O,O =&gt; Unit]">applyImpl</a><span class="delimiter">(</span><a href="#sbt;BasicCache.apply.file" title="java.io.File">file</a>, <a href="#sbt;BasicCache.apply.j" title="BasicCache.this.input.Internal">j</a><span class="delimiter">)</span> <span class="delimiter">}</span>
      <span class="keyword">catch</span> <span class="delimiter">{</span> <span class="keyword">case</span> <a title="Exception" id="sbt;BasicCache.apply.e">e</a>: <span title="Exception">Exception</span> =&gt; <span title="(b: O =&gt; Unit)scala.util.Right[Nothing,O =&gt; Unit]">Right</span><span class="delimiter">(</span><a href="#sbt;BasicCache.update" title="(file: java.io.File)(in: BasicCache.this.input.Internal)O =&gt; Unit">update</a><span class="delimiter">(</span><a href="#sbt;BasicCache.apply.file" title="java.io.File">file</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#sbt;BasicCache.apply.j" title="BasicCache.this.input.Internal">j</a><span class="delimiter">)</span><span class="delimiter">)</span> <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(file: java.io.File, in: BasicCache.this.input.Internal)Product with Serializable with scala.util.Either[O,O =&gt; Unit]" id="sbt;BasicCache.applyImpl">applyImpl</a><span class="delimiter">(</span><a title="java.io.File" id="sbt;BasicCache.applyImpl.file">file</a>: <span title="java.io.File">File</span>, <a title="BasicCache.this.input.Internal" id="sbt;BasicCache.applyImpl.in">in</a>: input.<a href="#sbt;InputCache;Internal" title="BasicCache.this.input.Internal">Internal</a><span class="delimiter">)</span> =
    <span class="delimiter">{</span>
      <a href="Using.scala.html#sbt.Using" title="sbt.Using.type">Using</a>.<a href="Using.scala.html#sbt;Using.apply" title="(src: java.io.File)(f: java.io.BufferedInputStream =&gt; Product with Serializable with scala.util.Either[O,O =&gt; Unit])Product with Serializable with scala.util.Either[O,O =&gt; Unit]">fileInputStream</a><span class="delimiter">(</span><a href="#sbt;BasicCache.applyImpl.file" title="java.io.File">file</a><span class="delimiter">)</span> <span class="delimiter">{</span> <a title="java.io.BufferedInputStream" id="sbt;BasicCache.applyImpl.$anonfun.stream">stream</a> =&gt;
        <span class="keyword">val</span> <a title="BasicCache.this.input.Internal" id="sbt;BasicCache.applyImpl.$anonfun.previousIn">previousIn</a> = <a href="#sbt;BasicCache.input" title="sbt.InputCache[I]">input</a>.<a href="#sbt;InputCache.read" title="(from: sbinary.Input)BasicCache.this.input.Internal">read</a><span class="delimiter">(</span><a href="#sbt;BasicCache.applyImpl.$anonfun.stream" title="implicit sbinary.Input.javaInputToInput : (x: java.io.InputStream)sbinary.JavaInput">stream</a><span class="delimiter">)</span>
        <span title="&lt;root&gt; extends Product with Serializable with scala.util.Either[O,O =&gt; Unit]" class="keyword">if</span> <span class="delimiter">(</span><a href="#sbt;BasicCache.input" title="sbt.InputCache[I]">input</a>.<a href="#sbt;InputCache.equiv" title="=&gt; Equiv[BasicCache.this.input.Internal]">equiv</a>.<span title="(x: BasicCache.this.input.Internal, y: BasicCache.this.input.Internal)Boolean">equiv</span><span class="delimiter">(</span><a href="#sbt;BasicCache.applyImpl.in" title="BasicCache.this.input.Internal">in</a>, <a href="#sbt;BasicCache.applyImpl.$anonfun.previousIn" title="BasicCache.this.input.Internal">previousIn</a><span class="delimiter">)</span><span class="delimiter">)</span>
          <span title="(a: O)scala.util.Left[O,Nothing]">Left</span><span class="delimiter">(</span><a href="#sbt;BasicCache.outFormat" title="sbinary.Format[O]">outFormat</a>.<span title="(in: sbinary.Input)O">reads</span><span class="delimiter">(</span><a href="#sbt;BasicCache.applyImpl.$anonfun.stream" title="implicit sbinary.Input.javaInputToInput : (x: java.io.InputStream)sbinary.JavaInput">stream</a><span class="delimiter">)</span><span class="delimiter">)</span>
        <span class="keyword">else</span>
          <span title="(b: O =&gt; Unit)scala.util.Right[Nothing,O =&gt; Unit]">Right</span><span class="delimiter">(</span><a href="#sbt;BasicCache.update" title="(file: java.io.File)(in: BasicCache.this.input.Internal)O =&gt; Unit">update</a><span class="delimiter">(</span><a href="#sbt;BasicCache.applyImpl.file" title="java.io.File">file</a><span class="delimiter">)</span><span class="delimiter">(</span><a href="#sbt;BasicCache.applyImpl.in" title="BasicCache.this.input.Internal">in</a><span class="delimiter">)</span><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
  <span class="keyword">protected</span> <span class="keyword">def</span> <a title="(file: java.io.File)(in: BasicCache.this.input.Internal)O =&gt; Unit" id="sbt;BasicCache.update">update</a><span class="delimiter">(</span><a title="java.io.File" id="sbt;BasicCache.update.file">file</a>: <span title="java.io.File">File</span><span class="delimiter">)</span><span class="delimiter">(</span><a title="BasicCache.this.input.Internal" id="sbt;BasicCache.update.in">in</a>: input.<a href="#sbt;InputCache;Internal" title="BasicCache.this.input.Internal">Internal</a><span class="delimiter">)</span> = <span class="delimiter">(</span>out: <a href="#sbt;BasicCache;O" title="O">O</a><span class="delimiter">)</span> =&gt;
    <span class="delimiter">{</span>
      <a href="Using.scala.html#sbt.Using" title="sbt.Using.type">Using</a>.<a href="Using.scala.html#sbt.Using.fileOutputStream" title="(append: Boolean)sbt.OpenFile[java.io.BufferedOutputStream]">fileOutputStream</a><a href="Using.scala.html#sbt;Using.apply" title="(src: java.io.File)(f: java.io.BufferedOutputStream =&gt; Unit)Unit" class="delimiter">(</a><span title="Boolean(false)" class="keyword">false</span><span class="delimiter">)</span><span class="delimiter">(</span><a href="#sbt;BasicCache.update.file" title="java.io.File">file</a><span class="delimiter">)</span> <span class="delimiter">{</span> <a title="java.io.BufferedOutputStream" id="sbt;BasicCache.update.$anonfun.$anonfun.stream">stream</a> =&gt;
        <a href="#sbt;BasicCache.input" title="sbt.InputCache[I]">input</a>.<a href="#sbt;InputCache.write" title="(to: sbinary.Output, j: BasicCache.this.input.Internal)Unit">write</a><span class="delimiter">(</span><a href="#sbt;BasicCache.update.$anonfun.$anonfun.stream" title="implicit sbinary.Output.javaOutputToOutput : (x: java.io.OutputStream)sbinary.JavaOutput">stream</a>, <a href="#sbt;BasicCache.update.in" title="BasicCache.this.input.Internal">in</a><span class="delimiter">)</span>
        <a href="#sbt;BasicCache.outFormat" title="sbinary.Format[O]">outFormat</a>.<span title="(out: sbinary.Output, value: O)Unit">writes</span><span class="delimiter">(</span><a href="#sbt;BasicCache.update.$anonfun.$anonfun.stream" title="implicit sbinary.Output.javaOutputToOutput : (x: java.io.OutputStream)sbinary.JavaOutput">stream</a>, <a href="#sbt;BasicCache.update.$anonfun.out" title="O">out</a><span class="delimiter">)</span>
      <span class="delimiter">}</span>
    <span class="delimiter">}</span>
<span class="delimiter">}</span>
        </pre>
    </body>
</html>
