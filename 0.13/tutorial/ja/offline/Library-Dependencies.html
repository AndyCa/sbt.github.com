<!DOCTYPE html SYSTEM "about:legacy-compat">
<html manifest="pamflet.manifest">
      <head>
        <meta charset="utf-8"/>
        <meta content="width=device-width, initial-scale=1" name="viewport"/>
        <title>始める sbt — ライブラリ依存性</title>
        
        <link rel="stylesheet" href="../css/blueprint/screen.css" type="text/css" media="screen, projection"/>
        <link rel="stylesheet" href="../css/blueprint/grid.css" type="text/css" media="screen and (min-device-width: 800px), projection"/>
        <link rel="stylesheet" href="../css/blueprint/print.css" type="text/css" media="print"/> 
        <!--[if lt IE 8]>
          <link rel="stylesheet" href={ relativeBase + "css/blueprint/ie.css" } type="text/css" media="screen, projection"/>
        <![endif]-->
        <link rel="stylesheet" href="../css/pamflet.css" type="text/css" media="screen, projection"/>
        <link rel="stylesheet" href="../css/pamflet-print.css" type="text/css" media="print"/>
        <link rel="stylesheet" href="../css/pamflet-grid.css" type="text/css" media="screen and (min-device-width: 800px), projection"/>
        <link rel="stylesheet" href="../css/color_scheme-redmond.css" type="text/css" media="screen, projection"/>
        <link rel="stylesheet" href="../css/color_scheme-github.css" type="text/css" media="screen, projection"/>
        <link rel="stylesheet" href="../css/color_scheme-monokai.css" type="text/css" media="screen, projection"/>
        <link rel="stylesheet" href="../css/pamfletheight_80px_2em.css" type="text/css" media="screen and (min-device-width: 800px), projection"/>
        <script type="text/javascript" src="../js/jquery-1.6.2.min.js"></script>
        <script type="text/javascript" src="../js/jquery.collapse.js"></script>
        <script type="text/javascript" src="../js/pamflet.js"></script>
        <script type="text/javascript">
          Pamflet.page.language = 'ja';
        </script>
        <script type="text/javascript" src="../js/prettify/prettify.js"></script><script type="text/javascript" src="../js/prettify/lang-scala.js"></script><link type="text/css" rel="stylesheet" href="../css/prettify.css"/><script type="text/javascript"><!--
        window.onload=function() { prettyPrint(); };
      --></script>
        <link rel="stylesheet" href="../css/custom.css" type="text/css" media="screen, projection"/>
        
        
      </head>
      <body class="color_scheme-github">
        <a class="page prev nav" href="More-About-Settings.html">
            <span class="space">&nbsp;</span>
            <span class="flip arrow">&gt;</span>
          </a><a class="page next nav" href="Multi-Project.html">
            <span class="space">&nbsp;</span>
            <span class="arrow">&gt;</span>
          </a>
        <div class="container contentswrapper">
          <div class="span-16 prepend-1 append-1 contents">
            <h2 id="%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E4%BE%9D%E5%AD%98%E6%80%A7">ライブラリ依存性<a href="#%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E4%BE%9D%E5%AD%98%E6%80%A7" class="header-link"><span class="header-link-content">&nbsp;</span></a></h2><p>このページは、このガイドのこれまでのページ、特に
<a href="Basic-Def.html">.sbt ビルド定義</a>、<a href="Scopes.html">スコープ</a>、と
<a href="More-About-Settings.html">他の種類のセッティング</a>
を読んでいることを前提とする。
</p><p>ライブラリ依存性は二つの方法で加えることができる:
</p><ul><li><code>lib</code> ディレクトリに jar ファイルを入れることでできる<em>アンマネージ依存性</em>（unmanaged dependencies）
</li><li>ビルド定義に設定され、リポジトリから自動でダウンロードされる<em>マネージ依存性</em>（managed dependencies）
</li></ul><h3 id="%E3%82%A2%E3%83%B3%E3%83%9E%E3%83%8D%E3%83%BC%E3%82%B8%E4%BE%9D%E5%AD%98%E6%80%A7">アンマネージ依存性<a href="#%E3%82%A2%E3%83%B3%E3%83%9E%E3%83%8D%E3%83%BC%E3%82%B8%E4%BE%9D%E5%AD%98%E6%80%A7" class="header-link"><span class="header-link-content">&nbsp;</span></a></h3><p>ほとんどの人は、アンマネージ依存性ではなく、マネージ依存性を使っている。だけど、始めはアンマネージの方が簡単なので分かりやすい。
</p><p>アンマネージ依存性を説明すると、こんな感じになる。jar ファイルを <code>lib</code> に入れると、それはプロジェクトのクラスパスに追加される。
以上！
</p><p>例えば、<a href="http://scalacheck.org">ScalaCheck</a>、<a href="http://code.google.com/p/specs/">specs</a>、<a href="http://scalatest.org">ScalaTest</a> などのテスト用の jar を <code>lib</code> に加えることもできる。
</p><p><code>lib</code> の依存性は（<code>compile</code>、<code>test</code>、<code>run</code>、そして <code>console</code> の）全てのクラスパスに追加される。
もし、どれか一つのクラスパスを変えたい場合は、例えば <code>dependencyClasspath in Compile</code> や
<code>dependencyClasspath in Runtime</code> などを適宜調整する必要がある。
<code>~=</code> を使って既存のクラスパスの値を受け取り、いらないものを filter で外して、新しいクラスパスの値を返せばいい。
<code>~=</code> の詳細に関しては、<a href="More-About-Settings.html">他の種類のセッティング</a>参照。
</p><p>アンマネージ依存性を利用するのに、<code>build.sbt</code> には何も書かなくてもいいけど、
デフォルトの <code>lib</code> 以外のディレクトリを使いたい場合は、
<code>unmanaged-base</code> キーを変更することができる。
</p><p><code>lib</code> のかわりに、<code>custom_lib</code> を使うには:
</p><pre><code class="prettyprint lang-scala">unmanagedBase &lt;&lt;= baseDirectory { base =&gt; base / &quot;custom_lib&quot; }
</code></pre><p><code>baseDirectory</code> はプロジェクトのルートディレクトリで、
<a href="More-About-Settings.html">他の種類のセッティング</a>で説明したとおり、ここでは <code>unmanagedBase</code>
を <code>&lt;&lt;=</code> を使って <code>baseDirectory</code> の値に基づいて変更している。
</p><p>他には、<code>unmanged-jars</code> という <code>unmanaged-base</code> ディレクトリに入っている jar ファイルのリストを返すタスクがある。
複数のディレクトリを使うとか、何か別の複雑なことを行う場合は、この <code>unmanaged-jar</code> タスクを何か別のものに変える必要があるかもしれない。
</p><h3 id="%E3%83%9E%E3%83%8D%E3%83%BC%E3%82%B8%E4%BE%9D%E5%AD%98%E6%80%A7">マネージ依存性<a href="#%E3%83%9E%E3%83%8D%E3%83%BC%E3%82%B8%E4%BE%9D%E5%AD%98%E6%80%A7" class="header-link"><span class="header-link-content">&nbsp;</span></a></h3><p>sbt は、[Apache Ivy] を使ってマネージ依存性を実装するため、既に Maven か Ivy に慣れていれば、違和感無く入り込めるだろう。
</p><h4 id="%E3%82%AD%E3%83%BC"><code>libraryDependencies</code> キー<a href="#%E3%82%AD%E3%83%BC" class="header-link"><span class="header-link-content">&nbsp;</span></a></h4><p>依存性を <code>libraryDependencies</code> セッティングに列挙するだけで、普通はうまくいく。
Maven POM ファイルや、Ivy コンフィギュレーションファイルを書くなどして、依存性を外部で設定してしまって、
sbt にその外部コンフィギュレーションファイルを使わせるということも可能だ。
これに関しては、[Library Management] を参照。
</p><p>依存性の宣言は、以下のようになる。ここで、<code>groupId</code>、<code>artifactId</code>、と <code>revision</code> は文字列だ:
</p><pre><code class="prettyprint lang-scala">libraryDependencies += groupID % artifactID % revision
</code></pre><p>もしくは、以下のようになる。このときの <code>configuration</code> も文字列だ。
</p><pre><code class="prettyprint lang-scala">libraryDependencies += groupID % artifactID % revision % configuration
</code></pre><p><code>libraryDependencies</code> は [Keys] で以下のように定義されている:
</p><pre><code class="prettyprint lang-scala">val libraryDependencies = SettingKey[Seq[ModuleID]](&quot;library-dependencies&quot;, &quot;Declares managed dependencies.&quot;)
</code></pre><p><code>%</code> メソッドは、文字列から <code>ModuleID</code> オブジェクトを作り、その <code>ModuleID</code> を <code>libraryDependencies</code> に追加するだけでいい。
</p><p>当然、sbt は（Ivy を通じて）モジュールをどこからダウンロードしてくるかを知らなければいけない。
もしモジュールが sbt に最初から入っているデフォルトのリポジトリの一つにあれば、ちゃんと動く。
例えば、Apache Derby はデフォルトのリポジトリにある:
</p><pre><code class="prettyprint lang-scala">libraryDependencies += &quot;org.apache.derby&quot; % &quot;derby&quot; % &quot;10.4.1.3&quot;
</code></pre><p>これを <code>build.sbt</code> に打ち込んで、<code>update</code> を実行すると、sbt は Derby を
<code>~/.ivy2/cache/org.apache.derby/</code> にダウンロードするはずだ。
（ちなみに、<code>update</code> は <code>compile</code> の依存性であるため、手動で <code>update</code> と打ち込む必要がある状況は普通は無い。）
</p><p>当然、<code>++=</code> を使って一度に依存ライブラリのリストを追加することもできる:
</p><pre><code class="prettyprint lang-scala">libraryDependencies ++= Seq(
    groupID % artifactID % revision,
    groupID % otherID % otherRevision
)
</code></pre><p><code>libraryDependencies</code> に対して <code>:=</code>、<code>&lt;&lt;=</code>、<code>&lt;+=</code>、その他を使う機会があるかもしれないが、稀だろう。
</p><h4 id="%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E6%AD%A3%E3%81%97%E3%81%84+Scala+%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%82%92%E5%85%A5%E6%89%8B%E3%81%99%E3%82%8B"><code>%%</code> を使って正しい Scala バージョンを入手する<a href="#%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E6%AD%A3%E3%81%97%E3%81%84+Scala+%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E3%82%92%E5%85%A5%E6%89%8B%E3%81%99%E3%82%8B" class="header-link"><span class="header-link-content">&nbsp;</span></a></h4><p><code>groupID % artifactID % revision</code> のかわりに、
<code>groupID %% artifactID % revision</code> を使うと（違いは groupID の後ろの <code>%%</code>）、
sbt はプロジェクトの Scala バージョンをアーティファクト名に追加する。
これはただの略記法なので、<code>%%</code> 無しで書くこともできる:
</p><pre><code class="prettyprint lang-scala">libraryDependencies += &quot;org.scala-tools&quot; % &quot;scala-stm_2.9.1&quot; % &quot;0.3&quot;
</code></pre><p>ビルドのバージョンが <code>scalaVersion</code> が <code>2.9.1</code> だとすると、以下は等価だ:
</p><pre><code class="prettyprint lang-scala">libraryDependencies += &quot;org.scala-tools&quot; %% &quot;scala-stm&quot; % &quot;0.3&quot;
</code></pre><p>多くの依存ライブラリが複数の Scala バージョンに対してコンパイルされていて、
プロジェクトに合ったものを選択したいときに使うというのが考えだ。
</p><p>実践上での問題として、多くの場合依存ライブラリは少しズレた Scala バージョンが使われることがあるけど、
<code>%%</code> はそこまは賢くない。そのため、依存ライブラリが <code>2.9.0</code> までしか出てなくて、
プロジェクトが <code>scalaVersion := &quot;2.9.1&quot;</code> の場合、<code>2.9.0</code> の依存ライブラリが多分動作するにも関わらず <code>%%</code> を使うことができない。
もし、<code>%%</code> が動かなくなったら、依存ライブラリが使っている実際のバージョンを確認して、
動くだろうバージョン（それががあればの話だけど）に決め打ちすればいい。
</p><p>詳しくは、[Cross Build] を参照。
</p><h4 id="Ivy+revision">Ivy revision<a href="#Ivy+revision" class="header-link"><span class="header-link-content">&nbsp;</span></a></h4><p><code>groupID % artifactID % revision</code> の <code>revision</code> は、単一の固定されたバージョン番号じゃなくてもいい。
Ivy は与えられた制限の中でモジュールの最新の revision を選ぶことができる。
<code>&quot;1.6.1&quot;</code> のような固定 revision ではなく、<code>&quot;latest.integration&quot;</code>、<code>&quot;2.9.+&quot;</code>、や <code>&quot;[1.0,)&quot;</code> など指定できる。
詳しくは、[Ivy revisions] を参照。
</p><!-- TODO: Add aliases -->
<h4 id="Resolvers">Resolvers<a href="#Resolvers" class="header-link"><span class="header-link-content">&nbsp;</span></a></h4><p>全てのパッケージが一つのサーバに置いてあるとは限らない。
sbt は、デフォルトで standard Maven2 repository のリポジトリを使う。
もし依存ライブラリがこのデフォルトのリポジトリに無ければ、Ivy がそれを見つけられるように <em>resolver</em> を追加する必要がある。
</p><p>リポジトリを追加するには、以下のようにする:
</p><pre><code class="prettyprint lang-scala">resolvers += name at location
</code></pre><p>例えば:
</p><pre><code class="prettyprint lang-scala">resolvers += &quot;Sonatype OSS Snapshots&quot; at &quot;https://oss.sonatype.org/content/repositories/snapshots&quot;
</code></pre><p><a href="../sxr/sbt/Keys.scala.html">Keys</a> で定義されいる <code>resolvers</code> キーは以下のようになっている:
</p><pre><code class="prettyprint lang-scala">val resolvers = settingKey[Seq[Resolver]](&quot;The user-defined additional resolvers for automatically managed dependencies.&quot;)
</code></pre><p><code>at</code> メソッドは、二つの文字列から <code>Resolver</code> オブジェクトを作る。
</p><p>sbt は、リポジトリとして追加すれば、ローカル Maven リポジトリも検索することができる:
</p><pre><code class="prettyprint lang-scala">resolvers += &quot;Local Maven Repository&quot; at &quot;file://&quot;+Path.userHome.absolutePath+&quot;/.m2/repository&quot;
</code></pre><p>他の種類のリポジトリの定義の詳細に関しては、[Resolvers] 参照。
</p><h4 id="%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E3%81%AE+resolver+%E3%81%AE%E3%82%AA%E3%83%BC%E3%83%90%E3%83%BC%E3%83%A9%E3%82%A4%E3%83%89">デフォルトの resolver のオーバーライド<a href="#%E3%83%87%E3%83%95%E3%82%A9%E3%83%AB%E3%83%88%E3%81%AE+resolver+%E3%81%AE%E3%82%AA%E3%83%BC%E3%83%90%E3%83%BC%E3%83%A9%E3%82%A4%E3%83%89" class="header-link"><span class="header-link-content">&nbsp;</span></a></h4><p><code>resolvers</code> は、デフォルトの resolver を含まず、ビルド定義によって加えられる追加のものだけを含む。
</p><p><code>sbt</code> は、<code>resolvers</code> をデフォルトのリポジトリと組み合わせて <code>external-resolvers</code> を形成する。　
</p><p>そのため、デフォルトの resolver を変更したり、削除したい場合は、<code>resolvers</code> ではなく、<code>external-resolvers</code> をオーバーライドする必要がある。
</p><h4 id="%E3%82%B3%E3%83%B3%E3%83%95%E3%82%A3%E3%82%AE%E3%83%A5%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%94%E3%81%A8%E3%81%AE%E4%BE%9D%E5%AD%98%E6%80%A7">コンフィギュレーションごとの依存性<a href="#%E3%82%B3%E3%83%B3%E3%83%95%E3%82%A3%E3%82%AE%E3%83%A5%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%94%E3%81%A8%E3%81%AE%E4%BE%9D%E5%AD%98%E6%80%A7" class="header-link"><span class="header-link-content">&nbsp;</span></a></h4><p>依存ライブラリをテストコード（<code>Test</code> コンフィギュレーションでコンパイルされる <code>src/test/scala</code> 内のコード）から使いたいが、
メインのコードでは使わないということがよくある。
</p><p>ある依存ライブラリが <code>Test</code> コンフィギュレーションのクラスパスには出てきて欲しいけど、
<code>Compile</code> コンフィギュレーションではいらない場合は、以下のように <code>% &quot;test&quot;</code> と追加する:
</p><pre><code class="prettyprint lang-scala">libraryDependencies += &quot;org.apache.derby&quot; % &quot;derby&quot; % &quot;10.4.1.3&quot; % &quot;test&quot;
</code></pre><p>sbt のインタラクティブモードで <code>show compile:dependency-classpath</code> と打ち込んでも、Derby は出てこないはずだ。
だけど、<code>show test:dependency-classpath</code> と打ち込むと、Derby の jar がリストにあるのが確認できる。
</p><p>普通は、<a href="http://scalacheck.org">ScalaCheck</a>、<a href="http://code.google.com/p/specs/">specs</a>、<a href="http://scalatest.org">ScalaTest</a> などのテスト関連の依存ライブラリは <code>% &quot;test&quot;</code> と共に定義される。
</p><p>ライブラリの依存性に関しては、もうこの入門用のページで見つからない情報があれば、<a href="../docs/Library-Management.html">このページ</a>に
もう少し詳細やコツが書いてある。
</p><div class="bottom nav span-16">
                        <em>Next Page</em>
                        <span class="arrow">&gt;</span>
                        <a href="Multi-Project.html"> マルチプロジェクト・ビルド </a>                        
                        <ul class="language-bar">
        <li><a href="../Library-Dependencies.html"><span class="lang-item lang-en">English</span></a></li><li><a href="../ja/Library-Dependencies.html"><span class="lang-item lang-ja">日本語</span></a></li>
      </ul>
                      </div><div class="tocwrapper show">
      <a class="tochead nav" style="display: none" href="#toc">❦</a>
      <a name="toc"></a>
      <h4 class="toctitle">Contents</h4>
      <div class="tocbody">
      <div><a href="index.html">始める sbt</a></div><ol class="toc"> <li><div><a href="Setup.html">sbt のインストール</a></div><ol class="toc"> <li><div><a href="Installing-sbt-on-Mac.html">Mac への sbt のインストール</a></div></li><li><div><a href="Installing-sbt-on-Windows.html">Windows への sbt のインストール</a></div></li><li><div><a href="Installing-sbt-on-Linux.html">Linux への sbt のインストール</a></div></li><li><div><a href="Manual-Installation.html">手動インストール</a></div></li> </ol></li><li><div><a href="Hello.html">Hello, World</a></div></li><li><div><a href="Directories.html">ディレクトリ構造</a></div></li><li><div><a href="Running.html">実行</a></div></li><li><div><a href="Basic-Def.html">.sbt ビルド定義</a></div></li><li><div><a href="Scopes.html">スコープ</a></div></li><li><div><a href="More-About-Settings.html">他の種類のセッティング</a></div></li><li><div class="current">ライブラリ依存性</div></li><li><div><a href="Multi-Project.html">マルチプロジェクト・ビルド</a></div></li><li><div><a href="Using-Plugins.html">プラグインの使用</a></div></li><li><div><a href="Custom-Settings.html">カスタムセッティングとタスク</a></div></li><li><div><a href="Full-Def.html">.scala ビルド定義</a></div></li><li><div><a href="Summary.html">まとめ</a></div></li><li class="generated"><div><a href="Contents+in+Depth.html">Contents in Depth</a></div></li><li class="generated"><div><a href="Combined+Pages.html">Combined Pages</a></div></li> </ol></div></div>
          </div>
        </div>
        <div class="header">
          <link href="http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600,700,900,400italic,700italic" rel="stylesheet" type="text/css">
<div class="container navbar-static-top nav">
    <div class="logo">
      <a href="../../../index.html"><img src="../files/sbt-logo-white-72x50.png" alt="sbt"></a>
    </div>
    <ul class="navlist">
      <li><a href="../../../documentation.html">Documentation</a></li>
      <li><a href="../../../download.html">Download</a></li>
      <li><a href="../../../community.html">Community</a></li>
      <li id="source-code"><a href="https://github.com/sbt/sbt"><img src="../files/github-logo.png" alt="Source code"></a></li>
      <li id="twitter"><a href="https://twitter.com/scala_sbt"><img src="../files/twitter-logo-white.png" alt="sbt on Twitter"></a></li>
    </ul>
</div>

        </div>
        <div class="footer">
          
        </div>
        
        
      </body>
    </html>